<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ÂøÉÁêÜÂÆáÂÆôÔºöMindverse (Narrative Edition)</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3V80KBCWC1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3V80KBCWC1');
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Orbitron:wght@500;700;900&display=swap');
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            overscroll-behavior: none;
            background-color: #020205;
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: none;
            -webkit-font-smoothing: antialiased;
            position: fixed;
        }
        canvas {
            display: block;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        .font-preload { position: absolute; opacity: 0; pointer-events: none; }
    </style>
</head>
<body>
    <div class="font-preload" style="font-family: 'Orbitron'">Loading...</div>
    <div class="font-preload" style="font-family: 'Noto Sans TC'">Loading...</div>
    <canvas id="appCanvas"></canvas>

    <script>
        /**
         * ÂøÉÁêÜÂÆáÂÆô Mindverse - v1.0 Narrative Edition
         * Features: Narrative FSM, Vector Pointers, Context-Aware Hints, Safe-Zone Typography
         */

        // --- Ê†∏ÂøÉÁ≥ªÁµ±ËàáËÆäÊï∏ ---
        const canvas = document.getElementById('appCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, dpr = 1, isMobile = false;

        // GA4
        function sendGAEvent(eventName, params) {
            if (typeof gtag === 'function') {
                gtag('event', eventName, params);
            }
        }

        // ÁãÄÊÖãÁÆ°ÁêÜ
        let mouse = { x: 0, y: 0, down: false };
        let gyro = { x: 0, y: 0 };
        let currentScene = 'LOBBY'; 
        let activeGameId = null;
        let camera = { zoom: 1, x: 0, y: 0, targetZoom: 1, targetX: 0, targetY: 0 };
        let hitZones = []; 
        
        // ÊªæÂãïÁ≥ªÁµ±ËÆäÊï∏
        let summaryScrollY = 0;
        let summaryContentHeight = 0;
        let touchStartY = 0;
        let isDragging = false;

        const SAFE_TOP = 50;
        const SAFE_BOTTOM = 40;

        // --- Mindverse Narrative System (v1.0 Final) ---
        
        // ÊñáÊ°àÂ∫´ÔºöÈñãÂ†¥ (Opening) - Èö®Ê©ü‰∏âÈÅ∏‰∏Ä
        const openingTexts = [
            "Ê≠°Ëøé‰æÜÂà∞ÂøÉÁêÜÂÆáÂÆô„ÄÇ\nÊØè‰∏ÄÊ¨°ÈÅ∏ÊìáÔºå\nÈÉΩÂú®ÊèèÁπ™‰Ω†ÁöÑÊÄßÊ†ºËªåÈÅì„ÄÇ",
            "ÈÄôË£°Ê≤íÊúâÊ®ôÊ∫ñÁ≠îÊ°à„ÄÇ\nÂè™Êúâ‰Ω†Â¶Ç‰ΩïÂÅöÂá∫ÈÅ∏Êìá„ÄÇ",
            "ÊóÖÁ®ãÂç≥Â∞áÂ±ïÈñã„ÄÇ\nÂæûÈÇ£È°ÜÊ≠£Âú®ÂëºÂê∏ÁöÑÊòüÁêÉÈñãÂßã„ÄÇ"
        ];

        // ÊñáÊ°àÂ∫´ÔºöÁãÄÊÖãÊèêÁ§∫ (Hints) - ÂÆöÂûãÊñá
        const WORLD_HINT = {
            LOCKED: "ÈÄôÈ°ÜÊòüÁêÉÔºå\nÈÇÑÊ≤íÂà∞‰Ω†ÊäµÈÅîÁöÑÊôÇÈñì„ÄÇ",
            DONE:   "‰Ω†ÁöÑÊóÖÁ®ãÔºå\nÊúÉÂú®Ê≠£Á¢∫ÁöÑÁØÄÂ•è‰∏≠Â±ïÈñã„ÄÇ"
        };

        // ‰∏ñÁïåË®äÊÅØÁãÄÊÖãÊ©ü
        let worldMsg = { 
            state: 'IDLE', // IDLE | OPENING | HINT | FADE_OUT
            text: '', 
            alpha: 0, 
            timer: 0 
        };

        // --- Ë¶ñË¶∫È¢®Ê†º ---
        const styles = {
            bg: '#020205',
            nodes: {
                'BIG5': { color: '#4d79ff', glow: '#00f3ff', type: 'pentagon', label: '‰∫îÂ§ßÊÄßÊ†º' },
                'MBTI': { color: '#ff3333', glow: '#ffcc00', type: 'core', label: 'RPG ËÅ∑Ê•≠' },
                'ENNEAGRAM': { color: '#cd7f32', glow: '#ffd700', type: 'nonagon', label: '‰πùÂûã‰∫∫Ê†º' },
                'RIASEC': { color: '#00ced1', glow: '#00ffcc', type: 'hexagon', label: 'Ëç∑Ëò≠‰ª£Á¢º' },
                'COLOR': { color: '#ff00ff', glow: '#ffffff', type: 'rainbow', label: 'Ëâ≤ÂΩ©ÂøÉÁêÜ' },
                'ANIMAL': { color: '#32cd32', glow: '#adff2f', type: 'radar', label: 'ÂãïÁâ©ÂúñÈ®∞' }
            }
        };

        // --- Ë≥áÊñôÂ∫´ (ÂÆåÊï¥ÂÖßÂÆπ - ‰øùÊåÅ‰∏çËÆä) ---
        const big5Data = {
            qs: [
                {t:"ÂñúÊ≠°Âú®ËÅöÊúÉ‰∏≠Ë™çË≠òÊñ∞ÊúãÂèã", k:'E'}, {t:"Â∞çËóùË°ìÂíåÊäΩË±°Ê¶ÇÂøµÊÑüËààË∂£", k:'O'}, {t:"ÂÅö‰∫ãÈÄöÂ∏∏ÊúÉÊèêÂâçË®àÂäÉ", k:'C'}, {t:"ÂÆπÊòìÊÑüÂèóÂà∞Âà•‰∫∫ÁöÑÊÉÖÁ∑í", k:'A'}, {t:"Â£ìÂäõÂ§ßÊôÇÂÆπÊòìÊÑüÂà∞ÁÑ¶ÊÖÆ", k:'N'},
                {t:"ÊØîËºÉÂñúÊ≠°ÂÆâÈùúÁç®Ëôï", k:'E', rev:true}, {t:"ÂñúÊ≠°ÂòóË©¶Áï∞ÂúãÊñôÁêÜ", k:'O'}, {t:"ÊàøÈñìÈÄöÂ∏∏ÂæàÊï¥ÊΩî", k:'C'}, {t:"Ê®ÇÊñºÂπ´Âä©‰ªñ‰∫∫Ëß£Ê±∫ÂïèÈ°å", k:'A'}, {t:"ÊÉÖÁ∑íËµ∑‰ºèÊØîËºÉÂ§ß", k:'N'}
            ],
            results: {
                'O': { t:"ÈñãÊîæÊÄß (Openness)", oneLine:"Â•ΩÂ•áÂøÉÊó∫ÁõõÔºåÊãíÁµïÁÑ°ËÅäÁöÑÈªûÂ≠êÁéã„ÄÇ", life:"‰Ω†ÂñúÊ≠°ÂòóË©¶Êñ∞È§êÂª≥„ÄÅÊñ∞Ë∑ØÁ∑öÔºåË®éÂé≠‰∏ÄÊàê‰∏çËÆäÁöÑÁîüÊ¥ª„ÄÇËÖ¶‰∏≠Á∏ΩÊúâÂ§©È¶¨Ë°åÁ©∫ÁöÑÊÉ≥Ê≥ï„ÄÇ", workStrength:["ÂâµÊñ∞ËÉΩÂäõÂº∑ÔºåÈÅ©ÂêàÁôºÊÉ≥","ÈÅ©ÊáâÂäõÈ´òÔºå‰∏çÊéíÊñ•Êñ∞Â∑•ÂÖ∑"], workRisk:["ÂÆπÊòìÊÉ≥Â§™Â§öËÄåÈõ£‰ª•Êî∂ÊñÇ","Â∞çÈáçË§áÊÄßÂ∑•‰ΩúÊÑüÂà∞Âé≠ÁÖ©"], tips:["Á∑¥Áøí„ÄåÊääÈªûÂ≠êËêΩÂú∞„ÄçÁöÑÂü∑Ë°åÂäõ","ÊØèÈÄ±Áµ¶Ëá™Â∑±‰∏ÄÂÄã„ÄåÂ∞àÊ≥®ÊôÇÊÆµ„Äç‰∏çÁúãÊñ∞Ë®äÊÅØ"] },
                'C': { t:"Áõ°Ë≤¨ÊÄß (Conscientiousness)", oneLine:"Ëá™Âæã‰∏îÂèØÈù†ÔºåÂúòÈöäÁöÑÂÆöÊµ∑Á•ûÈáù„ÄÇ", life:"‰Ω†ÁöÑÊàøÈñìÈÄöÂ∏∏ÂæàÊï¥ÈΩäÔºåÂá∫ÈñÄÊóÖÈÅäÊúÉÂÖàÊü•Â•ΩÊîªÁï•„ÄÇ‰Ω†ÂñúÊ≠°„ÄåÊéåÊéßÊÑü„ÄçÔºå‰∏çÂñúÊ≠°Á™ÅÁôºÁãÄÊ≥Å„ÄÇ", workStrength:["Âü∑Ë°åÂäõÂº∑ÔºåÁ≠îÊáâÁöÑ‰∫ã‰ΩøÂëΩÂøÖÈÅî","Á¥∞ÂøÉÔºåÂæàÂ∞ëÁäØ‰ΩéÁ¥öÈåØË™§"], workRisk:["Â∞çËá™Â∑±ÂíåÂà•‰∫∫ÈÉΩÂ§™Âö¥Ê†º","ÈÅáÂà∞Ë®àÁï´ÊîπËÆäÂÆπÊòìÁÑ¶ÊÖÆ"], tips:["Á∑¥ÁøíÊé•Âèó„Äå80ÂàÜ‰πüÂèØ‰ª•„Äç","Ë©¶Ëëó‰øùÁïô‰∏ÄÈªûÂΩàÊÄßÊôÇÈñìÁµ¶Á™ÅÁôºÁãÄÊ≥Å"] },
                'E': { t:"Â§ñÂêëÊÄß (Extraversion)", oneLine:"ÁÜ±ÊÉÖÊ¥ãÊ∫¢ÔºåÂ§©ÁîüÁöÑÈÄ£ÁµêËÄÖ„ÄÇ", life:"ÊØîËµ∑Áç®ËôïÔºå‰Ω†Êõ¥ÂñúÊ≠°Êâæ‰∫∫ËÅäÂ§©„ÄÇÂÅáÊó•ÂæÖÂú®ÂÆ∂ÊúÉË¶∫ÂæóËÉΩÈáèÊûØÁ´≠ÔºåËÅöÊúÉÊòØ‰Ω†ÂÖÖÈõªÁöÑÊñπÂºè„ÄÇ", workStrength:["ÊìÖÈï∑Á†¥ÂÜ∞ËàáÂª∫Á´ãÈóú‰øÇ","Âú®ÂúòÈ´î‰∏≠ËÉΩÂ∏∂ÂãïÊ∞£Ê∞õ"], workRisk:["Ë™™Ë©±ÊúâÊôÇÂ§™Âø´ÔºåÂøò‰∫ÜÂÇæËÅΩ","ÂÆπÊòìÂõ†Â§ñÂãôÂàÜÂøÉ"], tips:["Á∑¥Áøí„ÄåÊ∑±Â∫¶ÂÇæËÅΩ„Äç‰∏çÊèíË©±","Â≠∏ÁøíÁç®ËôïÔºåÊ≤âÊæ±ÂÖßÂøÉ"] },
                'A': { t:"Ë¶™ÂíåÊÄß (Agreeableness)", oneLine:"Ê∫´ÊöñÂåÖÂÆπÔºåÈáçË¶ñÂíåË´ßÁöÑÂÆàË≠∑ËÄÖ„ÄÇ", life:"‰Ω†ÂæàÂú®ÊÑèÂà•‰∫∫ÁöÑÊÑüÂèóÔºåÂ∏∏Âõ†ÁÇ∫‰∏çÊÉ≥Ë°ùÁ™ÅËÄåÂßîÂ±àËá™Â∑±„ÄÇÊúãÂèãÂ∏∏Êâæ‰Ω†Ë®¥Ëã¶„ÄÇ", workStrength:["ÂñÑÊñºÂêà‰ΩúÔºå‰πüÊòØÂæàÂ•ΩÁöÑÂçîË™øËÄÖ","ÂØåÊúâÂêåÁêÜÂøÉÔºåÈÅ©ÂêàÊúçÂãôÊàñHR"], workRisk:["ÂÆπÊòìËÆäÊàêÊø´Â•Ω‰∫∫","‰∏çÊï¢Áà≠ÂèñËá™Â∑±ÁöÑÊ¨äÁõä"], tips:["Á∑¥ÁøíÊ∫´Âíå‰ΩÜÂ†ÖÂÆöÂú∞Ë™™„Äå‰∏ç„Äç","Êää„ÄåÁÖßÈ°ßËá™Â∑±„Äç‰πüÂàóÂÖ•ÂæÖËæ¶Ê∏ÖÂñÆ"] },
                'N': { t:"Á•ûÁ∂ìË≥™ (Neuroticism)", oneLine:"ÊÉÖÊÑüÁ¥∞ËÜ©ÔºåÊïèÈä≥ÁöÑÈ¢®Èö™ÂÅµÊ∏¨ÂÑÄ„ÄÇ", life:"‰Ω†ÁöÑÂÖßÂøÉÊà≤ÂæàÂ§öÔºåÂÆπÊòìÂõ†ÁÇ∫Âà•‰∫∫‰∏ÄÂè•Ë©±ÊÉ≥Âæà‰πÖ„ÄÇ‰ΩÜ‰πüÂõ†Ê≠§Ôºå‰Ω†ÊìÅÊúâÊØîÂà•‰∫∫Êõ¥Ê∑±ÁöÑÊÉÖÊÑüÈ´îÈ©ó„ÄÇ", workStrength:["Âç±Ê©üÊÑèË≠òÂº∑ÔºåËÉΩÈ†êË¶ãÂïèÈ°å","Â∞çËóùË°ìÊàñÊÉÖÊÑüÊúâÈ´òÊïèÈä≥Â∫¶"], workRisk:["Â£ìÂäõÂ§ßÊôÇÂÆπÊòìÁï∂Ê©ü","ÂÆπÊòìÊääÂ∞è‰∫ãÊîæÂ§ß"], tips:["ÁÑ¶ÊÖÆÊôÇÔºåË©¶Ëëó„ÄåÂØ´‰∏ã‰æÜ„ÄçÈáêÊ∏Ö‰∫ãÂØ¶","Á∑¥ÁøíÊ≠£ÂøµÂëºÂê∏ÔºåÂõûÂà∞Áï∂‰∏ã"] }
            }
        };
        const mbtiData = {
            qs: [
                {q:"ÈÄ±Êú´Êõ¥ÊÉ≥...", a:"Ë∑üÊúãÂèãÂá∫ÂéªÁé©(E)", b:"Âú®ÂÆ∂‰ºëÊÅØ(I)", d:'ei', v:2}, {q:"Â≠∏ÁøíÊñ∞‰∫ãÁâ©...", a:"ÂÖàÊáÇÁêÜË´ñ(N)", b:"ÂÖàÁúãÁØÑ‰æã(S)", d:'sn', v:2},
                {q:"ÂÅöÊ±∫ÂÆöÊôÇ...", a:"ÈÇèËºØÂàÜÊûê(T)", b:"Âú®ÊÑèÊÑüÂèó(F)", d:'tf', v:2}, {q:"ÁîüÊ¥ªÊñπÂºè...", a:"ÊåâÈÉ®Â∞±Áè≠(J)", b:"Èö®ÈÅáËÄåÂÆâ(P)", d:'jp', v:2},
                {q:"Ê¥æÂ∞ç‰∏ä...", a:"Ë™çË≠òÈôåÁîü‰∫∫(E)", b:"ÊâæÁÜü‰∫∫(I)", d:'ei', v:2}, {q:"‰Ω†Êõ¥Áõ∏‰ø°...", a:"Áõ¥Ë¶∫ËàáÈùàÊÑü(N)", b:"Á∂ìÈ©óËàáÊï∏Êìö(S)", d:'sn', v:2},
                {q:"ÊúãÂèãË®¥Ëã¶...", a:"Áµ¶‰∫àÂª∫Ë≠∞(T)", b:"Áµ¶‰∫àÂÆâÊÖ∞(F)", d:'tf', v:2}, {q:"Â∑•‰ΩúÁí∞Â¢É...", a:"‰∫ïÁÑ∂ÊúâÂ∫è(J)", b:"ÂΩàÊÄßËá™Áî±(P)", d:'jp', v:2}
            ],
            results: {
                'ISTJ': { t:'ÁöáÂÆ∂Ë°õÂ£´', e:'üõ°Ô∏è', oneLine:"‰∏ÄÁµ≤‰∏çËãüÁöÑÈÇèËºØÂü∑Ë°åËÄÖ„ÄÇ", teamRole:"ÊµÅÁ®ãÂÆàË≠∑ËÄÖÔºåÁ¢∫‰øùSOPË¢´Âü∑Ë°å„ÄÇ", careMost:"Áß©Â∫èËàáË≤¨‰ªª„ÄÇ", coopTips:["Ë´ãÁµ¶Âá∫ÊòéÁ¢∫Êåá‰ª§ËàáÊúüÈôê","‰∏çË¶ÅÈö®ÊÑèËÆäÊõ¥Ë®àÁï´"], careerHint:["ÈÅ©ÂêàÊúâÂà∂Â∫¶„ÄÅË¨õÊ±ÇÁ≤æÊ∫ñÁöÑÁí∞Â¢É"] },
                'ISFJ': { t:'ÂÆàË≠∑Â§©‰Ωø', e:'üïØÔ∏è', oneLine:"Ê∫´Êöñ‰∏îÁõ°Ë≤¨ÁöÑÂπïÂæåÊé®Êâã„ÄÇ", teamRole:"ÁÖßÈ°ßËÄÖÔºåË£úË∂≥ÂúòÈöäÁ¥∞ÁØÄ„ÄÇ", careMost:"ÂíåË´ßËàá‰ªñ‰∫∫ÁöÑÈúÄÊ±Ç„ÄÇ", coopTips:["Áµ¶‰∫àÁúüË™†ÁöÑÊÑüË¨ù","ÈÅøÂÖçÂÖ¨ÈñãÊâπË©ï"], careerHint:["ÈÅ©ÂêàÂä©‰∫∫„ÄÅË°åÊîøÊàñÈÜ´ÁôÇÈ†òÂüü"] },
                'INFJ': { t:'Á•ûÁßòÂÖàÁü•', e:'üîÆ', oneLine:"Ê¥ûÂØü‰∫∫ÊÄßÔºåÊ∑±ÈÇÉÁöÑÁêÜÊÉ≥‰∏ªÁæ©ËÄÖ„ÄÇ", teamRole:"Á≤æÁ•ûÈ†òË¢ñÔºåÁúãË¶ãÈï∑ÈÅ†È°òÊôØ„ÄÇ", careMost:"ÊÑèÁæ©ËàáÊ∑±Â±§ÈÄ£Áµê„ÄÇ", coopTips:["Áµ¶‰ªñÂÄëÊôÇÈñìÁç®ËôïÊÄùËÄÉ","Â∞äÈáç‰ªñÂÄëÁöÑÁõ¥Ë¶∫"], careerHint:["ÈÅ©ÂêàË´ÆÂïÜ„ÄÅÂØ´‰ΩúÊàñÈùûÁáüÂà©ÁµÑÁπî"] },
                'INTJ': { t:'Êà∞Áï•ËªçÂ∏´', e:'‚ôüÔ∏è', oneLine:"Áç®Á´ãÈÅ†Ë¶ãÔºåËøΩÊ±ÇÊ•µËá¥ÊïàÁéá„ÄÇ", teamRole:"Á≥ªÁµ±Êû∂ÊßãÂ∏´ÔºåÂÑ™ÂåñÂÖ®Â±Ä„ÄÇ", careMost:"ËÉΩÂäõËàáÈÇèËºØ„ÄÇ", coopTips:["Ë¨õÈáçÈªûÔºå‰∏çË¶ÅÂª¢Ë©±","Áî®Êï∏ÊìöË™™Êúç‰ªñÂÄë"], careerHint:["ÈÅ©ÂêàÁ†îÁôº„ÄÅÁ≠ñÁï•Ë¶èÂäÉÊàñÁßëÊäÄÊ•≠"] },
                'ISTP': { t:'Â∑•Âå†Â§ßÂ∏´', e:'üîß', oneLine:"ÂÜ∑ÈùúËßÄÂØüÔºåËß£Ê±∫ÂïèÈ°åÁöÑÈ´òÊâã„ÄÇ", teamRole:"ÊïëÁÅ´ÈöäÔºåËß£Ê±∫Á™ÅÁôºÊäÄË°ìÈõ£È°å„ÄÇ", careMost:"Ëá™Áî±ËàáÂØ¶Áî®ÊÄß„ÄÇ", coopTips:["‰∏çË¶ÅÁÆ°Â§™Á¥∞","ËÆì‰ªñÂÄëÂãïÊâãÂÅö"], careerHint:["ÈÅ©ÂêàÂ∑•Á®ã„ÄÅÊäÄË°ìÊàñÊà∂Â§ñÂ∑•‰Ωú"] },
                'ISFP': { t:'ÈùàÈ≠ÇÁï´Â∏´', e:'üé®', oneLine:"Ê∫´ÂíåÊïèÊÑüÔºåÁî®Ë°åÂãïË°®ÈÅîÊÉÖÊÑü„ÄÇ", teamRole:"ÁæéÊÑüÊìîÁï∂ÔºåÁ∂≠Ë≠∑Ê∞õÂúç„ÄÇ", careMost:"ÂÄã‰∫∫ÂÉπÂÄºËßÄËàáÁæé„ÄÇ", coopTips:["Áµ¶‰∫àÂèãÂñÑÁöÑÁ©∫Èñì","‰∏çË¶ÅÂº∑Ëø´‰ªñÂÄëÁ´∂Áà≠"], careerHint:["ÈÅ©ÂêàË®≠Ë®à„ÄÅËóùË°ìÊàñËá™Áî±Ê•≠"] },
                'INFP': { t:'Ê≤ªÁôíË©©‰∫∫', e:'üçÉ', oneLine:"Âø†ÊñºËá™ÊàëÔºåÊ∫´ÊüîÁöÑÂ§¢ÊÉ≥ÂÆ∂„ÄÇ", teamRole:"ÂÉπÂÄºÂÆàË≠∑ËÄÖÔºåÂñöÈÜíÂàùË°∑„ÄÇ", careMost:"ÁúüË™†ËàáÂÖßÂú®ÂíåË´ß„ÄÇ", coopTips:["Ê∫´ÂíåÊ∫ùÈÄöÔºåÈÅøÂÖçË°ùÁ™Å","ÊîØÊåÅ‰ªñÂÄëÁöÑÁêÜÊÉ≥"], careerHint:["ÈÅ©ÂêàÂâµ‰Ωú„ÄÅËºîÂ∞éÊàñÊïôËÇ≤"] },
                'INTP': { t:'ÈÇèËºØÂ≠∏ÂÆ∂', e:'üß™', oneLine:"Ê∏¥ÊúõÁü•Ë≠òÔºåËß£ÊßãÂÆáÂÆôÁöÑÊÄùËÄÉËÄÖ„ÄÇ", teamRole:"ÂàÜÊûêÂ∏´ÔºåÊâæÂá∫ÈÇèËºØÊºèÊ¥û„ÄÇ", careMost:"ÁúüÁêÜËàáÊ∫ñÁ¢∫ÊÄß„ÄÇ", coopTips:["Êé•Âèó‰ªñÂÄëÁöÑË≥™Áñë","Áµ¶‰∫àÊô∫ÂäõÊåëÊà∞"], careerHint:["ÈÅ©ÂêàÂ≠∏Ë°ìÁ†îÁ©∂„ÄÅÁ®ãÂºèÈñãÁôº"] },
                'ESTP': { t:'Ê•µÈôêÂÜíÈö™ÂÆ∂', e:'üöÄ', oneLine:"Ê¥ªÂú®Áï∂‰∏ãÔºåËß£Ê±∫ÁáÉÁúâ‰πãÊÄ•„ÄÇ", teamRole:"Ë°åÂãïÊ¥æÔºåÊé®Âãï‰∫ãÊÉÖÁôºÁîü„ÄÇ", careMost:"Âà∫ÊøÄËàáÁµêÊûú„ÄÇ", coopTips:["Áõ¥Êé•Ë¨õÁµêÊûú","Èô™‰ªñÂÄë‰∏ÄËµ∑Ë°ù"], careerHint:["ÈÅ©ÂêàÊ•≠Âãô„ÄÅÁ∑äÊÄ•ÊáâËÆäÊàñÂâµÊ•≠"] },
                'ESFP': { t:'Ë∂ÖÁ¥öÂ∑®Êòü', e:'üé§', oneLine:"ÁîüÊ∞£ÂãÉÂãÉÔºåËÆìÁîüÊ¥ªÂÖÖÊªøÊ®ÇË∂£„ÄÇ", teamRole:"Ê∞£Ê∞õË£ΩÈÄ†ËÄÖÔºåÂáùËÅöÂúòÈöä„ÄÇ", careMost:"Âø´Ê®ÇËàáÁï∂‰∏ãÈ´îÈ©ó„ÄÇ", coopTips:["Â§ö‰∏ÄÈªûËÆöÁæéËàá‰∫íÂãï","‰∏çË¶ÅÂ§™Âö¥ËÇÖ"], careerHint:["ÈÅ©ÂêàÂÖ¨Èóú„ÄÅË°®ÊºîÊàñÊúçÂãôÊ•≠"] },
                'ENFP': { t:'ÁÜ±Ë°ÄÂ§¢ÊÉ≥ÂÆ∂', e:'üåà', oneLine:"ÁÜ±ÊÉÖÊªøÈªûÔºåÁúãË¶ãÁÑ°ÈôêÂèØËÉΩÊÄß„ÄÇ", teamRole:"ÈªûÂ≠êÁéãÔºåÊøÄÂãµ‰∫∫ÂøÉ„ÄÇ", careMost:"ÂâµÊÑèËàá‰∫∫ÈöõÈÄ£Áµê„ÄÇ", coopTips:["Èô™‰ªñÂÄëÁôºÊÉ≥ÔºåÂÜçÂπ´ÂøôÊî∂ÊñÇ","Áµ¶‰∫àÂΩàÊÄß"], careerHint:["ÈÅ©ÂêàË°åÈä∑„ÄÅÂâµÊÑèÊàñÊ¥ªÂãïÁ≠ñÂäÉ"] },
                'ENTP': { t:'ÂçöÂ≠∏ËæØË´ñÂÆ∂', e:'‚ö°', oneLine:"Ê©üÊô∫ÈùàÊ¥ªÔºåÂñúÊ≠°ÊåëÊà∞Êô∫ÂäõÊ•µÈôê„ÄÇ", teamRole:"ÂâµÊñ∞ËÄÖÔºåÊâìÁ†¥Ê°ÜÊû∂„ÄÇ", careMost:"ÂâµÊñ∞ËàáÊåëÊà∞„ÄÇ", coopTips:["Ë∑ü‰ªñÂÄëËæØË´ñÊòØÁ®ÆÊ®ÇË∂£","‰∏çË¶ÅÈôêÂà∂‰ªñÂÄëÁöÑÊñπÊ≥ï"], careerHint:["ÈÅ©ÂêàÈ°ßÂïè„ÄÅÂâµÊ•≠ÊàñÊ≥ïÂæã"] },
                'ESTJ': { t:'Â§ßÂÖÉÂ∏•', e:'‚öñÔ∏è', oneLine:"ÊûúÊñ∑ÁÆ°ÁêÜÔºåÂ§©ÁîüÁöÑÊåáÊèÆÂÆò„ÄÇ", teamRole:"Â∞àÊ°àÁ∂ìÁêÜÔºåÁõØÁ∑äÈÄ≤Â∫¶„ÄÇ", careMost:"ÊïàÁéáËàáË¶èÂâá„ÄÇ", coopTips:["Â∞äÈáç‰ªñÂÄëÁöÑÊ¨äÂ®Å","Ê∫ñÊôÇÂõûÂ†±ÈÄ≤Â∫¶"], careerHint:["ÈÅ©ÂêàÁÆ°ÁêÜ„ÄÅË°åÊîøÊàñËªçË≠¶"] },
                'ESFJ': { t:'‰∫∫Ê∞£ÊîØÊü±', e:'ü§ù', oneLine:"ÁÜ±ÂøÉÂä©‰∫∫ÔºåÈáçË¶ñÂúòÈöäÂíåË´ß„ÄÇ", teamRole:"ÂáùËÅöËÄÖÔºåÁÖßÈ°ßÂ§ßÂÆ∂ÊÉÖÁ∑í„ÄÇ", careMost:"Ê≠∏Â±¨ÊÑüËàáË™çÂêå„ÄÇ", coopTips:["Â§öÂèÉËàáÂúòÈ´îÊ¥ªÂãï","ËÇØÂÆö‰ªñÂÄëÁöÑ‰ªòÂá∫"], careerHint:["ÈÅ©ÂêàÊïôËÇ≤„ÄÅÁ§æÂ∑•ÊàñÂÖ¨Èóú"] },
                'ENFJ': { t:'Á≤æÁ•ûÂ∞éÂ∏´', e:'üåª', oneLine:"ÂÖÖÊªøÈ≠ÖÂäõÔºåÊøÄÂãµ‰ªñ‰∫∫ÊàêÈï∑„ÄÇ", teamRole:"Â∞éÂ∏´ÔºåÂºïÂ∞éÂúòÈöäÊñπÂêë„ÄÇ", careMost:"‰ªñ‰∫∫ÁöÑÊàêÈï∑ËàáÂíåË´ß„ÄÇ", coopTips:["ÁúüË™†‰∫§ÊµÅÊÉÖÊÑü","ÊîØÊåÅ‰ªñÂÄëÁöÑÈ°òÊôØ"], careerHint:["ÈÅ©ÂêàÊïôÂ≠∏„ÄÅËºîÂ∞éÊàñÈ†òÂ∞éËÅ∑"] },
                'ENTJ': { t:'Â∏ùÂúãÁµ±Â∏•', e:'üëë', oneLine:"Âº∑Âã¢È†òÂ∞éÔºåÁúãË¶ãÈï∑ÈÅ†Â±ÄÂã¢„ÄÇ", teamRole:"Ê±∫Á≠ñËÄÖÔºåÂ∏∂È†òËÆäÈù©„ÄÇ", careMost:"ÊàêÂ∞±ËàáÂΩ±ÈüøÂäõ„ÄÇ", coopTips:["Â±ïÁèæ‰Ω†ÁöÑËÉΩÂäõ","Ë∑ü‰∏ä‰ªñÂÄëÁöÑÁØÄÂ•è"], careerHint:["ÈÅ©ÂêàÈ´òÈöéÁÆ°ÁêÜ„ÄÅÈáëËûçÊàñÂâµÊ•≠"] }
            }
        };
        const ennData = {
            qs: [
                {q:"ÊúÄÂÆ≥ÊÄï...", a:"ÂÅöÈåØ‰∫ã(1)", b:"Ê≤í‰∫∫ÊÑõ(2)", ta:[1], tb:[2]}, {q:"Â∏åÊúõÂà•‰∫∫...", a:"ËÆöË≥ûÊàêÂ∞±(3)", b:"ÁêÜËß£Áç®Áâπ(4)", ta:[3], tb:[4]},
                {q:"ÈÅáÂ£ìÂäõ...", a:"ÊäΩÈõ¢ÂàÜÊûê(5)", b:"Â∞ãÊ±ÇÂÆâÂÖ®(6)", ta:[5], tb:[6]}, {q:"ÁîüÊ¥ª...", a:"ËøΩÊ±ÇÂø´Ê®Ç(7)", b:"ÊéåÊéßÂ±ÄÈù¢(8)", ta:[7], tb:[8]},
                {q:"‰∫∫Èöõ...", a:"ÈÅøÂÖçË°ùÁ™Å(9)", b:"ÊìöÁêÜÂäõÁà≠(8)", ta:[9], tb:[8]}, {q:"ÂÉπÂÄºËßÄ...", a:"Ê≠£Áõ¥ËàáÂéüÂâá(1)", b:"Èóú‰øÇËàáÈÄ£Áµê(2)", ta:[1], tb:[2]},
                {q:"ÂãïÂäõ‰æÜÊ∫ê...", a:"ÊàêÂäüËàáÁõÆÊ®ô(3)", b:"Áç®ÁâπËàáÊÑèÁæ©(4)", ta:[3], tb:[4]}, {q:"Èù¢Â∞çÂïèÈ°å...", a:"Êî∂ÈõÜË≥áË®ä(5)", b:"Â∞ãÊ±ÇÁõüÂèã(6)", ta:[5], tb:[6]},
                {q:"‰∫∫ÁîüËøΩÊ±Ç...", a:"Ëá™Áî±ËàáÈ´îÈ©ó(7)", b:"ÂíåÂπ≥ËàáÁ©©ÂÆö(9)", ta:[7], tb:[9]}
            ],
            results: [
                null, 
                {t:"ÊîπÈù©ËÄÖ(1)", oneLine:"ËøΩÊ±ÇÂÆåÁæéÁöÑÁêÜÊÉ≥‰∏ªÁæ©ËÄÖ„ÄÇ", motive:"Êää‰∫ãÊÉÖÂÅöÂ∞çÔºåÈÅøÂÖçÁäØÈåØ„ÄÇ", stress:"ËÆäÂæóÈÅéÂ∫¶ÊåëÂâî„ÄÅÊÜ§ÊÄí„ÄÇ", workStrength:["È´òÂìÅË≥™Áî¢Âá∫","Ê•µÂ∫¶Ëá™Âæã"], growthTips:["Á∑¥ÁøíÊé•Âèó„Äå‰∏çÂÆåÁæé„Äç","Áµ¶Ëá™Â∑±ÂíåÂà•‰∫∫Â§öÈªûÂØ¨ÂÆπ"]},
                {t:"Âä©‰∫∫ËÄÖ(2)", oneLine:"Ê∫´ÊöñÊÖ∑ÊÖ®ÔºåÊ∏¥ÊúõË¢´ÊÑõÁöÑ‰ªòÂá∫ËÄÖ„ÄÇ", motive:"Ë¢´ÈúÄË¶ÅÔºåË¢´‰ªñ‰∫∫ÊÑüÊøÄ„ÄÇ", stress:"ËÆäÂæóÊÉÖÁ∑íÂåñ„ÄÅË®éÂ•Ω„ÄÇ", workStrength:["ÂñÑËß£‰∫∫ÊÑè","Ê•µ‰Ω≥ÁöÑÂúòÈöäÂçî‰ΩúËÄÖ"], growthTips:["Â≠∏ÁøíÂïèËá™Â∑±ÔºöÊàëÁèæÂú®ÈúÄË¶Å‰ªÄÈ∫ºÔºü","‰∏çË¶ÅÁÇ∫‰∫ÜÊèõÂèñÊÑõËÄå‰ªòÂá∫"]},
                {t:"ÊàêÂ∞±ËÄÖ(3)", oneLine:"ÁõÆÊ®ôÂ∞éÂêëÔºåÈÅ©ÊáâÂäõÂº∑ÁöÑÂØ¶Ë∏êËÄÖ„ÄÇ", motive:"ÊàêÂäüÔºåË¢´ËÇØÂÆö„ÄÇ", stress:"ËÆäÂæóÂ∑•‰ΩúÁãÇ„ÄÅÂøΩË¶ñÊÉÖÊÑü„ÄÇ", workStrength:["È´òÊïàÁéá","ÂΩ¢Ë±°ÁÆ°ÁêÜ‰Ω≥"], growthTips:["‰Ω†ÁöÑÂÉπÂÄº‰∏çÁ≠âÊñº‰Ω†ÁöÑÊàêÂ∞±","Á∑¥ÁøíÊÖ¢‰∏ã‰æÜ"]},
                {t:"Ëá™ÊàëËÄÖ(4)", oneLine:"Êµ™Êº´ÊïèÊÑüÔºåËøΩÊ±ÇÁç®ÁâπÁöÑËóùË°ìÂÆ∂„ÄÇ", motive:"Áç®‰∏ÄÁÑ°‰∫åÔºåÊ∑±ÂàªÈ´îÈ©ó„ÄÇ", stress:"ËÆäÂæóÊÜÇÈ¨±„ÄÅËá™ÊàëÂ∞ÅÈñâ„ÄÇ", workStrength:["Áç®ÁâπÂØ©Áæé","ÊÉÖÊÑüÊ∑±Â∫¶"], growthTips:["‰∏çË¶ÅÈÅéÂ∫¶ÊîæÂ§ßÊÉÖÁ∑í","ÂæûË°åÂãï‰∏≠Âª∫Á´ãËá™‰ø°"]},
                {t:"Ë™øÊü•Âì°(5)", oneLine:"ÂÜ∑ÈùúËßÄÂØüÔºåÊ±ÇÁü•Ëã•Ê∏¥ÁöÑÊÄùÊÉ≥ÂÆ∂„ÄÇ", motive:"ÁêÜËß£‰∏ñÁïåÔºåÊìÅÊúâÁü•Ë≠ò„ÄÇ", stress:"ËÆäÂæóÂ≠§ÂÉª„ÄÅÊÜ§‰∏ñÂ´â‰øó„ÄÇ", workStrength:["Ê∑±Â∫¶ÂàÜÊûê","ÂÆ¢ËßÄÁêÜÊÄß"], growthTips:["Â§öËàá‰∫∫ÂàÜ‰∫´‰Ω†ÁöÑÊÉ≥Ê≥ï","‰∏çË¶ÅÊ¥ªÂú®ËÖ¶Ë¢ãË£°"]},
                {t:"Âø†Ë™†ËÄÖ(6)", oneLine:"Ë≤†Ë≤¨Ë≠¶Ë¶∫ÔºåÂ∞ãÊ±ÇÂÆâÂÖ®ÁöÑÂÆàË≠∑ËÄÖ„ÄÇ", motive:"ÂÆâÂÖ®ÊÑüÔºåË¢´ÊîØÊåÅ„ÄÇ", stress:"ËÆäÂæóÁÑ¶ÊÖÆ„ÄÅÂ§öÁñë„ÄÇ", workStrength:["È¢®Èö™ÊéßÁÆ°","Âø†Ë™†ÂèØÈù†"], growthTips:["Áõ∏‰ø°Ëá™Â∑±ÁöÑÂÖßÂú®ÊåáÂºï","ÂçÄÂàÜ„ÄåËÖ¶Ë£ú„ÄçËàáÁèæÂØ¶"]},
                {t:"ÁÜ±ÊÉÖËÄÖ(7)", oneLine:"Ê®ÇËßÄÂ§öÊâçÔºåËøΩÊ±ÇÂø´Ê®ÇÁöÑÂÜíÈö™ÂÆ∂„ÄÇ", motive:"Âø´Ê®ÇÔºåÈÅøÂÖçÁóõËã¶„ÄÇ", stress:"ËÆäÂæóË°ùÂãï„ÄÅÈÄÉÈÅøÂïèÈ°å„ÄÇ", workStrength:["ÂâµÊÑèÁÑ°Èôê","Âø´ÈÄüÂ≠∏Áøí"], growthTips:["Á∑¥ÁøíÂ∞àÊ≥®ÂÆåÊàê‰∏Ä‰ª∂‰∫ã","Èù¢Â∞çË≤†Èù¢ÊÉÖÁ∑íËÄå‰∏çÈÄÉÈÅø"]},
                {t:"ÊåëÊà∞ËÄÖ(8)", oneLine:"Ëá™‰ø°ÊûúÊñ∑ÔºåÊÑèÂøóÂ†ÖÂº∑ÁöÑÈ†òË¢ñ„ÄÇ", motive:"ÊéåÊéßÂ±ÄÈù¢Ôºå‰øùË≠∑Ëá™Â∑±‰∫∫„ÄÇ", stress:"ËÆäÂæóÁç®Ë£Å„ÄÅÂÖ∑ÊîªÊìäÊÄß„ÄÇ", workStrength:["Ê±∫Á≠ñÊûúÊñ∑","ËÉΩÊâøÊìîÈáç‰ªª"], growthTips:["Â±ïÁèæËÑÜÂº±‰∏çÊòØËªüÂº±","Â≠∏ÁøíÊ∫´ÊüîÁöÑÊ∫ùÈÄö"]},
                {t:"ÂíåÂπ≥ËÄÖ(9)", oneLine:"Èö®ÂíåÂåÖÂÆπÔºåËøΩÊ±ÇÂíåË´ßÁöÑË™øÂÅúËÄÖ„ÄÇ", motive:"ÂÖßÂøÉÂπ≥ÈùúÔºåÈÅøÂÖçË°ùÁ™Å„ÄÇ", stress:"ËÆäÂæóÊá∂Êï£„ÄÅË¢´ÂãïÊîªÊìä„ÄÇ", workStrength:["Êé•Á¥çÂ∫¶È´ò","ÂæàÂ•ΩÁöÑÂÇæËÅΩËÄÖ"], growthTips:["Á∑¥ÁøíË°®ÈÅîÁúüÂØ¶ÁöÑÊÜ§ÊÄí","Ë®≠ÂÆöÂÖ∑È´îÁõÆÊ®ô‰∏¶Ë°åÂãï"]}
            ]
        };
        const riasecData = {
            qs: [{q:"‰øÆÁêÜÈõªÂô®",t:'R'}, {q:"ÂàÜÊûêÊï∏Êìö",t:'I'}, {q:"Áπ™Áï´Ë®≠Ë®à",t:'A'}, {q:"ÊïôÂ∞é‰ªñ‰∫∫",t:'S'}, {q:"Êé®Èä∑Áî¢ÂìÅ",t:'E'}, {q:"Êï¥ÁêÜÊñá‰ª∂",t:'C'}, {q:"Êìç‰ΩúÊ©üÊ¢∞",t:'R'}, {q:"Ëß£Ê±∫Êï∏Â≠∏È°å",t:'I'}, {q:"ÊºîÂ•èÊ®ÇÂô®",t:'A'}, {q:"ÁÖßÈ°ßÁóÖ‰∫∫",t:'S'}, {q:"Á´∂ÈÅ∏ÂππÈÉ®",t:'E'}, {q:"Âà∂ÂÆöË®àÁï´",t:'C'}],
            results: { 
                'R': { name:"ÂØ¶‰ΩúÂûã (R)", oneLine:"ÂñúÊ≠°ÂãïÊâãÂÅöÔºåÊØîË™™‰∏ÄÂ†ÜÊúâÊÑü„ÄÇ", workEnv:["‰ΩøÁî®Â∑•ÂÖ∑ÊàñÊ©üÊ¢∞","ÂÖ∑È´îÊòéÁ¢∫ÁöÑ‰ªªÂãô"], suggest:["Â∞ãÊâæÂ∑•Á®ã„ÄÅÊäÄË°ìÈ°ûÂ∑•‰Ωú"] },
                'I': { name:"Á†îÁ©∂Âûã (I)", oneLine:"ÂñúÊ≠°ÊÄùËÄÉÂàÜÊûêÔºåÁêÜÊÄßËß£Ê±∫ÂïèÈ°å„ÄÇ", workEnv:["Â≠∏Ë°ìÁ†îÁ©∂","Áç®Á´ãÊÄùËÄÉÁöÑÁ©∫Èñì"], suggest:["Â∞ãÊâæÁ†îÁôº„ÄÅÊï∏ÊìöÂàÜÊûêÂ∑•‰Ωú"] },
                'A': { name:"ËóùË°ìÂûã (A)", oneLine:"ËøΩÊ±ÇÁç®ÁâπÔºåÁî®Ââµ‰ΩúË°®ÈÅîËá™Êàë„ÄÇ", workEnv:["Ëá™Áî±ÂΩàÊÄß","ÂÖÅË®±ÂâµÊÑèÁôºÊèÆ"], suggest:["Â∞ãÊâæË®≠Ë®à„ÄÅÂâµ‰Ωú„ÄÅÂ™íÈ´îÂ∑•‰Ωú"] },
                'S': { name:"Á§æ‰∫§Âûã (S)", oneLine:"ÁÜ±ÂøÉÂä©‰∫∫ÔºåÂñúÊ≠°Ëàá‰∫∫‰∫íÂãï„ÄÇ", workEnv:["ÂúòÈöäÂêà‰Ωú","ÊúçÂãô‰ªñ‰∫∫"], suggest:["Â∞ãÊâæÊïôËÇ≤„ÄÅË´ÆÂïÜ„ÄÅÊúçÂãôÊ•≠"] },
                'E': { name:"‰ºÅÊ•≠Âûã (E)", oneLine:"ÂñúÊ≠°È†òÂ∞éË™™ÊúçÔºåËøΩÊ±ÇÁõÆÊ®ô„ÄÇ", workEnv:["Á´∂Áà≠ÊÄß","ÁÆ°ÁêÜËÅ∑‰Ωç"], suggest:["Â∞ãÊâæÊ•≠Âãô„ÄÅË°åÈä∑„ÄÅÁÆ°ÁêÜÂ∑•‰Ωú"] },
                'C': { name:"‰∫ãÂãôÂûã (C)", oneLine:"ÂñúÊ≠°Ë¶èÂæãÔºåË¨πÊÖéËôïÁêÜÁ¥∞ÁØÄ„ÄÇ", workEnv:["SOPÊòéÁ¢∫","‰∫ïÁÑ∂ÊúâÂ∫è"], suggest:["Â∞ãÊâæË°åÊîø„ÄÅÊúÉË®à„ÄÅÂìÅÁÆ°Â∑•‰Ωú"] }
            }
        };
        const colorMeanings = { 
            4: { label:"Á¥ÖËâ≤", want:"Ë°åÂãïËàáÂæÅÊúç", state:"‰Ω†ÊúÄËøëÂÖÖÊªøÊ¥ªÂäõÔºåÊÉ≥Ë¶ÅË°ùÁ†¥ÁèæÁãÄ„ÄÇ", selfCare:["ÊâæÂÄãÂÆâÂÖ®ÁöÑÊåëÊà∞‰æÜÈáãÊîæËÉΩÈáè","ÈÅãÂãï"] },
            5: { label:"ÈªÉËâ≤", want:"Â∏åÊúõËàáÂø´Ê®Ç", state:"‰Ω†ÂöÆÂæÄÊú™‰æÜÔºåÂ∞ãÊ±ÇÊñ∞ÁöÑÂèØËÉΩÊÄß„ÄÇ", selfCare:["ÂéªÊóÖË°åÊàñÂ≠∏ÁøíÊñ∞‰∫ãÁâ©","Êõ¨Â§™ÈôΩ"] },
            3: { label:"Á∂†Ëâ≤", want:"Â†ÖÊåÅËàáËá™Â∞ä", state:"‰Ω†Â†ÖÊåÅËá™Â∑±ÁöÑÂéüÂâáÔºåÊ∏¥ÊúõË¢´Ë™çÂêå„ÄÇ", selfCare:["ËÇØÂÆöËá™Â∑±ÁöÑÂÉπÂÄº","ÈÅ©Â∫¶ÊîæÈ¨ÜÊ®ôÊ∫ñ"] },
            2: { label:"ËóçËâ≤", want:"Âπ≥ÈùúËàáÂÆâÂØß", state:"‰Ω†Ê∏¥Êúõ‰ºëÊÅØÔºåÈáçË¶ñÊ∑±Â±§ÊÉÖÊÑü„ÄÇ", selfCare:["È´òÂìÅË≥™ÁöÑÁù°Áú†","ËàáÁü•Â∑±Ê∑±Ë´á"] },
            6: { label:"Á¥´Ëâ≤", want:"Á•ûÁßòËàáÂπªÊÉ≥", state:"‰Ω†ÊÑüË¶∫ÊïèÈä≥ÔºåËøΩÊ±ÇÁ≤æÁ•ûÂ±§Ê¨°„ÄÇ", selfCare:["Êé•Ëß∏ËóùË°ì","ÂÜ•ÊÉ≥"] },
            7: { label:"Ê£ïËâ≤", want:"ÊÑüÂÆòËàíÈÅ©", state:"‰Ω†ÈáçË¶ñË∫´È´îÊÑüÂèóÔºåËøΩÊ±ÇÂÆâÁ©©„ÄÇ", selfCare:["ÂêÉÈ†ìÁæéÈ£ü","Ê≥°ÁÜ±Ê∞¥Êæ°"] },
            1: { label:"ÁÅ∞Ëâ≤", want:"ÈöîÈõ¢Ëàá‰øùË≠∑", state:"‰Ω†ÊÉ≥Êö´ÊôÇÈö±ÂΩ¢ÔºåËàáÂ£ìÂäõ‰øùÊåÅË∑ùÈõ¢„ÄÇ", selfCare:["Áç®Ëôï","Ê∏õÂ∞ëÁ§æ‰∫§"] },
            8: { label:"ÈªëËâ≤", want:"ÊäóÊãíËàáÊéåÊéß", state:"‰Ω†ÂèØËÉΩÊÑüÂà∞ÂèóÂ£ìÔºåË°®ÁèæÂá∫ÂÄîÂº∑„ÄÇ", selfCare:["ÈáãÊîæÊéßÂà∂Ê¨≤","ÂÖÅË®±‰∫ãÊÉÖËá™ÁÑ∂ÁôºÁîü"] }
        };
        const animalData = {
            qs: [{q:"ÁúãÈáç...", a:"ÁõÆÊ®ô(‰∫ã)", b:"Èóú‰øÇ(‰∫∫)", ax:'x', v:-1}, {q:"Ê≠•Ë™ø...", a:"Âø´", b:"ÊÖ¢", ax:'y', v:-1}, {q:"ÈÅáÂïèÈ°å...", a:"Áõ¥Êé•Ëß£Ê±∫", b:"Â∞ãÊ±ÇÂÖ±Ë≠ò", ax:'x', v:-1}, {q:"ÂúòÈ´î‰∏≠...", a:"‰∏ªÂ∞éÁôºË®Ä", b:"ÂÇæËÅΩÈÖçÂêà", ax:'y', v:-1}],
            results: { 
                'D': { t:"ËÄÅËôé (ÊîØÈÖçÂûã)", e:"üêØ", oneLine:"Ë¨õË©±Áõ¥„ÄÅÂæàÊï¢Ë°ùÁöÑÁõÆÊ®ôÊ¥æ„ÄÇ", commStyle:"Áõ¥Êà™‰∫ÜÁï∂Ôºå‰∏çÂñúÊ≠°ÁπûÂúàÂ≠ê„ÄÇ", beMisunderstood:"Â∏∏Ë¢´Ë¶∫ÂæóÂ§™ÂÖáÊàñÊ≤íËÄêÂøÉ„ÄÇ", coopTips:["Ë¨õÈáçÈªûÔºå‰∏çË¶ÅÊµ™Ë≤ªÊôÇÈñì","ËÆì‰ªñÁï∂ÈöäÈï∑"], selfAdjust:["Á∑¥ÁøíÂ§öËÅΩÂà•‰∫∫Ë¨õÂÆå","ÈñãÂè£ÂâçÂÖàÊ∑±ÂëºÂê∏"] },
                'I': { t:"Â≠îÈõÄ (ÂΩ±ÈüøÂûã)", e:"ü¶ö", oneLine:"ÁÜ±ÊÉÖÊ¥ãÊ∫¢ÔºåÁ§æ‰∫§Â†¥ÁöÑÁÑ¶Èªû„ÄÇ", commStyle:"ÁîüÂãïÊúâË∂£ÔºåÂñúÊ≠°ËÇ¢È´îË™ûË®Ä„ÄÇ", beMisunderstood:"Â∏∏Ë¢´Ë¶∫ÂæóÂè™ÊúÉË™™‰∏çÊúÉÂÅö„ÄÇ", coopTips:["Áµ¶‰ªñËàûÂè∞ÂíåËÆöÁæé","Âπ´‰ªñÊ≥®ÊÑèÁ¥∞ÁØÄ"], selfAdjust:["Á∑¥ÁøíÊääÁ¥∞ÁØÄË®ò‰∏ã‰æÜ","Ë™™Âà∞Ë¶ÅÂÅöÂà∞"] },
                'S': { t:"ÁÑ°Â∞æÁÜä (Á©©ÂÅ•Âûã)", e:"üê®", oneLine:"Ê∫´ÂíåÂèãÂñÑÔºåÂèØÈù†ÁöÑÈöäÂèã„ÄÇ", commStyle:"Ê∫´ÂíåÂ©âËΩâÔºå‰∏çÂñúÊ≠°Ë°ùÁ™Å„ÄÇ", beMisunderstood:"Â∏∏Ë¢´Ë¶∫ÂæóÊ≤í‰∏ªË¶ã„ÄÇ", coopTips:["Áµ¶‰ªñÂÆâÂÖ®ÊÑüÂíåÊôÇÈñì","‰∏çË¶ÅÂÇ¨‰øÉ‰ªñ"], selfAdjust:["Á∑¥ÁøíË°®ÈÅîËá™Â∑±ÁöÑÈúÄÊ±Ç","ÈÅ©ÊôÇË™™Âá∫ÂèçÂ∞çÊÑèË¶ã"] },
                'C': { t:"Ë≤ìÈ†≠È∑π (ÂàÜÊûêÂûã)", e:"ü¶â", oneLine:"Á≤æÊ∫ñÂö¥Ë¨πÔºåÈÇèËºØÁöÑËøΩÊ±ÇËÄÖ„ÄÇ", commStyle:"Ë¨õÊ±ÇË≠âÊìöÔºåÈáçË¶ñÈÇèËºØ„ÄÇ", beMisunderstood:"Â∏∏Ë¢´Ë¶∫ÂæóÂ§™ÈæúÊØõÊàñÂÜ∑Êº†„ÄÇ", coopTips:["ÊèêÂá∫Êï∏ÊìöÂíå‰∫ãÂØ¶","Â∞äÈáç‰ªñÁöÑÊ®ôÊ∫ñ"], selfAdjust:["Á∑¥ÁøíÊé•Âèó‰∏çÂÆåÁæé","Â§öË°®ÈÅîËÇØÂÆö"] }
            }
        };
        // --- ÈÅäÊà≤ÁãÄÊÖãÁÆ°ÁêÜ ---
        const journey = {
            order: ['BIG5', 'MBTI', 'ENNEAGRAM', 'RIASEC', 'ANIMAL', 'COLOR'],
            idx: 0
        };
        const lobbyNodes = [ { id: 'BIG5' }, { id: 'MBTI' }, { id: 'ENNEAGRAM' }, { id: 'RIASEC' }, { id: 'ANIMAL' }, { id: 'COLOR' } ];
        lobbyNodes.forEach(n => Object.assign(n, styles.nodes[n.id]));

        let gameSt = { 
            big5: {idx:0, ans:3, scores:{O:0,C:0,E:0,A:0,N:0}, done:false, sent:false}, 
            mbti: {idx:0, scores:{ei:0,sn:0,tf:0,jp:0}, done:false, sent:false}, 
            enn: {idx:0, scores:new Array(10).fill(0), done:false, sent:false}, 
            riasec: {idx:0, scores:{R:0,I:0,A:0,S:0,E:0,C:0}, done:false, sent:false}, 
            color: {phase:0, sel:[], auraT:0, done:false, sent:false}, 
            animal: {idx:0, pos:{x:0, y:0}, done:false, sent:false} 
        };
        function getGameStKey(id) {
            if (id === 'ENNEAGRAM') return 'enn';
            return id.toLowerCase();
        }

        // --- ÂàùÂßãÂåñÁ≥ªÁµ± ---
        function getSafeHeight() { return window.visualViewport ? window.visualViewport.height : window.innerHeight; }
        
        function init() {
            dpr = window.devicePixelRatio || 1;
            width = window.visualViewport ? window.visualViewport.width : window.innerWidth;
            height = getSafeHeight();
            canvas.style.width = width + "px";
            canvas.style.height = height + "px";
            canvas.width = width * dpr; 
            canvas.height = height * dpr;
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            isMobile = width < 768;
            initStars();

            // v1.0 Narrative Opening Check
            const hasVisited = localStorage.getItem('mindverse_visited');
            if (!hasVisited) {
                const rIdx = Math.floor(Math.random() * openingTexts.length);
                triggerWorldMsg('OPENING', openingTexts[rIdx]);
                localStorage.setItem('mindverse_visited', 'true');
            }
        }

        const stars = []; const shootingStars = [];
        function initStars() { stars.length = 0; for(let i=0; i<150; i++) stars.push({ x: Math.random()*width, y: Math.random()*height, z: Math.random()*2+0.5, size: Math.random()*1.5, alpha: Math.random() }); }
        
        class ShootingStar { 
            constructor(){this.reset();} 
            reset(){this.x=Math.random()*width;this.y=Math.random()*height*0.5;this.len=Math.random()*80+20;this.speed=Math.random()*15+10;this.size=Math.random()*2;this.angle=Math.PI/4;this.active=true;this.life=1;} 
            update(){this.x-=this.speed;this.y+=this.speed;this.life-=0.02;if(this.x<-100||this.y>height+100||this.life<=0)this.active=false;} 
            draw(){if(!this.active)return;const tx=this.x+this.len*Math.cos(this.angle);const ty=this.y-this.len*Math.sin(this.angle);const g=ctx.createLinearGradient(this.x,this.y,tx,ty);g.addColorStop(0,'rgba(255,255,255,'+this.life+')');g.addColorStop(1,'rgba(255,255,255,0)');ctx.strokeStyle=g;ctx.lineWidth=this.size;ctx.beginPath();ctx.moveTo(this.x,this.y);ctx.lineTo(tx,ty);ctx.stroke();} 
        }

        window.addEventListener("resize", () => setTimeout(init, 150));
        window.addEventListener('deviceorientation', (e) => { if(e.gamma && e.beta) { gyro.x = e.gamma * 2; gyro.y = (e.beta - 45) * 2; } });
        
        // --- Ëº∏ÂÖ•ËôïÁêÜ & ÊªæÂãïÈÇèËºØ ---
        const getPos = (e) => { const r = canvas.getBoundingClientRect(); return { x: e.clientX - r.left, y: e.clientY - r.top }; };
        const handleInput = (x, y, isClick) => {
            if(isClick) mouse.down = true;
            mouse.x = x; mouse.y = y;
            let worldX = x, worldY = y;
            if (currentScene === 'LOBBY') { 
                worldX = (x - width/2) / camera.zoom + width/2 + camera.x;
                worldY = (y - height/2) / camera.zoom + height/2 + camera.y;
            }
            let found = false;
            // Summary È†ÅÈù¢ÁöÑÊåâÈàï (‰∏çÂèó Clipping ÂΩ±Èüø)
            if (currentScene === 'SUMMARY' && hitZones.length > 0) {
                 for (let z of hitZones) {
                    let hit = (worldX >= z.x && worldX <= z.x+z.w && worldY >= z.y && worldY <= z.y+z.h);
                    if (hit) {
                        document.body.style.cursor = 'pointer';
                        found = true;
                        if (isClick && z.action) { z.action(); return; }
                    }
                 }
            } else {
                for (let z of hitZones) {
                    let hit = false;
                    if (z.t === 'circle') hit = Math.hypot(worldX - z.x, worldY - z.y) < z.r;
                    else hit = (worldX >= z.x && worldX <= z.x+z.w && worldY >= z.y && worldY <= z.y+z.h);
                    if (hit) { 
                        document.body.style.cursor = 'pointer';
                        found = true; 
                        if (isClick && z.action) { z.action(worldX, worldY); return; } 
                    }
                }
            }
            if(!found) document.body.style.cursor = 'default';
        };

        // Scroll Event Listeners
        canvas.addEventListener('touchstart', e => { 
            e.preventDefault(); 
            const p = getPos(e.touches[0]); 
            touchStartY = p.y;
            isDragging = true;
            handleInput(p.x, p.y, true); 
        }, {passive:false});
        canvas.addEventListener('touchmove', e => { 
            e.preventDefault(); 
            const p = getPos(e.touches[0]);
            
            if (currentScene === 'SUMMARY' && isDragging) {
                const dy = p.y - touchStartY;
                touchStartY = p.y;
                summaryScrollY -= dy;
                const viewH = height - SAFE_TOP - SAFE_BOTTOM - 150; 
                const maxScroll = Math.max(0, summaryContentHeight - viewH + 50);
                if(summaryScrollY < 0) summaryScrollY = 0;
                if(summaryScrollY > maxScroll) summaryScrollY = maxScroll;
            }
            
            handleInput(p.x, p.y, false); 
        }, {passive:false});
        canvas.addEventListener('touchend', () => { isDragging = false; mouse.down = false; });
        canvas.addEventListener('mousemove', e => { const p=getPos(e); handleInput(p.x, p.y, false); });
        canvas.addEventListener('mousedown', e => { const p=getPos(e); handleInput(p.x, p.y, true); });
        canvas.addEventListener('mouseup', () => mouse.down=false);

        // --- Âº∑ÂäõË§áË£ΩÂ∑•ÂÖ∑ (Robust Copy Tool) ---
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text)
                    .then(() => alert("‚úÖ Â∑≤Ë§áË£ΩÔºÅË´ãÈñãÂïü Instagram ÁßÅË®ä @jobus ÂÆòÊñπÂ∏≥Ëôü"))
                    .catch(err => {
                        console.error('API Copy failed, trying fallback', err);
                        fallbackCopy(text);
                    });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; 
            textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if(successful) alert("‚úÖ Â∑≤Ë§áË£ΩÔºÅË´ãÈñãÂïü Instagram ÁßÅË®ä @jobus ÂÆòÊñπÂ∏≥Ëôü");
                else alert("‚ö†Ô∏è Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÊà™Âúñ");
            } catch (err) {
                alert("‚ö†Ô∏è Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÊà™Âúñ");
            }
            document.body.removeChild(textArea);
        }

        // --- Trigger World Message (FSM) ---
        function triggerWorldMsg(newState, customText) {
            // [Guard] Â¶ÇÊûúÊ≠£ËôïÊñºÈñãÂ†¥Â∫èÂàóÔºåÁ¶ÅÊ≠¢‰ªª‰ΩïÊâìÊñ∑ (Èò≤ÂëÜ)
            if (worldMsg.state === 'OPENING') return;
            
            // ÈÅøÂÖçÂú®Ê∑°Âá∫ÊàñÂ∑≤È°ØÁ§∫ÊôÇÈáçË§áËß∏Áôº
            if(worldMsg.state !== 'IDLE' && worldMsg.state !== 'FADE_OUT') return;
            
            worldMsg.state = newState;
            worldMsg.text = customText;
            worldMsg.alpha = 0;
            // Timer: FadeIn ~0.3s (20 frames) + Hold ~2s (120 frames)
            worldMsg.timer = 140; 
        }

        // --- ÈÅäÊà≤Âæ™Áí∞ ---
        function loop() {
            camera.zoom += (camera.targetZoom - camera.zoom)*0.05;
            camera.x += (camera.targetX - camera.x)*0.05; camera.y += (camera.targetY - camera.y)*0.05;
            ctx.clearRect(0,0,width,height); hitZones=[];
            
            // World Msg Update Logic (FSM)
            if(currentScene === 'LOBBY') {
                if(worldMsg.state === 'OPENING' || worldMsg.state === 'HINT') {
                    // Fade In Phase
                    if (worldMsg.alpha < 1 && worldMsg.timer > 120) {
                        worldMsg.alpha += 0.05;
                        if(worldMsg.alpha > 1) worldMsg.alpha = 1;
                    }
                    // Hold Phase
                    worldMsg.timer--;
                    if(worldMsg.timer <= 20) {
                        worldMsg.state = 'FADE_OUT';
                    }
                } else if(worldMsg.state === 'FADE_OUT') {
                    worldMsg.alpha -= 0.05;
                    if(worldMsg.alpha <= 0) {
                        worldMsg.alpha = 0;
                        worldMsg.state = 'IDLE';
                    }
                }
            }

            drawStars();
            
            if(currentScene==='LOBBY'||currentScene==='TRANSITION') {
                ctx.save(); ctx.translate(width/2, height/2);
                ctx.scale(camera.zoom, camera.zoom); ctx.translate(-width/2-camera.x, -height/2-camera.y);
                
                // Layer 3: Planets (Âèó Camera ÂΩ±Èüø)
                drawLobbyPlanets(); 
                
                ctx.restore();
                
                // Layer 1 & 2: UI & World Msg (‰∏çÂèó Camera ÂΩ±Èüø)
                if(currentScene === 'LOBBY') drawLobbyUI();

            } else if (currentScene === 'SUMMARY') {
                drawSummary();
            } else {
                if(currentScene==='BIG5') drawBig5();
                else if(currentScene==='MBTI') drawMBTI(); 
                else if(currentScene==='ENNEAGRAM') drawEnneagram();
                else if(currentScene==='RIASEC') drawRIASEC(); 
                else if(currentScene==='COLOR') drawColorTest(); 
                else if(currentScene==='ANIMAL') drawAnimalTest();
            }
            requestAnimationFrame(loop);
        }

        // --- Áπ™ÂúñÂºïÊìé (Helper Functions) ---
        function wrapText(txt, x, y, maxW, lh) {
            if(!txt) return y;
            const chars = txt.split(''); let line = ''; let cy = y;
            for(let n=0; n<chars.length; n++) {
                const test = line + chars[n];
                if(ctx.measureText(test).width > maxW && n > 0) { ctx.fillText(line, x, cy); line = chars[n]; cy += lh;
                } else { line = test; }
            }
            ctx.fillText(line, x, cy);
            return cy + lh; 
        }

        function drawSectionTitle(title, x, y, color='#fff') {
            ctx.fillStyle = color;
            ctx.font = (isMobile ? 'bold 20px' : 'bold 22px') + ' "Noto Sans TC"'; ctx.textAlign = 'left'; ctx.fillText(title, x, y);
            return y + 35;
        }

        function drawBulletList(list, x, y, maxW, lh=24) {
            ctx.textAlign = 'left';
            ctx.font = '16px "Noto Sans TC"'; ctx.fillStyle = '#ddd'; let cy = y;
            if(!list || list.length===0) return cy;
            list.forEach(item => {
                const bullet = "‚Ä¢ "; const chars = item.split(''); let line = bullet;
                for(let n=0; n<chars.length; n++) {
                    const test = line + chars[n];
                    if(ctx.measureText(test).width > maxW && n>0) 
                    { ctx.fillText(line, x, cy); line = "  " + chars[n]; cy += lh; } else { line = test; }
                }
                ctx.fillText(line, x, cy); cy += lh * 1.2;
            });
            return cy + 10;
        }

        function drawCard(x, y, w, h, t, txt, c, act) { 
            const hover=Math.abs(mouse.x - x) < w/2 && Math.abs(mouse.y - (y+h/2)) < h/2;
            ctx.strokeStyle=hover?c:'#555'; ctx.lineWidth=2; ctx.fillStyle=hover?'rgba(255,255,255,0.12)':'rgba(30,30,30,0.85)';
            ctx.beginPath(); ctx.roundRect(x-w/2, y, w, h, 15); ctx.fill(); ctx.stroke();
            ctx.fillStyle=c; ctx.font='30px Orbitron'; ctx.textAlign='center'; ctx.fillText(t, x, y+45);
            ctx.fillStyle='#fff';
            ctx.font='20px "Noto Sans TC"'; wrapText(txt, x, y+85, w-40, 26);
            hitZones.push({t:'rect', x:x-w/2, y:y, w:w, h:h, action:act});
        }

        function drawBtn(x, y, txt, color, act, w=200) {
            const h=50;
            const hover = Math.abs(mouse.x - x) < w/2 && Math.abs(mouse.y - (y+h/2)) < h/2;
            ctx.fillStyle=hover?'#fff':color; ctx.beginPath();
            ctx.roundRect(x-w/2, y, w, h, 25); ctx.fill();
            ctx.fillStyle=hover?'#000':'#fff'; ctx.textAlign='center'; ctx.font='bold 18px "Noto Sans TC"'; ctx.fillText(txt, x, y+32);
            hitZones.push({t:'rect', x:x-w/2, y:y, w:w, h:h, action:act});
        }

        function drawTitle(txt, x, y, color) { 
            ctx.textAlign='center';
            ctx.fillStyle=color; ctx.font='bold 32px "Noto Sans TC"'; ctx.shadowColor=color; ctx.shadowBlur=20; ctx.fillText(txt, x, y); ctx.shadowBlur=0;
        }

        function drawProgress(curr, total) { 
            ctx.textAlign='right';
            ctx.fillStyle='#00f3ff'; ctx.font='16px Orbitron'; ctx.fillText(`${curr}/${total}`, width-20, SAFE_TOP + 20);
        }

        // --- LOBBY Áπ™Ë£ΩÈÇèËºØ (v1.0 Narrative Edition) ---
        let lobbyRot = 0;
        const WORLD_MSG_RADIUS = Math.min(window.visualViewport ? window.visualViewport.width : window.innerWidth, window.visualViewport ? window.visualViewport.height : window.innerHeight) * 0.18;
        
        function drawLobbyUI() {
            // 1. Layer 1: Header (Âõ∫ÂÆöÈ†ÇÈÉ®)
            ctx.textAlign = 'center';
            ctx.textBaseline = 'alphabetic'; 
            ctx.fillStyle = 'rgba(255,255,255,0.95)';
            ctx.font = 'bold 24px "Noto Sans TC"'; 
            ctx.fillText("ÂøÉÁêÜÂÆáÂÆô Mindverse", width/2, SAFE_TOP + 30);
            
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.font = '14px "Noto Sans TC"';
            ctx.fillText("Êé¢Á¥¢‰Ω†ÁöÑÊÄßÊ†ºËªåÈÅìÔºåËÄå‰∏çÊòØ‰∏ÄÂºµÂàÜÊï∏Ë°®", width/2, SAFE_TOP + 55);

            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.font = '12px "Noto Sans TC"';
            ctx.fillText("ÂõûÁ≠î‰∏ÄÁ≥ªÂàóÁ∞°Áü≠ÁöÑÁõ¥Ë¶∫ÈÅ∏Êìá", width/2, SAFE_TOP + 80);
            ctx.fillText("ÁúãÁúã‰Ω†Âπ≥Â∏∏ÊòØÁî®Âì™‰∏ÄÂ•óÊÄßÊ†ºÂ∞éËà™Á≥ªÁµ±Âú®ÂÅöÊ±∫ÂÆö", width/2, SAFE_TOP + 98);

            // 2. Layer 2: Central World Message (Ê≠£‰∏≠Â§Æ - Safe Zone)
            if(worldMsg.alpha > 0) {
                ctx.save();
                
                // Ë®≠ÂÆöÊ®£ÂºèÔºöÁ¥îÁôΩ„ÄÅÁÑ°Èô∞ÂΩ±„ÄÅÈ´òÂèØËÆÄÊÄß
                ctx.globalAlpha = worldMsg.alpha * 0.9; // Max alpha 0.9
                ctx.fillStyle = '#FFFFFF';
                // Â≠óÈ´îÂ§ßÂ∞èÊéßÂà∂
                const msgFontSize = isMobile ? 15 : 16;
                ctx.font = `400 ${msgFontSize}px "Noto Sans TC"`; 
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle'; 
                ctx.shadowBlur = 0; 

                // Â§öË°åËôïÁêÜÈÇèËºØ
                const lines = worldMsg.text.split('\n');
                const lineHeight = 28; // Ë°åË∑ù

                lines.forEach((line, i) => {
                    const yOffset = (i - (lines.length - 1) / 2) * lineHeight;
                    ctx.fillText(line, width/2, height/2 + yOffset);
                });

                ctx.restore();
            }

            // 3. Footer (Â∫ïÈÉ®ÁâàÊ¨ä)
            if(camera.zoom < 1.5) {
                ctx.textBaseline = 'alphabetic';
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                ctx.font = '12px Orbitron'; ctx.textAlign = 'center';
                ctx.fillText("Copyright ¬© JOBUS ASIA 2025-26", width/2, height - SAFE_BOTTOM/2);
            }
        }

        function drawLobbyPlanets() {
            lobbyRot += 0.0005; const cx=width/2, cy=height/2;
            const r = Math.min(width, height) * (isMobile ? 0.35 : 0.32);
            
            // ËªåÈÅìÁ∑ö
            ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.strokeStyle='rgba(255,255,255,0.05)';
            ctx.lineWidth=1; ctx.stroke();
            
            // ÂøÉË∑≥ÁØÄÂ•è (ÂÉÖÁî®Êñº Active)
            const pulse = (Math.sin(Date.now() * 0.003) + 1) / 2; // 0 ~ 1
            const activeScale = 1.0 + pulse * 0.06; // 1.0 ~ 1.06
            const activeGlow = 0.6 + pulse * 0.4; // 0.6 ~ 1.0

            lobbyNodes.forEach((node, i) => {
                const ang=(i/6)*Math.PI*2+lobbyRot; const nx=cx+Math.cos(ang)*r; const ny=cy+Math.sin(ang)*r;
                const wx=(mouse.x-width/2)/camera.zoom+width/2+camera.x; const wy=(mouse.y-height/2)/camera.zoom+height/2+camera.y;
                const hover=Math.hypot(wx-nx, wy-ny)<60;

                const myOrder = journey.order.indexOf(node.id);
                
                let state = 'LOCKED';
                if (myOrder < journey.idx) state = 'DONE';
                else if (myOrder === journey.idx) state = 'ACTIVE';

                // Âè™Êúâ Active ÊâçÊúâÂãïÁï´ÂèÉÊï∏
                let currentScale = 1.0;
                let currentGlow = 0;
                
                if (state === 'ACTIVE') {
                    currentScale = activeScale;
                    currentGlow = activeGlow;
                }

                drawPlanetIcon(node, nx, ny, hover, state, currentScale, currentGlow);

                // Interaction Logic
                const touchR = 60;
                if(state === 'ACTIVE') {
                    if (camera.zoom < 2) {
                        hitZones.push({t:'circle', x:nx, y:ny, r:touchR, action:()=>enterGame(node.id, nx, ny)});
                        
                        // --- Vector Pointer Logic ---
                        // 1. Ë®àÁÆóÂæûÊòüÁêÉÊåáÂêë‰∏≠ÂøÉÁöÑÂñÆ‰ΩçÂêëÈáè
                        const dx = cx - nx;
                        const dy = cy - ny;
                        const dist = Math.hypot(dx, dy);
                        const ux = dx / dist; // Unit X
                        const uy = dy / dist; // Unit Y

                        // 2. ‰ΩçÁΩÆÔºöÂæûÊòüÁêÉ‰∏≠ÂøÉÂæÄÁï´Èù¢‰∏≠ÂøÉÂª∂‰º∏ (ÂçäÂæë + ÈñìË∑ù)
                        const pOffset = (isMobile ? 44 : 50) + 12;
                        const px = nx + ux * pOffset;
                        const py = ny + uy * pOffset;

                        // 3. ÊóãËΩâÔºö‰∏âËßíÂΩ¢Â∞ñÁ´ØÊåáÂêë‰∏≠ÂøÉ
                        // Math.atan2(dy, dx) ÊòØÊåáÂêë‰∏≠ÂøÉÁöÑËßíÂ∫¶
                        // ÊàëÂÄëË¶ÅÁï´ "‚ñº"ÔºåÂÆÉÁöÑÂ∞ñÁ´ØÊòØÊúù‰∏ã (PI/2)
                        // ÊâÄ‰ª•ÈúÄË¶ÅÊóãËΩâ angle - PI/2
                        const angle = Math.atan2(dy, dx);
                        
                        // 4. ÂëºÂê∏ÂãïÁï´ (Scale only)
                        const ptrScale = 1.0 + Math.sin(Date.now() * 0.003) * 0.08;

                        ctx.save();
                        ctx.translate(px, py);
                        ctx.rotate(angle - Math.PI/2); // Align "down" triangle to vector
                        ctx.scale(ptrScale, ptrScale);
                        
                        ctx.fillStyle = '#ff0055';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.font = 'bold 24px Arial';
                        ctx.shadowColor = '#ff0055'; ctx.shadowBlur = 10;
                        ctx.fillText("‚ñº", 0, 0); // Triangle symbol
                        ctx.restore();
                    }
                } else {
                    // Èùû Active ÊòüÁêÉÔºöËß∏ÁôºÂ∞çÊáâÁöÑ‰∏ñÁïåÊèêÁ§∫
                    hitZones.push({
                        t:'circle', x:nx, y:ny, r:touchR, 
                        action:() => {
                            if (state === 'LOCKED') {
                                triggerWorldMsg('HINT', WORLD_HINT.LOCKED);
                            } else if (state === 'DONE') {
                                triggerWorldMsg('HINT', WORLD_HINT.DONE);
                            }
                        }
                    });
                }
            });
        }
        
        function drawPlanetIcon(n, x, y, hover, state, scaleMod, glowAlpha) {
            const scale = (hover ? 1.1 : 1.0) * scaleMod;
            const radius = isMobile ? 44 : 50; 

            ctx.save(); ctx.translate(x, y); ctx.scale(scale, scale);
            
            let alpha = 1;
            if (state === 'LOCKED') alpha = 0.3;
            else if (state === 'DONE') alpha = 0.5;
            // ACTIVE alpha remains 1

            ctx.globalAlpha = alpha;

            if(state === 'ACTIVE'){
                ctx.shadowColor = n.glow;
                ctx.shadowBlur = 20 * glowAlpha; // ÂëºÂê∏ glow
            }

            ctx.fillStyle='rgba(10,10,20,0.8)'; ctx.beginPath(); ctx.arc(0,0,radius,0,Math.PI*2); ctx.fill();
            ctx.shadowBlur=0; ctx.lineWidth=2;
            ctx.strokeStyle= state==='LOCKED' ? '#555' : n.color;

            // Shape Logic (Scaled by radius)
            const rRatio = radius / 50;
            if(n.type==='pentagon'){ 
                ctx.beginPath();
                for(let i=0;i<5;i++){const a=(i/5)*Math.PI*2-Math.PI/2;ctx.lineTo(Math.cos(a)*35*rRatio,Math.sin(a)*35*rRatio);}
                ctx.closePath();ctx.stroke(); 
                ctx.lineWidth=1;
                ctx.beginPath();
                for(let i=0;i<5;i++){const a=(i/5)*Math.PI*2-Math.PI/2;ctx.lineTo(Math.cos(a)*20*rRatio,Math.sin(a)*20*rRatio);}
                ctx.closePath();ctx.stroke();
            }
            else if(n.type==='hexagon'){ 
                ctx.beginPath();
                for(let i=0;i<6;i++){const a=(i/6)*Math.PI*2;ctx.lineTo(Math.cos(a)*35*rRatio,Math.sin(a)*35*rRatio);}
                ctx.closePath();ctx.stroke(); 
                ctx.lineWidth=2;
                ctx.beginPath();ctx.moveTo(0,-35*rRatio);ctx.lineTo(0,35*rRatio);ctx.stroke();
            }
            else if(n.type==='nonagon'){ 
                ctx.beginPath();
                for(let i=0;i<9;i++){const a=(i/9)*Math.PI*2-Math.PI/2;ctx.lineTo(Math.cos(a)*38*rRatio,Math.sin(a)*38*rRatio);}
                ctx.closePath();ctx.stroke();
                ctx.lineWidth=1;
                ctx.beginPath();
                for(let i=0;i<3;i++){const a=(i/3)*Math.PI*2-Math.PI/2;ctx.lineTo(Math.cos(a)*38*rRatio,Math.sin(a)*38*rRatio);}
                ctx.closePath();ctx.stroke();
            }
            else if(n.type==='radar'){ 
                ctx.lineWidth=2;
                ctx.beginPath();ctx.arc(0,0,35*rRatio,0,Math.PI*2);ctx.stroke(); 
                ctx.beginPath();ctx.arc(0,0,22*rRatio,0,Math.PI*2);ctx.stroke(); 
                ctx.fillStyle=n.color; 
                ctx.beginPath();ctx.ellipse(0,5*rRatio,8*rRatio,6*rRatio,0,0,Math.PI*2);ctx.fill(); 
                ctx.beginPath();ctx.arc(-10*rRatio,-5*rRatio,4*rRatio,0,Math.PI*2);ctx.fill();
                ctx.beginPath();ctx.arc(0,-10*rRatio,4*rRatio,0,Math.PI*2);ctx.fill();
                ctx.beginPath();ctx.arc(10*rRatio,-5*rRatio,4*rRatio,0,Math.PI*2);ctx.fill();
            }
            else if(n.type==='rainbow'){ 
                const gr=ctx.createLinearGradient(-35*rRatio,-35*rRatio,35*rRatio,35*rRatio);
                gr.addColorStop(0,'#f00');gr.addColorStop(0.2,'#ff0');gr.addColorStop(0.4,'#0f0');gr.addColorStop(0.6,'#0ff');gr.addColorStop(0.8,'#00f');gr.addColorStop(1,'#f0f');
                ctx.fillStyle=gr;ctx.beginPath();ctx.arc(0,0,35*rRatio,0,Math.PI*2);ctx.fill();
            }
            else if(n.type==='core'){ 
                ctx.fillStyle='#ff3333';ctx.beginPath();ctx.arc(0,0,35*rRatio,0,Math.PI*2);ctx.fill();
                ctx.fillStyle='#ff6600';ctx.beginPath();ctx.arc(0,0,18*rRatio,0,Math.PI*2);ctx.fill();
            }
            
            ctx.strokeStyle=n.color;
            ctx.lineWidth=1; ctx.globalAlpha=alpha*0.5; ctx.beginPath(); ctx.arc(0,0,radius,0,Math.PI*2); ctx.stroke(); 
            ctx.globalAlpha=alpha;
            
            if (state === 'DONE') {
                ctx.fillStyle = '#00ff00';
                ctx.font = (isMobile ? '18px' : '24px') + ' Arial';
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText("‚úì", 0, 0);
            }

            ctx.restore();
            
            ctx.fillStyle = hover ? '#fff' : 'rgba(255,255,255,0.7)';
            if(state==='LOCKED') ctx.fillStyle = '#555';
            
            const fontSize = isMobile ? '15px' : '16px';
            const textOffset = radius + 15; 
            
            ctx.font = (hover ? 'bold ' : '') + fontSize + ' "Noto Sans TC"';
            ctx.textAlign='center'; 
            ctx.fillText(n.label, x, y + textOffset * scale + (isMobile?5:8)); 
            ctx.shadowBlur=0;
        }

        function drawStars() {
            ctx.fillStyle = styles.bg;
            ctx.fillRect(0,0,width,height);
            if(Math.random() < 0.03) shootingStars.push(new ShootingStar());
            stars.forEach(s => {
                const offX = (mouse.x - width/2) * 0.02 * s.z + gyro.x; const offY = (mouse.y - height/2) * 0.02 * s.z + gyro.y;
                ctx.fillStyle = `rgba(255,255,255,${s.alpha})`; ctx.beginPath(); ctx.arc(s.x + offX, s.y + offY, s.size, 0, Math.PI*2); ctx.fill();
            });
            for(let i=shootingStars.length-1; i>=0; i--) { const s = shootingStars[i]; s.update(); s.draw(); if(!s.active) shootingStars.splice(i, 1);
            }
        }

        // --- Transitions & Logic ---
        function enterGame(id, targetX, targetY) {
            activeGameId = id;
            currentScene = 'TRANSITION';
            sendGAEvent('level_start', { level_name: id });
            camera.targetZoom = 5; camera.targetX = targetX - width/2;
            camera.targetY = targetY - height/2;
            setTimeout(() => {
                if(id==='BIG5') startBig5(); if(id==='MBTI') startMBTI(); if(id==='ENNEAGRAM') startEnneagram();
                if(id==='RIASEC') startRIASEC(); if(id==='COLOR') startColorTest(); if(id==='ANIMAL') startAnimalTest();
                currentScene = id; camera.zoom = 1; camera.x = 0; camera.y = 0; 
            }, 1500);
        }

        function returnLobby() { 
            const currentMissionId = journey.order[journey.idx];
            if (currentMissionId) {
                const key = getGameStKey(currentMissionId);
                if (gameSt[key].done) {
                    journey.idx++;
                }
            }
            if (journey.idx >= journey.order.length) {
                currentScene = 'SUMMARY';
            } else {
                currentScene = 'LOBBY';
                camera.zoom = 5; camera.targetZoom = 1; camera.x = 0; camera.y = 0; camera.targetX = 0; camera.targetY = 0;
            }
        }

        // --- v1.0 REPORT GENERATOR ---
        function generateReport() {
            // Helper: Find max key in scores
            const getMax = (scores) => {
                let maxK=null, maxV=-999;
                for(let k in scores) if(scores[k]>maxV){maxV=scores[k]; maxK=k;}
                return maxK;
            };

            // 1. Core (MBTI > Enn)
            const mbtiType = (gameSt.mbti.scores.ei<0?'E':'I')+(gameSt.mbti.scores.sn<0?'S':'N')+(gameSt.mbti.scores.tf<0?'T':'F')+(gameSt.mbti.scores.jp<0?'J':'P');
            const mbtiRes = mbtiData.results[mbtiType] || mbtiData.results['ISTJ'];
            
            // 2. Projection (Animal > Color)
            const x=gameSt.animal.pos.x, y=gameSt.animal.pos.y;
            let aniRes=animalData.results['D']; 
            if(x>0 && y<=0) aniRes=animalData.results['I']; else if(x>0 && y>0) aniRes=animalData.results['S']; else if(x<=0 && y>0) aniRes=animalData.results['C'];
            const cId = gameSt.color.sel[0] ? gameSt.color.sel[0].id : 1;
            const colorRes = colorMeanings[cId];
            // 3. Data Mapping
            // Work: MBTI careerHint (or teamRole)
            const workText = mbtiRes.careerHint.join('„ÄÅ');
            // Drain: Enneagram stress (or Big5 workRisk)
            let ennMax=-1, ennType=1;
            for(let i=1;i<=9;i++) if(gameSt.enn.scores[i]>ennMax){ennMax=gameSt.enn.scores[i];ennType=i;}
            const ennRes = ennData.results[ennType];
            const drainText = ennRes.stress; // Short stress desc
            
            // Career: RIASEC + MBTI teamRole
            const riasecSorted = Object.entries(gameSt.riasec.scores).sort((a,b)=>b[1]-a[1]);
            const riasecCode = riasecSorted.slice(0,2).map(x=>x[0]).join('');
            const careerText = `ÈÅ©ÂêàÁµêÂêà„Äå${riasecCode}„ÄçÁâπË≥™ÔºåÂú®${mbtiRes.teamRole}ÁöÑËßíËâ≤‰∏≠ÁôºÊèÆ„ÄÇ`;

            return {
                core: mbtiRes.t,
                proj: aniRes.t,
                oneLine: `‰Ω†ÁöÑÂøÉÁêÜÊ†∏ÂøÉÊòØ„Äê${mbtiRes.t}„ÄëÔºåÂú®ÊÉÖÂ¢ÉËÆäÂåñÊàñÂ£ìÂäõ‰∏ãÔºåÊúÉÊäïÂ∞ÑÊàê„Äê${aniRes.t}„ÄëÂèçÊáâ„ÄÇ`,
                work: `‰Ω†Âú®„ÄåÊúâÂΩ±ÈüøÂäõ„ÄÅ‰ΩÜÁµêÊßãÊ∏ÖÊ•ö„ÄçÁöÑÁí∞Â¢É‰∏≠Ë°®ÁèæÊúÄÂ•Ω„ÄÇ\nÈÅ©ÂêàÔºö${workText}`,
                career: careerText,
                drain: `ÂÆπÊòìÊ∂àËÄó‰Ω†ÁöÑÊÉÖÂ¢ÉÔºö${drainText}`,
                raw: { mbti: mbtiRes, ani: aniRes, col: colorRes, enn: ennRes }
            };
        }

        // --- NEW: SCROLLABLE SUMMARY SCENE (v1.0) ---
        function drawSummary() {
            const cx = width / 2;
            const cy = height / 2;
            const report = generateReport();

            ctx.fillStyle = 'rgba(0,0,0,0.95)'; ctx.fillRect(0,0,width,height);
            // --- 1. Âõ∫ÂÆöÈ†ÇÈÉ® (Header) ---
            const headerH = 80;
            drawTitle("ÂøÉÁêÜÂÆáÂÆôËº™Âªì", cx, SAFE_TOP + 40, '#fff'); 
            
            // --- 2. ÊªæÂãïÂçÄÂüü (Scroll View) ---
            // Ë®àÁÆóÂèØË¶ñÂçÄÂüüÔºöÈ†ÇÈÉ®Ê®ôÈ°å‰∏ã ~ Â∫ïÈÉ®ÊåâÈàï‰∏ä
            const footerH = 140;
            // ÊåâÈàïÂçÄÈ´òÂ∫¶
            const scrollViewTop = SAFE_TOP + headerH;
            const scrollViewBottom = height - SAFE_BOTTOM - footerH;
            const scrollViewHeight = scrollViewBottom - scrollViewTop;

            ctx.save();
            ctx.beginPath();
            ctx.rect(0, scrollViewTop, width, scrollViewHeight);
            ctx.clip(); // Ë£ÅÂàáÔºöÂè™È°ØÁ§∫Âú®Ê≠§ÂçÄÂüü

            // ÈñãÂßãÁπ™Ë£ΩÂÖßÂÆπ (Â•óÁî®ÊªæÂãï‰ΩçÁßª)
            let y = scrollViewTop + 20 - summaryScrollY;
            const startY = y; // Á¥ÄÈåÑËµ∑ÂßãÈªûË®àÁÆóÁ∏ΩÈ´òÂ∫¶
            const maxW = Math.min(width - 40, 500);
            const startX = cx - maxW/2;

            // [Content A] Ë¶ñË¶∫ÁµêÊßã (Core vs Projection)
            const mbtiNode = lobbyNodes.find(n=>n.id==='MBTI');
            drawPlanetIcon(mbtiNode, cx, y+60, false, 'ACTIVE', 1.0, 0); 
            
            const aniNode = lobbyNodes.find(n=>n.id==='ANIMAL');
            const colNode = lobbyNodes.find(n=>n.id==='COLOR');
            
            ctx.save(); ctx.translate(cx-80, y+40); ctx.scale(0.7,0.7);
            drawPlanetIcon(aniNode, 0, 0, false, 'ACTIVE', 1.0, 0); ctx.restore();

            ctx.save(); ctx.translate(cx+80, y+40); ctx.scale(0.7,0.7);
            drawPlanetIcon(colNode, 0, 0, false, 'ACTIVE', 1.0, 0); ctx.restore();
            
            ctx.fillStyle='#aaa';
            ctx.font='12px "Noto Sans TC"'; ctx.textAlign='center';
            ctx.fillText("Ê†∏ÂøÉ", cx, y+130); ctx.fillText("ÊäïÂ∞Ñ", cx-80, y+100); ctx.fillText("ÊäïÂ∞Ñ", cx+80, y+100);
            
            y += 160;
            // [Content B] ÊñáÂ≠óÂçÄÂ°ä (Â≠óÈ´îÊîæÂ§ßÁâà)
            const drawSection = (title, text, color) => {
                ctx.fillStyle = color;
                ctx.font = (isMobile ? 'bold 20px' : 'bold 22px') + ' "Noto Sans TC"'; 
                ctx.textAlign = 'left';
                ctx.fillText(title, startX, y);
                y += 30; // Ê®ôÈ°åÈñìË∑ù
                
                ctx.fillStyle = '#ddd';
                ctx.font = (isMobile ? '16px' : '18px') + ' "Noto Sans TC"';
                // Line Height 28 for better reading
                y = wrapText(text, startX, y, maxW, 28) + 25;
            };

            drawSection("‚ú® ‰∏ÄÂè•Ë©±Á∏ΩÁµê", report.oneLine, '#fff');
            drawSection("üß† ÂøÉÁêÜËÉΩÈáèÁµêÊßã", "ÂæûÊ∏¨È©óÁµêÊûúÁúãÔºå‰Ω†ÁöÑÂÖßÂú®Áî±‰∏çÂêåÂäõÈáèÈÅã‰Ωú„ÄÇ\n‰∏ªÂ∞éËÉΩÈáè(MBTI)Ê±∫ÂÆöÊ±∫Á≠ñÔºåÊäïÂ∞ÑËÉΩÈáè(ÂãïÁâ©/Ëâ≤ÂΩ©)ÊáâÂ∞çÁï∂‰∏ã„ÄÇ", '#00f3ff');
            drawSection("üõ†Ô∏è ÊúÄ‰Ω≥Â∑•‰ΩúÊñπÂºè", report.work, '#00f3ff');
            drawSection("‚ö†Ô∏è Ê∂àËÄó‰Ω†ÁöÑÊÉÖÂ¢É", report.drain, '#ff6666');
            drawSection("üöÄ ËÅ∑Ê∂ØÁôºÂ±ï", report.career, '#ffff99');
            
            y += 20; // Padding bottom
            
            // Ë®àÁÆóÂÖßÂÆπÁ∏ΩÈ´òÂ∫¶ (Áî®ÊñºÈôêÂà∂ÊªæÂãï)
            summaryContentHeight = y - (scrollViewTop + 20 - summaryScrollY);
            ctx.restore(); // Ëß£Èô§Ë£ÅÂàá

            // --- 3. Âõ∫ÂÆöÂ∫ïÈÉ® (Footer) ---
            // Êº∏Â±§Â∫ïËâ≤Èò≤Ë≠∑ÁΩ©
            const g = ctx.createLinearGradient(0, height - footerH - 40, 0, height);
            g.addColorStop(0, 'rgba(0,0,0,0)'); g.addColorStop(0.4, 'rgba(0,0,0,0.9)'); g.addColorStop(1, '#000');
            ctx.fillStyle = g; ctx.fillRect(0, height - footerH - 40, width, footerH + 40);
            // [New] ÊªæÂãïÊèêÁ§∫ (Scroll Hint)
            if (summaryScrollY < 10 && summaryContentHeight > scrollViewHeight) {
                const bounce = Math.sin(Date.now() * 0.005) * 5;
                ctx.fillStyle = '#00f3ff';
                ctx.textAlign = 'center';
                ctx.font = 'bold 14px "Noto Sans TC"';
                ctx.fillText("‚ñº Áõ¥Ë¶∫ÂØ¶È©óÂÆ§ Ëß£Êûê ‚ñº", cx, height - footerH - 20 + bounce);
            }

            const btnY = height - SAFE_BOTTOM - 60;
            drawBtn(cx, btnY - 70, "Ë§áË£ΩÂÆåÊï¥Â†±Âëä", '#00f3ff', () => {
                const shareText = `„ÄêÊàëÁöÑÂøÉÁêÜÂÆáÂÆôÂ†±Âëä„Äë\n${report.oneLine}\n\nüß† ÁµêÊßãÔºö${report.raw.mbti.t} x ${report.raw.enn.t}\nüõ†Ô∏è Â∑•‰ΩúÔºö${report.work}\n‚ö†Ô∏è Ê∂àËÄóÔºö${report.drain}\n\n#ÂøÉÁêÜÂÆáÂÆô #Jobus`;
                // ‰ΩøÁî®Âº∑ÂäõË§áË£Ω
                copyToClipboard(shareText);
            }, 240);
            drawBtn(cx, btnY, "ÈáçÊñ∞Êé¢Á¥¢ÂÆáÂÆô", '#555', () => {
                resetGame();
                currentScene = 'LOBBY';
                camera.zoom = 5; camera.targetZoom = 1;
            }, 240);
        }

        function resetGame() {
            journey.idx = 0;
            summaryScrollY = 0; // Reset scroll
            gameSt = { 
                big5: {idx:0, ans:3, scores:{O:0,C:0,E:0,A:0,N:0}, done:false, sent:false}, 
                mbti: {idx:0, scores:{ei:0,sn:0,tf:0,jp:0}, done:false, sent:false}, 
                enn: {idx:0, scores:new Array(10).fill(0), done:false, sent:false}, 
                riasec: {idx:0, scores:{R:0,I:0,A:0,S:0,E:0,C:0}, done:false, sent:false}, 
                color: {phase:0, sel:[], auraT:0, done:false, sent:false}, 
                animal: {idx:0, pos:{x:0, y:0}, done:false, sent:false} 
            };
        }

        // --- 1. BIG 5 GAME ---
        function startBig5() { gameSt.big5 = { idx:0, ans:3, scores:{O:0,C:0,E:0,A:0,N:0}, done:false, sent:false };
        }
        function drawBig5() {
            const st = gameSt.big5;
            const cx = width/2, cy = height/2;
            ctx.fillStyle = 'rgba(10,15,30,0.95)'; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = big5Data.qs[st.idx];
                drawProgress(st.idx+1, big5Data.qs.length);
                drawTitle("‰∫îÂ§ßÊÄßÊ†ºÂàÜÊûê", cx, SAFE_TOP + 50, styles.nodes.BIG5.color);
                
                ctx.fillStyle='#fff'; ctx.font='28px "Noto Sans TC"'; ctx.textAlign='center';
                wrapText(q.t, cx, cy-50, Math.min(600, width-60), 40);
                const sw = Math.min(300, width-80);
                const sy = cy+80; ctx.fillStyle = '#444'; ctx.fillRect(cx-sw/2, sy, sw, 6);
                const hx = cx - sw/2 + (sw * (st.ans-1)/4);
                hitZones.push({
                    t:'rect', x:cx-sw/2-20, y:sy-30, w:sw+40, h:60,
                    action: (mx, my) => { const ratio = (mx - (cx - sw/2)) / sw; st.ans = Math.max(1, Math.min(5, Math.round(ratio*4+1))); }
                });
                for(let i=0; i<5; i++){ let tickX = (cx - sw/2) + (sw * (i/4)); ctx.beginPath(); ctx.arc(tickX, sy+3, 3, 0, Math.PI*2);
                ctx.fillStyle='#666'; ctx.fill(); }
                const options = ["‰∏çÂêåÊÑè", "Á®ç‰∏çÂêåÊÑè", "ÊôÆÈÄö", "Á®çÂêåÊÑè", "ÂêåÊÑè"];
                ctx.font = '12px "Noto Sans TC"'; ctx.fillStyle = '#aaa'; ctx.textAlign = 'center';
                for(let i=0; i<5; i++){ let tickX = (cx - sw/2) + (sw * (i/4)); ctx.fillText(options[i], tickX, sy + 40);
                }
                ctx.beginPath();
                ctx.arc(hx, sy+3, 12, 0, Math.PI*2); ctx.fillStyle='#00f3ff'; ctx.fill();
                drawBtn(cx, height-SAFE_BOTTOM-80, "‰∏ã‰∏ÄÈ°å", styles.nodes.BIG5.color, () => {
                    const sc = st.ans - 3; st.scores[q.k] += q.rev ? -sc : sc;
                    if(st.idx < big5Data.qs.length-1) { st.idx++; st.ans=3; } else st.done = true;
                });
            } else {
                let maxK='O', maxV=-99;
                for(let k in st.scores) if(st.scores[k]>maxV) { maxV=st.scores[k]; maxK=k; }
                const res = big5Data.results[maxK];
                if(!st.sent) { sendGAEvent('level_end', { level_name: 'BIG5', result_id: maxK, success: true }); st.sent = true;
                }
                drawTitle("ÂàÜÊûêÂÆåÊàê", cx, SAFE_TOP + 40, styles.nodes.BIG5.color);
                drawRadar(cx, SAFE_TOP + 120, 70, st.scores);
                ctx.textAlign='center'; ctx.font='bold 28px "Noto Sans TC"'; ctx.fillStyle='#fff'; ctx.fillText(res.t, cx, SAFE_TOP + 220);
                ctx.font='18px "Noto Sans TC"'; ctx.fillStyle='#ccc'; wrapText(res.oneLine, cx, SAFE_TOP + 250, width-40, 26);
                let textY = SAFE_TOP + 290;
                const maxW = Math.min(width * 0.85, 500); const startX = cx - maxW/2;
                textY = drawSectionTitle("„ÄêÁîüÊ¥ª‰∏≠ÁöÑ‰Ω†„Äë", startX, textY, '#00f3ff');
                textY = wrapText(res.life, startX, textY, maxW, 24) + 15;
                textY = drawSectionTitle("„ÄêÂ∑•‰ΩúÂÑ™Âã¢„Äë", startX, textY, '#00f3ff');
                textY = drawBulletList(res.workStrength, startX, textY, maxW);
                textY = drawSectionTitle("„ÄêÁõ≤ÈªûËàáÈ¢®Èö™„Äë", startX, textY, '#ff6666'); textY = drawBulletList(res.workRisk, startX, textY, maxW);
                drawBtn(cx, height-SAFE_BOTTOM-60, "ËøîÂõûÊóÖÁ®ã", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function drawRadar(cx, cy, r, scores) {
            const keys=['O','C','E','A','N'];
            ctx.strokeStyle='#555'; ctx.beginPath();
            for(let i=0;i<5;i++){ const a=i/5*Math.PI*2-Math.PI/2; ctx.lineTo(cx+Math.cos(a)*r, cy+Math.sin(a)*r); } ctx.closePath(); ctx.stroke();
            ctx.fillStyle='rgba(0,243,255,0.3)'; ctx.beginPath();
            keys.forEach((k,i)=>{ const v=Math.max(0.2, (scores[k]+6)/12)*r; ctx.lineTo(cx+Math.cos(i/5*Math.PI*2-Math.PI/2)*v, cy+Math.sin(i/5*Math.PI*2-Math.PI/2)*v); });
            ctx.closePath(); ctx.fill();
            ctx.fillStyle='#fff'; ctx.font='12px Orbitron'; ctx.textAlign='center';
            keys.forEach((k,i)=>{ const a=i/5*Math.PI*2-Math.PI/2; ctx.fillText(k, cx+Math.cos(a)*(r+15), cy+Math.sin(a)*(r+15)+5); });
        }

        // --- 2. MBTI GAME ---
        function startMBTI() { gameSt.mbti = { idx:0, scores:{ei:0,sn:0,tf:0,jp:0}, done:false, sent:false };
        }
        function drawMBTI() {
            const st = gameSt.mbti;
            const cx = width/2, cy = height/2; ctx.fillStyle = '#1a0505'; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = mbtiData.qs[st.idx];
                drawProgress(st.idx+1, mbtiData.qs.length);
                drawTitle("RPG ËÅ∑Ê•≠Ê∏¨È©ó", cx, SAFE_TOP + 50, styles.nodes.MBTI.color);
                ctx.fillStyle='#fff'; ctx.font='28px "Noto Sans TC"'; ctx.textAlign='center';
                wrapText(q.q, cx, cy-80, Math.min(600, width-60), 40);
                if (isMobile) {
                    drawCard(cx, cy+20, width-60, 90, "A", q.a, '#ff3333', ()=>{ st.scores[q.d]-=q.v; nextMBTI(); });
                    drawCard(cx, cy+130, width-60, 90, "B", q.b, '#ff3333', ()=>{ st.scores[q.d]+=q.v; nextMBTI(); });
                } else {
                    drawCard(cx-160, cy+60, 280, 160, "A", q.a, '#ff3333', ()=>{ st.scores[q.d]-=q.v; nextMBTI(); });
                    drawCard(cx+160, cy+60, 280, 160, "B", q.b, '#ff3333', ()=>{ st.scores[q.d]+=q.v; nextMBTI(); });
                }
            } else {
                const type = (st.scores.ei<0?'E':'I')+(st.scores.sn<0?'S':'N')+(st.scores.tf<0?'T':'F')+(st.scores.jp<0?'J':'P');
                const res = mbtiData.results[type] || mbtiData.results['ISTJ'];
                if(!st.sent) { sendGAEvent('level_end', { level_name: 'MBTI', result_id: type, success: true }); st.sent = true;
                }
                drawTitle(res.t + " " + res.e, cx, SAFE_TOP + 50, '#ffcc00');
                ctx.font='20px Orbitron'; ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.fillText(type, cx, SAFE_TOP + 90);
                ctx.font='18px "Noto Sans TC"'; ctx.fillStyle='#ccc'; ctx.fillText(res.oneLine, cx, SAFE_TOP + 120);
                let textY = SAFE_TOP + 160; const maxW = Math.min(width * 0.85, 520); const startX = cx - maxW/2;
                textY = drawSectionTitle("„ÄêÂúòÈöäËßíËâ≤„Äë", startX, textY, '#ffcc00'); textY = wrapText(res.teamRole, startX, textY, maxW, 26) + 15;
                textY = drawSectionTitle("„ÄêÊúÄÂú®ÊÑèÁöÑÊòØ„Äë", startX, textY, '#ffcc00'); textY = wrapText(res.careMost, startX, textY, maxW, 26) + 15;
                textY = drawSectionTitle("„ÄêÂêà‰ΩúÂ∞èÁßòË®£„Äë", startX, textY, '#ff9999'); textY = drawBulletList(res.coopTips, startX, textY, maxW);
                textY = drawSectionTitle("„ÄêËÅ∑Ê∂ØÈÅ©ÈÖç„Äë", startX, textY, '#99ff99');
                textY = drawBulletList(res.careerHint, startX, textY, maxW);
                drawBtn(cx, height-SAFE_BOTTOM-60, "ËøîÂõûÊóÖÁ®ã", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function nextMBTI() { if(gameSt.mbti.idx < mbtiData.qs.length-1) gameSt.mbti.idx++;
        else gameSt.mbti.done=true; }

        // --- 3. ENNEAGRAM GAME ---
        function startEnneagram() { gameSt.enn = { idx:0, scores:new Array(10).fill(0), done:false, sent:false };
        }
        function drawEnneagram() {
            const st = gameSt.enn;
            const cx=width/2, cy=height/2;
            const g = ctx.createLinearGradient(0,0,0,height); g.addColorStop(0,'#1a1005'); g.addColorStop(1,'#000'); ctx.fillStyle=g; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = ennData.qs[st.idx];
                drawProgress(st.idx+1, ennData.qs.length);
                drawTitle("‰πùÂûã‰∫∫Ê†º", cx, SAFE_TOP + 50, styles.nodes.ENNEAGRAM.color);
                ctx.fillStyle='#fff'; ctx.font='26px "Noto Sans TC"'; ctx.textAlign='center'; wrapText(q.q, cx, cy-80, Math.min(600, width-60), 40);
                const w = isMobile ? width-60 : 320;
                drawBtn(cx, cy+10, q.a, '#cd7f32', ()=>{ q.ta.forEach(x=>st.scores[x]++); nextEnn(); }, w);
                drawBtn(cx, cy+90, q.b, '#555', ()=>{ q.tb.forEach(x=>st.scores[x]++); nextEnn(); }, w);
            } else {
                let max = -1, type = 1;
                for(let i=1;i<=9;i++) if(st.scores[i]>max) { max=st.scores[i]; type=i; }
                const res = ennData.results[type];
                if(!st.sent) { sendGAEvent('level_end', { level_name: 'ENNEAGRAM', result_id: type, success: true }); st.sent = true;
                }
                drawTitle(res.t, cx, SAFE_TOP + 50, '#ffd700');
                ctx.font='18px "Noto Sans TC"'; ctx.fillStyle='#ccc'; ctx.textAlign='center'; wrapText(res.oneLine, cx, SAFE_TOP + 90, width-40, 26);
                let textY = SAFE_TOP + 140;
                const maxW = Math.min(width * 0.85, 520); const startX = cx - maxW/2;
                textY = drawSectionTitle("„ÄêÊ†∏ÂøÉÂãïÊ©ü„Äë", startX, textY, '#ffd700');
                textY = wrapText(res.motive, startX, textY, maxW, 26) + 15;
                textY = drawSectionTitle("„ÄêÂ£ìÂäõÂèçÊáâ„Äë", startX, textY, '#ff6666');
                textY = wrapText(res.stress, startX, textY, maxW, 26) + 15;
                textY = drawSectionTitle("„ÄêÂ∑•‰ΩúÂÑ™Âã¢„Äë", startX, textY, '#ffd700');
                textY = drawBulletList(res.workStrength, startX, textY, maxW);
                textY = drawSectionTitle("„ÄêÊàêÈï∑Âª∫Ë≠∞„Äë", startX, textY, '#66ff66'); textY = drawBulletList(res.growthTips, startX, textY, maxW);
                drawBtn(cx, height-SAFE_BOTTOM-60, "ËøîÂõûÊóÖÁ®ã", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function nextEnn() { if(gameSt.enn.idx < ennData.qs.length-1) gameSt.enn.idx++;
        else gameSt.enn.done=true; }

        // --- 4. RIASEC GAME ---
        function startRIASEC() { gameSt.riasec = { idx:0, scores:{R:0,I:0,A:0,S:0,E:0,C:0}, done:false, sent:false };
        }
        function drawRIASEC() {
            const st = gameSt.riasec;
            const cx=width/2, cy=height/2; ctx.fillStyle='#001a1a'; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = riasecData.qs[st.idx];
                drawProgress(st.idx+1, riasecData.qs.length);
                drawTitle("Ëç∑Ëò≠‰ª£Á¢º", cx, SAFE_TOP + 50, '#00ced1');
                ctx.fillStyle='#fff'; ctx.font='28px "Noto Sans TC"'; ctx.textAlign='center'; ctx.fillText(`‰Ω†ÂñúÊ≠° "${q.q}" ÂóéÔºü`, cx, cy-50);
                drawBtn(cx-90, cy+80, "ÂñúÊ≠°", '#00ffcc', ()=>{ st.scores[q.t]+=1; nextRIASEC(); }, 140);
                drawBtn(cx+90, cy+80, "‰∏çÂñúÊ≠°", '#555', ()=>{ nextRIASEC(); }, 140);
            } else {
                const sorted = Object.entries(st.scores).sort((a,b)=>b[1]-a[1]);
                const code = sorted.slice(0,3).map(x=>x[0]).join('-');
                const top3 = sorted.slice(0,3);
                if(!st.sent) { sendGAEvent('level_end', { level_name: 'RIASEC', result_id: code, success: true });
                st.sent = true; }
                drawHexagon(cx, SAFE_TOP + 100, 60, st.scores);
                ctx.fillStyle='#00ffcc'; ctx.font='bold 40px Orbitron'; ctx.textAlign='center'; ctx.fillText(code, cx, SAFE_TOP + 210);
                let textY = SAFE_TOP + 250;
                const maxW = Math.min(width * 0.85, 520); const startX = cx - maxW/2;
                top3.forEach(item => {
                    const data = riasecData.results[item[0]];
                    textY = drawSectionTitle(data.name, startX, textY, '#00ffcc');
                    textY = wrapText(data.oneLine, startX, textY, maxW, 24) + 5;
                    textY = 
                    drawBulletList(data.workEnv, startX, textY, maxW, 22);
                });
                drawBtn(cx, height-SAFE_BOTTOM-60, "ËøîÂõûÊóÖÁ®ã", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function nextRIASEC() { if(gameSt.riasec.idx < riasecData.qs.length-1) gameSt.riasec.idx++;
        else gameSt.riasec.done=true; }
        function drawHexagon(cx, cy, r, scores) {
            ctx.strokeStyle='#00ffcc';
            ctx.lineWidth=1; ctx.beginPath();
            for(let i=0;i<6;i++) { const a=i/6*Math.PI*2-Math.PI/2; ctx[i===0?'moveTo':'lineTo'](cx+Math.cos(a)*r, cy+Math.sin(a)*r); } ctx.closePath(); ctx.stroke();
            const keys=['R','I','A','S','E','C']; ctx.fillStyle='rgba(0,255,204,0.3)'; ctx.beginPath();
            for(let i=0;i<6;i++) { const v=Math.min(scores[keys[i]]||0, 3)/3*r; const a=i/6*Math.PI*2-Math.PI/2; ctx[i===0?'moveTo':'lineTo'](cx+Math.cos(a)*v, cy+Math.sin(a)*v); } ctx.closePath(); ctx.fill();
            ctx.fillStyle='#fff'; ctx.font='14px Orbitron'; ctx.textAlign='center';
            for(let i=0;i<6;i++) { const a=i/6*Math.PI*2-Math.PI/2; ctx.fillText(keys[i], cx+Math.cos(a)*(r+15), cy+Math.sin(a)*(r+15)+5); }
        }

        // --- 5. COLOR GAME ---
        function startColorTest() { gameSt.color = { phase:0, sel:[], auraT:0, done:false, sent:false };
        }
        function drawColorTest() {
            const st = gameSt.color;
            const cx=width/2, cy=height/2; ctx.fillStyle='#111'; ctx.fillRect(0,0,width,height);
            if(st.phase < 3) {
                drawTitle("Ëâ≤ÂΩ©ÂøÉÁêÜ", cx, SAFE_TOP + 50, '#ff00ff');
                let txt = "Áõ¥Ë¶∫ÈÅ∏ÊìáÊúÄÂê∏Âºï‰Ω†ÁöÑÈ°èËâ≤";
                if(st.phase===1) txt = "ÈÅ∏ÊìáÁ¨¨‰∫åÂê∏Âºï‰Ω†ÁöÑÈ°èËâ≤";
                if(st.phase===2) txt = "ÈÅ∏ÊìáÊúÄ‰∏çÂñúÊ≠°ÁöÑÈ°èËâ≤";
                ctx.fillStyle='#fff'; ctx.font='22px "Noto Sans TC"'; ctx.textAlign='center';
                wrapText(txt, cx, cy-150, width-60, 30);
                const palette = [{id:1,c:'#A9A9A9'},{id:2,c:'#0000FF'},{id:3,c:'#008000'},{id:4,c:'#FF0000'},{id:5,c:'#FFFF00'},{id:6,c:'#800080'},{id:7,c:'#8B4513'},{id:8,c:'#333333'}];
                palette.forEach((c,i)=>{
                    if(st.sel.find(s=>s.id===c.id)) return;
                    const a=(i/8)*Math.PI*2; const x=cx+Math.cos(a)*100; const y=cy+Math.sin(a)*100;
                    ctx.beginPath(); ctx.arc(x,y,35,0,Math.PI*2); ctx.fillStyle=c.c; ctx.fill(); ctx.strokeStyle='#fff'; ctx.lineWidth=2; ctx.stroke();
                    hitZones.push({
                        t:'circle', x:x, y:y, r:40, 
                        action:()=>{ 
                            st.sel.push(c); 
                            st.phase++; 
                            if(st.phase===3) st.done = true; 
                        }
                    });
                });
            } else {
                st.auraT += 0.02;
                const c1=st.sel[0], c2=st.sel[1];
                const d=Math.sin(st.auraT)*10; 
                let g=ctx.createRadialGradient(cx,SAFE_TOP+100,20,cx,SAFE_TOP+100,120+d); g.addColorStop(0,c1.c); g.addColorStop(1,'transparent');
                ctx.fillStyle=g; ctx.beginPath(); ctx.arc(cx,SAFE_TOP+100,120+d,0,Math.PI*2); ctx.fill();
                if(!st.sent) { sendGAEvent('level_end', { level_name: 'COLOR', result_id: colorMeanings[c1.id].label, success: true }); st.sent = true;
                }
                drawTitle("‰Ω†ÁöÑÂøÉÈùàÂÖâË≠ú", cx, SAFE_TOP + 50, '#fff');
                let textY = SAFE_TOP + 200; const maxW = Math.min(width * 0.85, 520); const startX = cx - maxW/2;
                const d1 = colorMeanings[c1.id];
                textY = drawSectionTitle(`È°ØÊÄßÊ∏¥Êúõ (${d1.label})`, startX, textY, c1.c); textY = wrapText(d1.want, startX, textY, maxW, 26) + 5;
                textY = wrapText(d1.state, startX, textY, maxW, 26) + 15;
                const d2 = colorMeanings[c2.id];
                textY = drawSectionTitle(`Ê¨°Ë¶ÅÂãïÂäõ (${d2.label})`, startX, textY, c2.c);
                textY = wrapText(d2.want, startX, textY, maxW, 26) + 15;
                textY = drawSectionTitle(`Ëá™ÊàëÁÖßÈ°ßÂª∫Ë≠∞`, startX, textY, '#fff');
                textY = drawBulletList(d1.selfCare, startX, textY, maxW);
                ctx.fillStyle='#666'; ctx.font='14px "Noto Sans TC"'; ctx.textAlign='center'; ctx.fillText("*Ê≠§ÁµêÊûúÂèçÊò†‰Ω†ËøëÊúüÁöÑÂøÉÁêÜÁãÄÊÖã", cx, textY + 20);
                drawBtn(cx, height-SAFE_BOTTOM-60, "ËøîÂõûÊóÖÁ®ã", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }

        // --- 6. ANIMAL GAME ---
        function startAnimalTest() { gameSt.animal = { idx:0, pos:{x:0, y:0}, done:false, sent:false };
        }
        function drawAnimalTest() {
            const st = gameSt.animal;
            const cx=width/2, cy=height/2; ctx.fillStyle='#051105'; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = animalData.qs[st.idx];
                drawProgress(st.idx+1, animalData.qs.length);
                drawTitle("ÂãïÁâ©ÂúñÈ®∞", cx, SAFE_TOP + 50, '#32cd32');
                ctx.fillStyle='#fff'; ctx.font='28px "Noto Sans TC"'; ctx.textAlign='center'; wrapText(q.q, cx, cy-80, Math.min(600, width-60), 40);
                if (isMobile) {
                    drawCard(cx, cy+20, width-60, 90, "A", q.a, '#32cd32', ()=>{ st.pos[q.ax]+=q.v; nextAnimal(); });
                    drawCard(cx, cy+130, width-60, 90, "B", q.b, '#32cd32', ()=>{ st.pos[q.ax]-=q.v; nextAnimal(); });
                } else {
                    drawCard(cx-160, cy+60, 280, 160, "A", q.a, '#32cd32', ()=>{ st.pos[q.ax]+=q.v; nextAnimal(); });
                    drawCard(cx+160, cy+60, 280, 160, "B", q.b, '#32cd32', ()=>{ st.pos[q.ax]-=q.v; nextAnimal(); });
                }
            } else {
                const x=st.pos.x, y=st.pos.y;
                let res=animalData.results['D']; if(x>0 && y<=0) res=animalData.results['I']; else if(x>0 && y>0) res=animalData.results['S']; else if(x<=0 && y>0) res=animalData.results['C'];
                if(!st.sent) { sendGAEvent('level_end', { level_name: 'ANIMAL', result_id: res.t, success: true }); st.sent = true;
                }
                drawTitle(res.t + " " + res.e, cx, SAFE_TOP + 50, '#adff2f');
                ctx.font='18px "Noto Sans TC"'; ctx.fillStyle='#ccc'; ctx.textAlign='center'; wrapText(res.oneLine, cx, SAFE_TOP + 90, width-40, 26);
                let textY = SAFE_TOP + 140;
                const maxW = Math.min(width * 0.85, 520); const startX = cx - maxW/2;
                textY = drawSectionTitle("„ÄêÊ∫ùÈÄöÈ¢®Ê†º„Äë", startX, textY, '#adff2f');
                textY = wrapText(res.commStyle, startX, textY, maxW, 26) + 15;
                textY = drawSectionTitle("„ÄêÂÆπÊòìË¢´Ë™§ÊúÉ„Äë", startX, textY, '#ff6666');
                textY = wrapText(res.beMisunderstood, startX, textY, maxW, 26) + 15;
                textY = drawSectionTitle("„ÄêÂêà‰ΩúÂ∞èÊíáÊ≠•„Äë", startX, textY, '#adff2f');
                textY = drawBulletList(res.coopTips, startX, textY, maxW);
                textY = drawSectionTitle("„ÄêËá™ÊàëË™øÊï¥„Äë", startX, textY, '#ffff99'); textY = drawBulletList(res.selfAdjust, startX, textY, maxW);
                drawBtn(cx, height-SAFE_BOTTOM-60, "ËøîÂõûÊóÖÁ®ã", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function nextAnimal() { if(gameSt.animal.idx<animalData.qs.length-1) gameSt.animal.idx++;
        else gameSt.animal.done=true; }

        init(); loop();
    </script>
</body>
</html>