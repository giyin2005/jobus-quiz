<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¿ƒç†å®‡å®™ï¼šMindverse (Pro)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Orbitron:wght@500;700;900&display=swap');

        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            overscroll-behavior: none;
            background-color: #020205;
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: none; /* ç¦æ­¢é›™æ“Šç¸®æ”¾ */
            -webkit-font-smoothing: antialiased;
            position: fixed; /* iOS æ»¾å‹•é–å®š */
        }

        canvas {
            display: block;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .font-preload { position: absolute; opacity: 0; pointer-events: none; }
    </style>
</head>
<body>
    <div class="font-preload" style="font-family: 'Orbitron'">Loading...</div>
    <div class="font-preload" style="font-family: 'Noto Sans TC'">Loading...</div>
    <canvas id="appCanvas"></canvas>

    <script>
        /**
         * å¿ƒç†å®‡å®™ Mindverse - Final Version
         * ç‰¹è‰²ï¼šåŸç‰ˆåœ–æ¨™è¨­è¨ˆ (Icons Restored) + å®Œæ•´çµæœå¡ç‰‡ + RWD æ’ç‰ˆä¿®æ­£
         */

        // --- æ ¸å¿ƒç³»çµ±èˆ‡è®Šæ•¸ ---
        const canvas = document.getElementById('appCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, dpr = 1, isMobile = false;
        
        // ç‹€æ…‹ç®¡ç†
        let mouse = { x: 0, y: 0, down: false };
        let gyro = { x: 0, y: 0 };
        let currentScene = 'LOBBY'; 
        let activeGameId = null;
        let camera = { zoom: 1, x: 0, y: 0, targetZoom: 1, targetX: 0, targetY: 0 };
        let hitZones = []; 

        // Safe Area è¨­å®š (ç°¡æ˜“æ¨¡æ“¬)
        const SAFE_TOP = 50; 
        const SAFE_BOTTOM = 40;

        // --- è¦–è¦ºé¢¨æ ¼ ---
        const styles = {
            bg: '#020205',
            nodes: {
                'BIG5': { color: '#4d79ff', glow: '#00f3ff', type: 'pentagon', label: 'äº”å¤§æ€§æ ¼', desc: 'OCEAN Radar' },
                'MBTI': { color: '#ff3333', glow: '#ffcc00', type: 'core', label: 'RPG è·æ¥­', desc: 'Personality' },
                'ENNEAGRAM': { color: '#cd7f32', glow: '#ffd700', type: 'nonagon', label: 'ä¹å‹äººæ ¼', desc: 'Enneagram' },
                'RIASEC': { color: '#00ced1', glow: '#00ffcc', type: 'hexagon', label: 'è·è˜­ä»£ç¢¼', desc: 'Career Map' },
                'COLOR': { color: '#ff00ff', glow: '#ffffff', type: 'rainbow', label: 'è‰²å½©å¿ƒç†', desc: 'Soul Aura' },
                'ANIMAL': { color: '#32cd32', glow: '#adff2f', type: 'radar', label: 'å‹•ç‰©åœ–é¨°', desc: 'Guardian' }
            }
        };

        // --- 1. è³‡æ–™åº« (å®Œæ•´ç‰ˆçµæœå¡) ---

        // (A) Big5 Data
        const big5Data = {
            qs: [
                {t:"å–œæ­¡åœ¨èšæœƒä¸­èªè­˜æ–°æœ‹å‹", k:'E'}, {t:"å°è—è¡“å’ŒæŠ½è±¡æ¦‚å¿µæ„Ÿèˆˆè¶£", k:'O'}, {t:"åšäº‹é€šå¸¸æœƒæå‰è¨ˆåŠƒ", k:'C'}, {t:"å®¹æ˜“æ„Ÿå—åˆ°åˆ¥äººçš„æƒ…ç·’", k:'A'}, {t:"å£“åŠ›å¤§æ™‚å®¹æ˜“æ„Ÿåˆ°ç„¦æ…®", k:'N'},
                {t:"æ¯”è¼ƒå–œæ­¡å®‰éœç¨è™•", k:'E', rev:true}, {t:"å–œæ­¡å˜—è©¦ç•°åœ‹æ–™ç†", k:'O'}, {t:"æˆ¿é–“é€šå¸¸å¾ˆæ•´æ½”", k:'C'}, {t:"æ¨‚æ–¼å¹«åŠ©ä»–äººè§£æ±ºå•é¡Œ", k:'A'}, {t:"æƒ…ç·’èµ·ä¼æ¯”è¼ƒå¤§", k:'N'}
            ],
            results: {
                'O': { t:"é–‹æ”¾æ€§ (Openness)", oneLine:"å¥½å¥‡å¿ƒæ—ºç››ï¼Œæ‹’çµ•ç„¡èŠçš„é»å­ç‹ã€‚", life:"ä½ å–œæ­¡å˜—è©¦æ–°é¤å»³ã€æ–°è·¯ç·šï¼Œè¨å­ä¸€æˆä¸è®Šçš„ç”Ÿæ´»ã€‚è…¦ä¸­ç¸½æœ‰å¤©é¦¬è¡Œç©ºçš„æƒ³æ³•ã€‚", workStrength:["å‰µæ–°èƒ½åŠ›å¼·ï¼Œé©åˆç™¼æƒ³","é©æ‡‰åŠ›é«˜ï¼Œä¸æ’æ–¥æ–°å·¥å…·"], workRisk:["å®¹æ˜“æƒ³å¤ªå¤šè€Œé›£ä»¥æ”¶æ–‚","å°é‡è¤‡æ€§å·¥ä½œæ„Ÿåˆ°å­ç…©"], tips:["ç·´ç¿’ã€ŒæŠŠé»å­è½åœ°ã€çš„åŸ·è¡ŒåŠ›","æ¯é€±çµ¦è‡ªå·±ä¸€å€‹ã€Œå°ˆæ³¨æ™‚æ®µã€ä¸çœ‹æ–°è¨Šæ¯"] },
                'C': { t:"ç›¡è²¬æ€§ (Conscientiousness)", oneLine:"è‡ªå¾‹ä¸”å¯é ï¼Œåœ˜éšŠçš„å®šæµ·ç¥é‡ã€‚", life:"ä½ çš„æˆ¿é–“é€šå¸¸å¾ˆæ•´é½Šï¼Œå‡ºé–€æ—…éŠæœƒå…ˆæŸ¥å¥½æ”»ç•¥ã€‚ä½ å–œæ­¡ã€ŒæŒæ§æ„Ÿã€ï¼Œä¸å–œæ­¡çªç™¼ç‹€æ³ã€‚", workStrength:["åŸ·è¡ŒåŠ›å¼·ï¼Œç­”æ‡‰çš„äº‹ä½¿å‘½å¿…é”","ç´°å¿ƒï¼Œå¾ˆå°‘çŠ¯ä½ç´šéŒ¯èª¤"], workRisk:["å°è‡ªå·±å’Œåˆ¥äººéƒ½å¤ªåš´æ ¼","é‡åˆ°è¨ˆç•«æ”¹è®Šå®¹æ˜“ç„¦æ…®"], tips:["ç·´ç¿’æ¥å—ã€Œ80åˆ†ä¹Ÿå¯ä»¥ã€","è©¦è‘—ä¿ç•™ä¸€é»å½ˆæ€§æ™‚é–“çµ¦çªç™¼ç‹€æ³"] },
                'E': { t:"å¤–å‘æ€§ (Extraversion)", oneLine:"ç†±æƒ…æ´‹æº¢ï¼Œå¤©ç”Ÿçš„é€£çµè€…ã€‚", life:"æ¯”èµ·ç¨è™•ï¼Œä½ æ›´å–œæ­¡æ‰¾äººèŠå¤©ã€‚å‡æ—¥å¾…åœ¨å®¶æœƒè¦ºå¾—èƒ½é‡æ¯ç«­ï¼Œèšæœƒæ˜¯ä½ å……é›»çš„æ–¹å¼ã€‚", workStrength:["æ“…é•·ç ´å†°èˆ‡å»ºç«‹é—œä¿‚","åœ¨åœ˜é«”ä¸­èƒ½å¸¶å‹•æ°£æ°›"], workRisk:["èªªè©±æœ‰æ™‚å¤ªå¿«ï¼Œå¿˜äº†å‚¾è½","å®¹æ˜“å› å¤–å‹™åˆ†å¿ƒ"], tips:["ç·´ç¿’ã€Œæ·±åº¦å‚¾è½ã€ä¸æ’è©±","å­¸ç¿’ç¨è™•ï¼Œæ²‰æ¾±å…§å¿ƒ"] },
                'A': { t:"è¦ªå’Œæ€§ (Agreeableness)", oneLine:"æº«æš–åŒ…å®¹ï¼Œé‡è¦–å’Œè«§çš„å®ˆè­·è€…ã€‚", life:"ä½ å¾ˆåœ¨æ„åˆ¥äººçš„æ„Ÿå—ï¼Œå¸¸å› ç‚ºä¸æƒ³è¡çªè€Œå§”å±ˆè‡ªå·±ã€‚æœ‹å‹å¸¸æ‰¾ä½ è¨´è‹¦ã€‚", workStrength:["å–„æ–¼åˆä½œï¼Œä¹Ÿæ˜¯å¾ˆå¥½çš„å”èª¿è€…","å¯Œæœ‰åŒç†å¿ƒï¼Œé©åˆæœå‹™æˆ–HR"], workRisk:["å®¹æ˜“è®Šæˆæ¿«å¥½äºº","ä¸æ•¢çˆ­å–è‡ªå·±çš„æ¬Šç›Š"], tips:["ç·´ç¿’æº«å’Œä½†å …å®šåœ°èªªã€Œä¸ã€","æŠŠã€Œç…§é¡§è‡ªå·±ã€ä¹Ÿåˆ—å…¥å¾…è¾¦æ¸…å–®"] },
                'N': { t:"ç¥ç¶“è³ª (Neuroticism)", oneLine:"æƒ…æ„Ÿç´°è†©ï¼Œæ•éŠ³çš„é¢¨éšªåµæ¸¬å„€ã€‚", life:"ä½ çš„å…§å¿ƒæˆ²å¾ˆå¤šï¼Œå®¹æ˜“å› ç‚ºåˆ¥äººä¸€å¥è©±æƒ³å¾ˆä¹…ã€‚ä½†ä¹Ÿå› æ­¤ï¼Œä½ æ“æœ‰æ¯”åˆ¥äººæ›´æ·±çš„æƒ…æ„Ÿé«”é©—ã€‚", workStrength:["å±æ©Ÿæ„è­˜å¼·ï¼Œèƒ½é è¦‹å•é¡Œ","å°è—è¡“æˆ–æƒ…æ„Ÿæœ‰é«˜æ•éŠ³åº¦"], workRisk:["å£“åŠ›å¤§æ™‚å®¹æ˜“ç•¶æ©Ÿ","å®¹æ˜“æŠŠå°äº‹æ”¾å¤§"], tips:["ç„¦æ…®æ™‚ï¼Œè©¦è‘—ã€Œå¯«ä¸‹ä¾†ã€é‡æ¸…äº‹å¯¦","ç·´ç¿’æ­£å¿µå‘¼å¸ï¼Œå›åˆ°ç•¶ä¸‹"] }
            }
        };

        // (B) MBTI Data
        const mbtiData = {
            qs: [
                {q:"é€±æœ«æ›´æƒ³...", a:"è·Ÿæœ‹å‹å‡ºå»ç©(E)", b:"åœ¨å®¶ä¼‘æ¯(I)", d:'ei', v:2}, {q:"å­¸ç¿’æ–°äº‹ç‰©...", a:"å…ˆæ‡‚ç†è«–(N)", b:"å…ˆçœ‹ç¯„ä¾‹(S)", d:'sn', v:2},
                {q:"åšæ±ºå®šæ™‚...", a:"é‚è¼¯åˆ†æ(T)", b:"åœ¨æ„æ„Ÿå—(F)", d:'tf', v:2}, {q:"ç”Ÿæ´»æ–¹å¼...", a:"æŒ‰éƒ¨å°±ç­(J)", b:"éš¨é‡è€Œå®‰(P)", d:'jp', v:2},
                {q:"æ´¾å°ä¸Š...", a:"èªè­˜é™Œç”Ÿäºº(E)", b:"æ‰¾ç†Ÿäºº(I)", d:'ei', v:2}, {q:"ä½ æ›´ç›¸ä¿¡...", a:"ç›´è¦ºèˆ‡éˆæ„Ÿ(N)", b:"ç¶“é©—èˆ‡æ•¸æ“š(S)", d:'sn', v:2},
                {q:"æœ‹å‹è¨´è‹¦...", a:"çµ¦äºˆå»ºè­°(T)", b:"çµ¦äºˆå®‰æ…°(F)", d:'tf', v:2}, {q:"å·¥ä½œç’°å¢ƒ...", a:"äº•ç„¶æœ‰åº(J)", b:"å½ˆæ€§è‡ªç”±(P)", d:'jp', v:2}
            ],
            results: {
                'ISTJ': { t:'çš‡å®¶è¡›å£«', e:'ğŸ›¡ï¸', oneLine:"ä¸€çµ²ä¸è‹Ÿçš„é‚è¼¯åŸ·è¡Œè€…ã€‚", teamRole:"æµç¨‹å®ˆè­·è€…ï¼Œç¢ºä¿SOPè¢«åŸ·è¡Œã€‚", careMost:"ç§©åºèˆ‡è²¬ä»»ã€‚", coopTips:["è«‹çµ¦å‡ºæ˜ç¢ºæŒ‡ä»¤èˆ‡æœŸé™","ä¸è¦éš¨æ„è®Šæ›´è¨ˆç•«"], careerHint:["é©åˆæœ‰åˆ¶åº¦ã€è¬›æ±‚ç²¾æº–çš„ç’°å¢ƒ"] },
                'ISFJ': { t:'å®ˆè­·å¤©ä½¿', e:'ğŸ•¯ï¸', oneLine:"æº«æš–ä¸”ç›¡è²¬çš„å¹•å¾Œæ¨æ‰‹ã€‚", teamRole:"ç…§é¡§è€…ï¼Œè£œè¶³åœ˜éšŠç´°ç¯€ã€‚", careMost:"å’Œè«§èˆ‡ä»–äººçš„éœ€æ±‚ã€‚", coopTips:["çµ¦äºˆçœŸèª çš„æ„Ÿè¬","é¿å…å…¬é–‹æ‰¹è©•"], careerHint:["é©åˆåŠ©äººã€è¡Œæ”¿æˆ–é†«ç™‚é ˜åŸŸ"] },
                'INFJ': { t:'ç¥ç§˜å…ˆçŸ¥', e:'ğŸ”®', oneLine:"æ´å¯Ÿäººæ€§ï¼Œæ·±é‚ƒçš„ç†æƒ³ä¸»ç¾©è€…ã€‚", teamRole:"ç²¾ç¥é ˜è¢–ï¼Œçœ‹è¦‹é•·é é¡˜æ™¯ã€‚", careMost:"æ„ç¾©èˆ‡æ·±å±¤é€£çµã€‚", coopTips:["çµ¦ä»–å€‘æ™‚é–“ç¨è™•æ€è€ƒ","å°Šé‡ä»–å€‘çš„ç›´è¦º"], careerHint:["é©åˆè«®å•†ã€å¯«ä½œæˆ–éç‡Ÿåˆ©çµ„ç¹”"] },
                'INTJ': { t:'æˆ°ç•¥è»å¸«', e:'â™Ÿï¸', oneLine:"ç¨ç«‹é è¦‹ï¼Œè¿½æ±‚æ¥µè‡´æ•ˆç‡ã€‚", teamRole:"ç³»çµ±æ¶æ§‹å¸«ï¼Œå„ªåŒ–å…¨å±€ã€‚", careMost:"èƒ½åŠ›èˆ‡é‚è¼¯ã€‚", coopTips:["è¬›é‡é»ï¼Œä¸è¦å»¢è©±","ç”¨æ•¸æ“šèªªæœä»–å€‘"], careerHint:["é©åˆç ”ç™¼ã€ç­–ç•¥è¦åŠƒæˆ–ç§‘æŠ€æ¥­"] },
                'ISTP': { t:'å·¥åŒ å¤§å¸«', e:'ğŸ”§', oneLine:"å†·éœè§€å¯Ÿï¼Œè§£æ±ºå•é¡Œçš„é«˜æ‰‹ã€‚", teamRole:"æ•‘ç«éšŠï¼Œè§£æ±ºçªç™¼æŠ€è¡“é›£é¡Œã€‚", careMost:"è‡ªç”±èˆ‡å¯¦ç”¨æ€§ã€‚", coopTips:["ä¸è¦ç®¡å¤ªç´°","è®“ä»–å€‘å‹•æ‰‹åš"], careerHint:["é©åˆå·¥ç¨‹ã€æŠ€è¡“æˆ–æˆ¶å¤–å·¥ä½œ"] },
                'ISFP': { t:'éˆé­‚ç•«å¸«', e:'ğŸ¨', oneLine:"æº«å’Œæ•æ„Ÿï¼Œç”¨è¡Œå‹•è¡¨é”æƒ…æ„Ÿã€‚", teamRole:"ç¾æ„Ÿæ“”ç•¶ï¼Œç¶­è­·æ°›åœã€‚", careMost:"å€‹äººåƒ¹å€¼è§€èˆ‡ç¾ã€‚", coopTips:["çµ¦äºˆå‹å–„çš„ç©ºé–“","ä¸è¦å¼·è¿«ä»–å€‘ç«¶çˆ­"], careerHint:["é©åˆè¨­è¨ˆã€è—è¡“æˆ–è‡ªç”±æ¥­"] },
                'INFP': { t:'æ²»ç™’è©©äºº', e:'ğŸƒ', oneLine:"å¿ æ–¼è‡ªæˆ‘ï¼Œæº«æŸ”çš„å¤¢æƒ³å®¶ã€‚", teamRole:"åƒ¹å€¼å®ˆè­·è€…ï¼Œå–šé†’åˆè¡·ã€‚", careMost:"çœŸèª èˆ‡å…§åœ¨å’Œè«§ã€‚", coopTips:["æº«å’Œæºé€šï¼Œé¿å…è¡çª","æ”¯æŒä»–å€‘çš„ç†æƒ³"], careerHint:["é©åˆå‰µä½œã€è¼”å°æˆ–æ•™è‚²"] },
                'INTP': { t:'é‚è¼¯å­¸å®¶', e:'ğŸ§ª', oneLine:"æ¸´æœ›çŸ¥è­˜ï¼Œè§£æ§‹å®‡å®™çš„æ€è€ƒè€…ã€‚", teamRole:"åˆ†æå¸«ï¼Œæ‰¾å‡ºé‚è¼¯æ¼æ´ã€‚", careMost:"çœŸç†èˆ‡æº–ç¢ºæ€§ã€‚", coopTips:["æ¥å—ä»–å€‘çš„è³ªç–‘","çµ¦äºˆæ™ºåŠ›æŒ‘æˆ°"], careerHint:["é©åˆå­¸è¡“ç ”ç©¶ã€ç¨‹å¼é–‹ç™¼"] },
                'ESTP': { t:'æ¥µé™å†’éšªå®¶', e:'ğŸš€', oneLine:"æ´»åœ¨ç•¶ä¸‹ï¼Œè§£æ±ºç‡ƒçœ‰ä¹‹æ€¥ã€‚", teamRole:"è¡Œå‹•æ´¾ï¼Œæ¨å‹•äº‹æƒ…ç™¼ç”Ÿã€‚", careMost:"åˆºæ¿€èˆ‡çµæœã€‚", coopTips:["ç›´æ¥è¬›çµæœ","é™ªä»–å€‘ä¸€èµ·è¡"], careerHint:["é©åˆæ¥­å‹™ã€ç·Šæ€¥æ‡‰è®Šæˆ–å‰µæ¥­"] },
                'ESFP': { t:'è¶…ç´šå·¨æ˜Ÿ', e:'ğŸ¤', oneLine:"ç”Ÿæ°£å‹ƒå‹ƒï¼Œè®“ç”Ÿæ´»å……æ»¿æ¨‚è¶£ã€‚", teamRole:"æ°£æ°›è£½é€ è€…ï¼Œå‡èšåœ˜éšŠã€‚", careMost:"å¿«æ¨‚èˆ‡ç•¶ä¸‹é«”é©—ã€‚", coopTips:["å¤šä¸€é»è®šç¾èˆ‡äº’å‹•","ä¸è¦å¤ªåš´è‚…"], careerHint:["é©åˆå…¬é—œã€è¡¨æ¼”æˆ–æœå‹™æ¥­"] },
                'ENFP': { t:'ç†±è¡€å¤¢æƒ³å®¶', e:'ğŸŒˆ', oneLine:"ç†±æƒ…æ»¿é»ï¼Œçœ‹è¦‹ç„¡é™å¯èƒ½æ€§ã€‚", teamRole:"é»å­ç‹ï¼Œæ¿€å‹µäººå¿ƒã€‚", careMost:"å‰µæ„èˆ‡äººéš›é€£çµã€‚", coopTips:["é™ªä»–å€‘ç™¼æƒ³ï¼Œå†å¹«å¿™æ”¶æ–‚","çµ¦äºˆå½ˆæ€§"], careerHint:["é©åˆè¡ŒéŠ·ã€å‰µæ„æˆ–æ´»å‹•ç­–åŠƒ"] },
                'ENTP': { t:'åšå­¸è¾¯è«–å®¶', e:'âš¡', oneLine:"æ©Ÿæ™ºéˆæ´»ï¼Œå–œæ­¡æŒ‘æˆ°æ™ºåŠ›æ¥µé™ã€‚", teamRole:"å‰µæ–°è€…ï¼Œæ‰“ç ´æ¡†æ¶ã€‚", careMost:"å‰µæ–°èˆ‡æŒ‘æˆ°ã€‚", coopTips:["è·Ÿä»–å€‘è¾¯è«–æ˜¯ç¨®æ¨‚è¶£","ä¸è¦é™åˆ¶ä»–å€‘çš„æ–¹æ³•"], careerHint:["é©åˆé¡§å•ã€å‰µæ¥­æˆ–æ³•å¾‹"] },
                'ESTJ': { t:'å¤§å…ƒå¸¥', e:'âš–ï¸', oneLine:"æœæ–·ç®¡ç†ï¼Œå¤©ç”Ÿçš„æŒ‡æ®å®˜ã€‚", teamRole:"å°ˆæ¡ˆç¶“ç†ï¼Œç›¯ç·Šé€²åº¦ã€‚", careMost:"æ•ˆç‡èˆ‡è¦å‰‡ã€‚", coopTips:["å°Šé‡ä»–å€‘çš„æ¬Šå¨","æº–æ™‚å›å ±é€²åº¦"], careerHint:["é©åˆç®¡ç†ã€è¡Œæ”¿æˆ–è»è­¦"] },
                'ESFJ': { t:'äººæ°£æ”¯æŸ±', e:'ğŸ¤', oneLine:"ç†±å¿ƒåŠ©äººï¼Œé‡è¦–åœ˜éšŠå’Œè«§ã€‚", teamRole:"å‡èšè€…ï¼Œç…§é¡§å¤§å®¶æƒ…ç·’ã€‚", careMost:"æ­¸å±¬æ„Ÿèˆ‡èªåŒã€‚", coopTips:["å¤šåƒèˆ‡åœ˜é«”æ´»å‹•","è‚¯å®šä»–å€‘çš„ä»˜å‡º"], careerHint:["é©åˆæ•™è‚²ã€ç¤¾å·¥æˆ–å…¬é—œ"] },
                'ENFJ': { t:'ç²¾ç¥å°å¸«', e:'ğŸŒ»', oneLine:"å……æ»¿é­…åŠ›ï¼Œæ¿€å‹µä»–äººæˆé•·ã€‚", teamRole:"å°å¸«ï¼Œå¼•å°åœ˜éšŠæ–¹å‘ã€‚", careMost:"ä»–äººçš„æˆé•·èˆ‡å’Œè«§ã€‚", coopTips:["çœŸèª äº¤æµæƒ…æ„Ÿ","æ”¯æŒä»–å€‘çš„é¡˜æ™¯"], careerHint:["é©åˆæ•™å­¸ã€è¼”å°æˆ–é ˜å°è·"] },
                'ENTJ': { t:'å¸åœ‹çµ±å¸¥', e:'ğŸ‘‘', oneLine:"å¼·å‹¢é ˜å°ï¼Œçœ‹è¦‹é•·é å±€å‹¢ã€‚", teamRole:"æ±ºç­–è€…ï¼Œå¸¶é ˜è®Šé©ã€‚", careMost:"æˆå°±èˆ‡å½±éŸ¿åŠ›ã€‚", coopTips:["å±•ç¾ä½ çš„èƒ½åŠ›","è·Ÿä¸Šä»–å€‘çš„ç¯€å¥"], careerHint:["é©åˆé«˜éšç®¡ç†ã€é‡‘èæˆ–å‰µæ¥­"] }
            }
        };

        // (C) Enneagram Data
        const ennData = {
            qs: [
                {q:"æœ€å®³æ€•...", a:"åšéŒ¯äº‹(1)", b:"æ²’äººæ„›(2)", ta:[1], tb:[2]}, {q:"å¸Œæœ›åˆ¥äºº...", a:"è®šè³æˆå°±(3)", b:"ç†è§£ç¨ç‰¹(4)", ta:[3], tb:[4]},
                {q:"é‡å£“åŠ›...", a:"æŠ½é›¢åˆ†æ(5)", b:"å°‹æ±‚å®‰å…¨(6)", ta:[5], tb:[6]}, {q:"ç”Ÿæ´»...", a:"è¿½æ±‚å¿«æ¨‚(7)", b:"æŒæ§å±€é¢(8)", ta:[7], tb:[8]},
                {q:"äººéš›...", a:"é¿å…è¡çª(9)", b:"æ“šç†åŠ›çˆ­(8)", ta:[9], tb:[8]}, {q:"åƒ¹å€¼è§€...", a:"æ­£ç›´èˆ‡åŸå‰‡(1)", b:"é—œä¿‚èˆ‡é€£çµ(2)", ta:[1], tb:[2]},
                {q:"å‹•åŠ›ä¾†æº...", a:"æˆåŠŸèˆ‡ç›®æ¨™(3)", b:"ç¨ç‰¹èˆ‡æ„ç¾©(4)", ta:[3], tb:[4]}, {q:"é¢å°å•é¡Œ...", a:"æ”¶é›†è³‡è¨Š(5)", b:"å°‹æ±‚ç›Ÿå‹(6)", ta:[5], tb:[6]},
                {q:"äººç”Ÿè¿½æ±‚...", a:"è‡ªç”±èˆ‡é«”é©—(7)", b:"å’Œå¹³èˆ‡ç©©å®š(9)", ta:[7], tb:[9]}
            ],
            results: [
                null, 
                {t:"æ”¹é©è€…(1)", oneLine:"è¿½æ±‚å®Œç¾çš„ç†æƒ³ä¸»ç¾©è€…ã€‚", motive:"æŠŠäº‹æƒ…åšå°ï¼Œé¿å…çŠ¯éŒ¯ã€‚", stress:"è®Šå¾—éåº¦æŒ‘å‰”ã€æ†¤æ€’ã€‚", workStrength:["é«˜å“è³ªç”¢å‡º","æ¥µåº¦è‡ªå¾‹"], growthTips:["ç·´ç¿’æ¥å—ã€Œä¸å®Œç¾ã€","çµ¦è‡ªå·±å’Œåˆ¥äººå¤šé»å¯¬å®¹"]},
                {t:"åŠ©äººè€…(2)", oneLine:"æº«æš–æ…·æ…¨ï¼Œæ¸´æœ›è¢«æ„›çš„ä»˜å‡ºè€…ã€‚", motive:"è¢«éœ€è¦ï¼Œè¢«ä»–äººæ„Ÿæ¿€ã€‚", stress:"è®Šå¾—æƒ…ç·’åŒ–ã€è¨å¥½ã€‚", workStrength:["å–„è§£äººæ„","æ¥µä½³çš„åœ˜éšŠå”ä½œè€…"], growthTips:["å­¸ç¿’å•è‡ªå·±ï¼šæˆ‘ç¾åœ¨éœ€è¦ä»€éº¼ï¼Ÿ","ä¸è¦ç‚ºäº†æ›å–æ„›è€Œä»˜å‡º"]},
                {t:"æˆå°±è€…(3)", oneLine:"ç›®æ¨™å°å‘ï¼Œé©æ‡‰åŠ›å¼·çš„å¯¦è¸è€…ã€‚", motive:"æˆåŠŸï¼Œè¢«è‚¯å®šã€‚", stress:"è®Šå¾—å·¥ä½œç‹‚ã€å¿½è¦–æƒ…æ„Ÿã€‚", workStrength:["é«˜æ•ˆç‡","å½¢è±¡ç®¡ç†ä½³"], growthTips:["ä½ çš„åƒ¹å€¼ä¸ç­‰æ–¼ä½ çš„æˆå°±","ç·´ç¿’æ…¢ä¸‹ä¾†"]},
                {t:"è‡ªæˆ‘è€…(4)", oneLine:"æµªæ¼«æ•æ„Ÿï¼Œè¿½æ±‚ç¨ç‰¹çš„è—è¡“å®¶ã€‚", motive:"ç¨ä¸€ç„¡äºŒï¼Œæ·±åˆ»é«”é©—ã€‚", stress:"è®Šå¾—æ†‚é¬±ã€è‡ªæˆ‘å°é–‰ã€‚", workStrength:["ç¨ç‰¹å¯©ç¾","æƒ…æ„Ÿæ·±åº¦"], growthTips:["ä¸è¦éåº¦æ”¾å¤§æƒ…ç·’","å¾è¡Œå‹•ä¸­å»ºç«‹è‡ªä¿¡"]},
                {t:"èª¿æŸ¥å“¡(5)", oneLine:"å†·éœè§€å¯Ÿï¼Œæ±‚çŸ¥è‹¥æ¸´çš„æ€æƒ³å®¶ã€‚", motive:"ç†è§£ä¸–ç•Œï¼Œæ“æœ‰çŸ¥è­˜ã€‚", stress:"è®Šå¾—å­¤åƒ»ã€æ†¤ä¸–å«‰ä¿—ã€‚", workStrength:["æ·±åº¦åˆ†æ","å®¢è§€ç†æ€§"], growthTips:["å¤šèˆ‡äººåˆ†äº«ä½ çš„æƒ³æ³•","ä¸è¦æ´»åœ¨è…¦è¢‹è£¡"]},
                {t:"å¿ èª è€…(6)", oneLine:"è² è²¬è­¦è¦ºï¼Œå°‹æ±‚å®‰å…¨çš„å®ˆè­·è€…ã€‚", motive:"å®‰å…¨æ„Ÿï¼Œè¢«æ”¯æŒã€‚", stress:"è®Šå¾—ç„¦æ…®ã€å¤šç–‘ã€‚", workStrength:["é¢¨éšªæ§ç®¡","å¿ èª å¯é "], growthTips:["ç›¸ä¿¡è‡ªå·±çš„å…§åœ¨æŒ‡å¼•","å€åˆ†ã€Œè…¦è£œã€èˆ‡ç¾å¯¦"]},
                {t:"ç†±æƒ…è€…(7)", oneLine:"æ¨‚è§€å¤šæ‰ï¼Œè¿½æ±‚å¿«æ¨‚çš„å†’éšªå®¶ã€‚", motive:"å¿«æ¨‚ï¼Œé¿å…ç—›è‹¦ã€‚", stress:"è®Šå¾—è¡å‹•ã€é€ƒé¿å•é¡Œã€‚", workStrength:["å‰µæ„ç„¡é™","å¿«é€Ÿå­¸ç¿’"], growthTips:["ç·´ç¿’å°ˆæ³¨å®Œæˆä¸€ä»¶äº‹","é¢å°è² é¢æƒ…ç·’è€Œä¸é€ƒé¿"]},
                {t:"æŒ‘æˆ°è€…(8)", oneLine:"è‡ªä¿¡æœæ–·ï¼Œæ„å¿—å …å¼·çš„é ˜è¢–ã€‚", motive:"æŒæ§å±€é¢ï¼Œä¿è­·è‡ªå·±äººã€‚", stress:"è®Šå¾—ç¨è£ã€å…·æ”»æ“Šæ€§ã€‚", workStrength:["æ±ºç­–æœæ–·","èƒ½æ‰¿æ“”é‡ä»»"], growthTips:["å±•ç¾è„†å¼±ä¸æ˜¯è»Ÿå¼±","å­¸ç¿’æº«æŸ”çš„æºé€š"]},
                {t:"å’Œå¹³è€…(9)", oneLine:"éš¨å’ŒåŒ…å®¹ï¼Œè¿½æ±‚å’Œè«§çš„èª¿åœè€…ã€‚", motive:"å…§å¿ƒå¹³éœï¼Œé¿å…è¡çªã€‚", stress:"è®Šå¾—æ‡¶æ•£ã€è¢«å‹•æ”»æ“Šã€‚", workStrength:["æ¥ç´åº¦é«˜","å¾ˆå¥½çš„å‚¾è½è€…"], growthTips:["ç·´ç¿’è¡¨é”çœŸå¯¦çš„æ†¤æ€’","è¨­å®šå…·é«”ç›®æ¨™ä¸¦è¡Œå‹•"]}
            ]
        };

        // (D) RIASEC Data
        const riasecData = {
            qs: [{q:"ä¿®ç†é›»å™¨",t:'R'}, {q:"åˆ†ææ•¸æ“š",t:'I'}, {q:"ç¹ªç•«è¨­è¨ˆ",t:'A'}, {q:"æ•™å°ä»–äºº",t:'S'}, {q:"æ¨éŠ·ç”¢å“",t:'E'}, {q:"æ•´ç†æ–‡ä»¶",t:'C'}, {q:"æ“ä½œæ©Ÿæ¢°",t:'R'}, {q:"è§£æ±ºæ•¸å­¸é¡Œ",t:'I'}, {q:"æ¼”å¥æ¨‚å™¨",t:'A'}, {q:"ç…§é¡§ç—…äºº",t:'S'}, {q:"ç«¶é¸å¹¹éƒ¨",t:'E'}, {q:"åˆ¶å®šè¨ˆç•«",t:'C'}],
            results: { 
                'R': { name:"å¯¦ä½œå‹ (R)", oneLine:"å–œæ­¡å‹•æ‰‹åšï¼Œæ¯”èªªä¸€å †æœ‰æ„Ÿã€‚", workEnv:["ä½¿ç”¨å·¥å…·æˆ–æ©Ÿæ¢°","å…·é«”æ˜ç¢ºçš„ä»»å‹™"], suggest:["å°‹æ‰¾å·¥ç¨‹ã€æŠ€è¡“é¡å·¥ä½œ"] },
                'I': { name:"ç ”ç©¶å‹ (I)", oneLine:"å–œæ­¡æ€è€ƒåˆ†æï¼Œç†æ€§è§£æ±ºå•é¡Œã€‚", workEnv:["å­¸è¡“ç ”ç©¶","ç¨ç«‹æ€è€ƒçš„ç©ºé–“"], suggest:["å°‹æ‰¾ç ”ç™¼ã€æ•¸æ“šåˆ†æå·¥ä½œ"] },
                'A': { name:"è—è¡“å‹ (A)", oneLine:"è¿½æ±‚ç¨ç‰¹ï¼Œç”¨å‰µä½œè¡¨é”è‡ªæˆ‘ã€‚", workEnv:["è‡ªç”±å½ˆæ€§","å…è¨±å‰µæ„ç™¼æ®"], suggest:["å°‹æ‰¾è¨­è¨ˆã€å‰µä½œã€åª’é«”å·¥ä½œ"] },
                'S': { name:"ç¤¾äº¤å‹ (S)", oneLine:"ç†±å¿ƒåŠ©äººï¼Œå–œæ­¡èˆ‡äººäº’å‹•ã€‚", workEnv:["åœ˜éšŠåˆä½œ","æœå‹™ä»–äºº"], suggest:["å°‹æ‰¾æ•™è‚²ã€è«®å•†ã€æœå‹™æ¥­"] },
                'E': { name:"ä¼æ¥­å‹ (E)", oneLine:"å–œæ­¡é ˜å°èªªæœï¼Œè¿½æ±‚ç›®æ¨™ã€‚", workEnv:["ç«¶çˆ­æ€§","ç®¡ç†è·ä½"], suggest:["å°‹æ‰¾æ¥­å‹™ã€è¡ŒéŠ·ã€ç®¡ç†å·¥ä½œ"] },
                'C': { name:"äº‹å‹™å‹ (C)", oneLine:"å–œæ­¡è¦å¾‹ï¼Œè¬¹æ…è™•ç†ç´°ç¯€ã€‚", workEnv:["SOPæ˜ç¢º","äº•ç„¶æœ‰åº"], suggest:["å°‹æ‰¾è¡Œæ”¿ã€æœƒè¨ˆã€å“ç®¡å·¥ä½œ"] }
            }
        };

        // (E) Color Data
        const colorMeanings = { 
            4: { label:"ç´…è‰²", want:"è¡Œå‹•èˆ‡å¾æœ", state:"ä½ æœ€è¿‘å……æ»¿æ´»åŠ›ï¼Œæƒ³è¦è¡ç ´ç¾ç‹€ã€‚", selfCare:["æ‰¾å€‹å®‰å…¨çš„æŒ‘æˆ°ä¾†é‡‹æ”¾èƒ½é‡","é‹å‹•"] },
            5: { label:"é»ƒè‰²", want:"å¸Œæœ›èˆ‡å¿«æ¨‚", state:"ä½ åš®å¾€æœªä¾†ï¼Œå°‹æ±‚æ–°çš„å¯èƒ½æ€§ã€‚", selfCare:["å»æ—…è¡Œæˆ–å­¸ç¿’æ–°äº‹ç‰©","æ›¬å¤ªé™½"] },
            3: { label:"ç¶ è‰²", want:"å …æŒèˆ‡è‡ªå°Š", state:"ä½ å …æŒè‡ªå·±çš„åŸå‰‡ï¼Œæ¸´æœ›è¢«èªåŒã€‚", selfCare:["è‚¯å®šè‡ªå·±çš„åƒ¹å€¼","é©åº¦æ”¾é¬†æ¨™æº–"] },
            2: { label:"è—è‰²", want:"å¹³éœèˆ‡å®‰å¯§", state:"ä½ æ¸´æœ›ä¼‘æ¯ï¼Œé‡è¦–æ·±å±¤æƒ…æ„Ÿã€‚", selfCare:["é«˜å“è³ªçš„ç¡çœ ","èˆ‡çŸ¥å·±æ·±è«‡"] },
            6: { label:"ç´«è‰²", want:"ç¥ç§˜èˆ‡å¹»æƒ³", state:"ä½ æ„Ÿè¦ºæ•éŠ³ï¼Œè¿½æ±‚ç²¾ç¥å±¤æ¬¡ã€‚", selfCare:["æ¥è§¸è—è¡“","å†¥æƒ³"] },
            7: { label:"æ£•è‰²", want:"æ„Ÿå®˜èˆ’é©", state:"ä½ é‡è¦–èº«é«”æ„Ÿå—ï¼Œè¿½æ±‚å®‰ç©©ã€‚", selfCare:["åƒé “ç¾é£Ÿ","æ³¡ç†±æ°´æ¾¡"] },
            1: { label:"ç°è‰²", want:"éš”é›¢èˆ‡ä¿è­·", state:"ä½ æƒ³æš«æ™‚éš±å½¢ï¼Œèˆ‡å£“åŠ›ä¿æŒè·é›¢ã€‚", selfCare:["ç¨è™•","æ¸›å°‘ç¤¾äº¤"] },
            8: { label:"é»‘è‰²", want:"æŠ—æ‹’èˆ‡æŒæ§", state:"ä½ å¯èƒ½æ„Ÿåˆ°å—å£“ï¼Œè¡¨ç¾å‡ºå€”å¼·ã€‚", selfCare:["é‡‹æ”¾æ§åˆ¶æ¬²","å…è¨±äº‹æƒ…è‡ªç„¶ç™¼ç”Ÿ"] }
        };

        // (F) Animal Data
        const animalData = {
            qs: [{q:"çœ‹é‡...", a:"ç›®æ¨™(äº‹)", b:"é—œä¿‚(äºº)", ax:'x', v:-1}, {q:"æ­¥èª¿...", a:"å¿«", b:"æ…¢", ax:'y', v:-1}, {q:"é‡å•é¡Œ...", a:"ç›´æ¥è§£æ±º", b:"å°‹æ±‚å…±è­˜", ax:'x', v:-1}, {q:"åœ˜é«”ä¸­...", a:"ä¸»å°ç™¼è¨€", b:"å‚¾è½é…åˆ", ax:'y', v:-1}],
            results: { 
                'D': { t:"è€è™ (æ”¯é…å‹)", e:"ğŸ¯", oneLine:"è¬›è©±ç›´ã€å¾ˆæ•¢è¡çš„ç›®æ¨™æ´¾ã€‚", commStyle:"ç›´æˆªäº†ç•¶ï¼Œä¸å–œæ­¡ç¹åœˆå­ã€‚", beMisunderstood:"å¸¸è¢«è¦ºå¾—å¤ªå…‡æˆ–æ²’è€å¿ƒã€‚", coopTips:["è¬›é‡é»ï¼Œä¸è¦æµªè²»æ™‚é–“","è®“ä»–ç•¶éšŠé•·"], selfAdjust:["ç·´ç¿’å¤šè½åˆ¥äººè¬›å®Œ","é–‹å£å‰å…ˆæ·±å‘¼å¸"] },
                'I': { t:"å­”é›€ (å½±éŸ¿å‹)", e:"ğŸ¦š", oneLine:"ç†±æƒ…æ´‹æº¢ï¼Œç¤¾äº¤å ´çš„ç„¦é»ã€‚", commStyle:"ç”Ÿå‹•æœ‰è¶£ï¼Œå–œæ­¡è‚¢é«”èªè¨€ã€‚", beMisunderstood:"å¸¸è¢«è¦ºå¾—åªæœƒèªªä¸æœƒåšã€‚", coopTips:["çµ¦ä»–èˆå°å’Œè®šç¾","å¹«ä»–æ³¨æ„ç´°ç¯€"], selfAdjust:["ç·´ç¿’æŠŠç´°ç¯€è¨˜ä¸‹ä¾†","èªªåˆ°è¦åšåˆ°"] },
                'S': { t:"ç„¡å°¾ç†Š (ç©©å¥å‹)", e:"ğŸ¨", oneLine:"æº«å’Œå‹å–„ï¼Œå¯é çš„éšŠå‹ã€‚", commStyle:"æº«å’Œå©‰è½‰ï¼Œä¸å–œæ­¡è¡çªã€‚", beMisunderstood:"å¸¸è¢«è¦ºå¾—æ²’ä¸»è¦‹ã€‚", coopTips:["çµ¦ä»–å®‰å…¨æ„Ÿå’Œæ™‚é–“","ä¸è¦å‚¬ä¿ƒä»–"], selfAdjust:["ç·´ç¿’è¡¨é”è‡ªå·±çš„éœ€æ±‚","é©æ™‚èªªå‡ºåå°æ„è¦‹"] },
                'C': { t:"è²“é ­é·¹ (åˆ†æå‹)", e:"ğŸ¦‰", oneLine:"ç²¾æº–åš´è¬¹ï¼Œé‚è¼¯çš„è¿½æ±‚è€…ã€‚", commStyle:"è¬›æ±‚è­‰æ“šï¼Œé‡è¦–é‚è¼¯ã€‚", beMisunderstood:"å¸¸è¢«è¦ºå¾—å¤ªé¾œæ¯›æˆ–å†·æ¼ ã€‚", coopTips:["æå‡ºæ•¸æ“šå’Œäº‹å¯¦","å°Šé‡ä»–çš„æ¨™æº–"], selfAdjust:["ç·´ç¿’æ¥å—ä¸å®Œç¾","å¤šè¡¨é”è‚¯å®š"] }
            }
        };

        // --- éŠæˆ²ç‹€æ…‹ç®¡ç† ---
        const lobbyNodes = [ { id: 'BIG5', active: true }, { id: 'MBTI', active: true }, { id: 'ENNEAGRAM', active: true }, { id: 'RIASEC', active: true }, { id: 'COLOR', active: true }, { id: 'ANIMAL', active: true } ];
        lobbyNodes.forEach(n => Object.assign(n, styles.nodes[n.id]));

        let gameSt = { 
            big5: {idx:0, ans:3, scores:{O:0,C:0,E:0,A:0,N:0}, done:false}, 
            mbti: {idx:0, scores:{ei:0,sn:0,tf:0,jp:0}, done:false}, 
            enn: {idx:0, scores:new Array(10).fill(0), done:false}, 
            riasec: {idx:0, scores:{R:0,I:0,A:0,S:0,E:0,C:0}, done:false}, 
            color: {phase:0, sel:[], auraT:0, done:false}, 
            animal: {idx:0, pos:{x:0, y:0}, done:false} 
        };

        // --- åˆå§‹åŒ–ç³»çµ± ---
        function getSafeHeight() { return window.visualViewport ? window.visualViewport.height : window.innerHeight; }
        
        function init() {
            dpr = window.devicePixelRatio || 1;
            width = window.visualViewport ? window.visualViewport.width : window.innerWidth;
            height = getSafeHeight();
            canvas.style.width = width + "px";
            canvas.style.height = height + "px";
            canvas.width = width * dpr; 
            canvas.height = height * dpr;
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            isMobile = width < 768;
            initStars();
        }

        const stars = []; const shootingStars = [];
        function initStars() { stars.length = 0; for(let i=0; i<150; i++) stars.push({ x: Math.random()*width, y: Math.random()*height, z: Math.random()*2+0.5, size: Math.random()*1.5, alpha: Math.random() }); }
        
        class ShootingStar { 
            constructor(){this.reset();} 
            reset(){this.x=Math.random()*width;this.y=Math.random()*height*0.5;this.len=Math.random()*80+20;this.speed=Math.random()*15+10;this.size=Math.random()*2;this.angle=Math.PI/4;this.active=true;this.life=1;} 
            update(){this.x-=this.speed;this.y+=this.speed;this.life-=0.02;if(this.x<-100||this.y>height+100||this.life<=0)this.active=false;} 
            draw(){if(!this.active)return;const tx=this.x+this.len*Math.cos(this.angle);const ty=this.y-this.len*Math.sin(this.angle);const g=ctx.createLinearGradient(this.x,this.y,tx,ty);g.addColorStop(0,'rgba(255,255,255,'+this.life+')');g.addColorStop(1,'rgba(255,255,255,0)');ctx.strokeStyle=g;ctx.lineWidth=this.size;ctx.beginPath();ctx.moveTo(this.x,this.y);ctx.lineTo(tx,ty);ctx.stroke();} 
        }

        window.addEventListener("resize", () => setTimeout(init, 150));
        window.addEventListener('deviceorientation', (e) => { if(e.gamma && e.beta) { gyro.x = e.gamma * 2; gyro.y = (e.beta - 45) * 2; } });
        
        // --- è¼¸å…¥è™•ç† (ä¿®å¾© iOS åç§») ---
        const getPos = (e) => { const r = canvas.getBoundingClientRect(); return { x: e.clientX - r.left, y: e.clientY - r.top }; };
        const handleInput = (x, y, isClick) => {
            if(isClick) mouse.down = true;
            mouse.x = x; mouse.y = y;
            let worldX = x, worldY = y;
            if (currentScene === 'LOBBY') { 
                worldX = (x - width/2) / camera.zoom + width/2 + camera.x;
                worldY = (y - height/2) / camera.zoom + height/2 + camera.y;
            }
            let found = false;
            for (let z of hitZones) {
                let hit = false;
                if (z.t === 'circle') hit = Math.hypot(worldX - z.x, worldY - z.y) < z.r;
                else hit = (worldX >= z.x && worldX <= z.x+z.w && worldY >= z.y && worldY <= z.y+z.h);
                if (hit) { 
                    document.body.style.cursor = 'pointer'; found = true; 
                    if (isClick && z.action) { z.action(worldX, worldY); return; } 
                }
            }
            if(!found) document.body.style.cursor = 'default';
        };

        canvas.addEventListener('mousemove', e => { const p=getPos(e); handleInput(p.x, p.y, false); });
        canvas.addEventListener('mousedown', e => { const p=getPos(e); handleInput(p.x, p.y, true); });
        canvas.addEventListener('mouseup', () => mouse.down=false);
        canvas.addEventListener('touchmove', e => { e.preventDefault(); const p=getPos(e.touches[0]); handleInput(p.x, p.y, false); }, {passive:false});
        canvas.addEventListener('touchstart', e => { e.preventDefault(); const p=getPos(e.touches[0]); handleInput(p.x, p.y, true); }, {passive:false});

        // --- éŠæˆ²å¾ªç’° ---
        function loop() {
            camera.zoom += (camera.targetZoom - camera.zoom)*0.05;
            camera.x += (camera.targetX - camera.x)*0.05; camera.y += (camera.targetY - camera.y)*0.05;
            ctx.clearRect(0,0,width,height); hitZones=[];
            
            drawStars();
            
            if(currentScene==='LOBBY'||currentScene==='TRANSITION') {
                ctx.save(); ctx.translate(width/2, height/2);
                ctx.scale(camera.zoom, camera.zoom); ctx.translate(-width/2-camera.x, -height/2-camera.y);
                drawLobby(); ctx.restore();
                if(camera.zoom < 1.5) {
                    ctx.fillStyle='rgba(255,255,255,0.3)'; ctx.font='12px Orbitron'; ctx.textAlign='center';
                    ctx.fillText("Copyright Â© JOBUS ASIA 2025", width/2, height-SAFE_BOTTOM/2);
                }
            } else {
                if(currentScene==='BIG5') drawBig5();
                else if(currentScene==='MBTI') drawMBTI(); 
                else if(currentScene==='ENNEAGRAM') drawEnneagram();
                else if(currentScene==='RIASEC') drawRIASEC(); 
                else if(currentScene==='COLOR') drawColorTest(); 
                else if(currentScene==='ANIMAL') drawAnimalTest();
            }
            requestAnimationFrame(loop);
        }

        // --- ç¹ªåœ–å¼•æ“ (Helper Functions) ---
        
        function wrapText(txt, x, y, maxW, lh) {
            if(!txt) return y;
            const chars = txt.split(''); 
            let line = ''; 
            let cy = y;
            for(let n=0; n<chars.length; n++) {
                const test = line + chars[n];
                if(ctx.measureText(test).width > maxW && n > 0) { 
                    ctx.fillText(line, x, cy); 
                    line = chars[n]; 
                    cy += lh;
                } else { 
                    line = test;
                }
            }
            ctx.fillText(line, x, cy);
            return cy + lh; 
        }

        function drawSectionTitle(title, x, y, color='#fff') {
            ctx.fillStyle = color;
            ctx.font = 'bold 18px "Noto Sans TC"';
            ctx.textAlign = 'left';
            ctx.fillText(title, x, y);
            return y + 30;
        }

        function drawBulletList(list, x, y, maxW, lh=24) {
            ctx.textAlign = 'left';
            ctx.font = '16px "Noto Sans TC"';
            ctx.fillStyle = '#ddd';
            let cy = y;
            if(!list || list.length===0) return cy;
            list.forEach(item => {
                const bullet = "â€¢ ";
                const chars = item.split('');
                let line = bullet;
                for(let n=0; n<chars.length; n++) {
                    const test = line + chars[n];
                    if(ctx.measureText(test).width > maxW && n>0) {
                        ctx.fillText(line, x, cy);
                        line = "  " + chars[n]; 
                        cy += lh;
                    } else {
                        line = test;
                    }
                }
                ctx.fillText(line, x, cy);
                cy += lh * 1.2;
            });
            return cy + 10;
        }

        function drawCard(x, y, w, h, t, txt, c, act) { 
            const hover=Math.abs(mouse.x - x) < w/2 && Math.abs(mouse.y - (y+h/2)) < h/2;
            ctx.strokeStyle=hover?c:'#555'; ctx.lineWidth=2; ctx.fillStyle=hover?'rgba(255,255,255,0.12)':'rgba(30,30,30,0.85)';
            ctx.beginPath();
            ctx.roundRect(x-w/2, y, w, h, 15); ctx.fill(); ctx.stroke();
            ctx.fillStyle=c; ctx.font='30px Orbitron'; ctx.textAlign='center'; 
            ctx.fillText(t, x, y+45);
            ctx.fillStyle='#fff'; ctx.font='20px "Noto Sans TC"';
            wrapText(txt, x, y+85, w-40, 26);
            hitZones.push({t:'rect', x:x-w/2, y:y, w:w, h:h, action:act});
        }

        function drawBtn(x, y, txt, color, act, w=200) {
            const h=50;
            const hover = Math.abs(mouse.x - x) < w/2 && Math.abs(mouse.y - (y+h/2)) < h/2;
            ctx.fillStyle=hover?'#fff':color; ctx.beginPath();
            ctx.roundRect(x-w/2, y, w, h, 25); ctx.fill();
            ctx.fillStyle=hover?'#000':'#fff'; ctx.textAlign='center'; ctx.font='bold 18px "Noto Sans TC"'; ctx.fillText(txt, x, y+32);
            hitZones.push({t:'rect', x:x-w/2, y:y, w:w, h:h, action:act});
        }

        function drawTitle(txt, x, y, color) { 
            ctx.textAlign='center';
            ctx.fillStyle=color; ctx.font='bold 32px "Noto Sans TC"'; 
            ctx.shadowColor=color; ctx.shadowBlur=20; ctx.fillText(txt, x, y); ctx.shadowBlur=0;
        }

        function drawProgress(curr, total) { 
            ctx.textAlign='right'; ctx.fillStyle='#00f3ff'; ctx.font='16px Orbitron'; 
            ctx.fillText(`${curr}/${total}`, width-20, SAFE_TOP + 20);
        }

        // --- LOBBY ç¹ªè£½é‚è¼¯ ---
        let lobbyRot = 0;
        function drawLobby() {
            lobbyRot += 0.0005; const cx=width/2, cy=height/2;
            const r = Math.min(width, height) * (isMobile ? 0.35 : 0.32);
            drawCentralStar(cx, cy);
            ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.strokeStyle='rgba(255,255,255,0.05)'; ctx.lineWidth=1; ctx.stroke();
            lobbyNodes.forEach((node, i) => {
                const ang=(i/6)*Math.PI*2+lobbyRot; const nx=cx+Math.cos(ang)*r; const ny=cy+Math.sin(ang)*r;
                const wx=(mouse.x-width/2)/camera.zoom+width/2+camera.x; const wy=(mouse.y-height/2)/camera.zoom+height/2+camera.y;
                const hover=Math.hypot(wx-nx, wy-ny)<70; drawPlanetIcon(node, nx, ny, hover);
                if(camera.zoom<2) hitZones.push({t:'circle', x:nx, y:ny, r:70, action:()=>enterGame(node.id, nx, ny)});
            });
        }
        function drawCentralStar(cx, cy) {
            const p = Math.sin(Date.now()*0.003)*10;
            const g = ctx.createRadialGradient(cx, cy, 20, cx, cy, 100+p); g.addColorStop(0,'rgba(255,255,255,0.8)'); g.addColorStop(0.2,'#ff0055'); g.addColorStop(1,'transparent');
            ctx.fillStyle=g; ctx.beginPath(); ctx.arc(cx, cy, 100+p, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle='#ff0055'; ctx.beginPath(); ctx.arc(cx, cy, 35, 0, Math.PI*2); ctx.fill();
            if(camera.zoom < 1.5) {
                ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.shadowColor='rgba(0,0,0,0.5)'; ctx.shadowBlur=4; 
                ctx.fillStyle='#fff'; ctx.font='900 24px "Noto Sans TC"'; ctx.fillText("å¿ƒç†å®‡å®™", cx, cy-10); ctx.shadowBlur=0;
                ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.font='700 10px Orbitron'; ctx.fillText("M I N D V E R S E", cx, cy+15); ctx.textBaseline='alphabetic';
            }
        }
        
        // âœ… [RESTORED] Original Icon Drawing Logic
        function drawPlanetIcon(n, x, y, hover) {
            const scale=hover?1.2:1.0;
            ctx.save(); ctx.translate(x, y); ctx.scale(scale, scale);
            if(hover){ctx.shadowColor=n.glow; ctx.shadowBlur=30;}
            ctx.fillStyle='rgba(10,10,20,0.8)'; ctx.beginPath();
            ctx.arc(0,0,50,0,Math.PI*2); ctx.fill();
            ctx.shadowBlur=0; ctx.lineWidth=3; ctx.strokeStyle=n.color;

            // 1. BIG5 (Pentagon)
            if(n.type==='pentagon'){ 
                ctx.beginPath(); for(let i=0;i<5;i++){const a=(i/5)*Math.PI*2-Math.PI/2;ctx.lineTo(Math.cos(a)*35,Math.sin(a)*35);}ctx.closePath();ctx.stroke(); 
                ctx.lineWidth=1;ctx.beginPath();for(let i=0;i<5;i++){const a=(i/5)*Math.PI*2-Math.PI/2;ctx.lineTo(Math.cos(a)*20,Math.sin(a)*20);}ctx.closePath();ctx.stroke();
            }
            // 2. RIASEC (Hexagon)
            else if(n.type==='hexagon'){ 
                ctx.beginPath(); for(let i=0;i<6;i++){const a=(i/6)*Math.PI*2;ctx.lineTo(Math.cos(a)*35,Math.sin(a)*35);}ctx.closePath();ctx.stroke(); 
                ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(0,-35);ctx.lineTo(0,35);ctx.stroke();
            }
            // 3. ENNEAGRAM (Nonagon)
            else if(n.type==='nonagon'){ 
                ctx.beginPath(); for(let i=0;i<9;i++){const a=(i/9)*Math.PI*2-Math.PI/2;ctx.lineTo(Math.cos(a)*38,Math.sin(a)*38);}ctx.closePath();ctx.stroke();
                ctx.lineWidth=1;ctx.beginPath();for(let i=0;i<3;i++){const a=(i/3)*Math.PI*2-Math.PI/2;ctx.lineTo(Math.cos(a)*38,Math.sin(a)*38);}ctx.closePath();ctx.stroke(); 
            }
            // 4. ANIMAL (Radar + Paw Print)
            else if(n.type==='radar'){ 
                ctx.lineWidth=2;ctx.beginPath();ctx.arc(0,0,35,0,Math.PI*2);ctx.stroke();
                ctx.beginPath();ctx.arc(0,0,22,0,Math.PI*2);ctx.stroke(); 
                ctx.fillStyle=n.color;
                ctx.beginPath();ctx.ellipse(0,5,8,6,0,0,Math.PI*2);ctx.fill();
                ctx.beginPath();ctx.arc(-10,-5,4,0,Math.PI*2);ctx.fill();
                ctx.beginPath();ctx.arc(0,-10,4,0,Math.PI*2);ctx.fill();
                ctx.beginPath();ctx.arc(10,-5,4,0,Math.PI*2);ctx.fill();
            }
            // 5. COLOR (Rainbow Gradient)
            else if(n.type==='rainbow'){ 
                const gr=ctx.createLinearGradient(-35,-35,35,35);
                gr.addColorStop(0,'#f00');gr.addColorStop(0.2,'#ff0');gr.addColorStop(0.4,'#0f0');gr.addColorStop(0.6,'#0ff');gr.addColorStop(0.8,'#00f');gr.addColorStop(1,'#f0f');
                ctx.fillStyle=gr;ctx.beginPath();ctx.arc(0,0,35,0,Math.PI*2);ctx.fill();
            }
            // 6. MBTI (Core - Red + Orange)
            else if(n.type==='core'){ 
                ctx.fillStyle='#ff3333';ctx.beginPath();ctx.arc(0,0,35,0,Math.PI*2);ctx.fill();
                ctx.fillStyle='#ff6600';ctx.beginPath();ctx.arc(0,0,18,0,Math.PI*2);ctx.fill();
            }
            
            ctx.strokeStyle=n.color; ctx.lineWidth=1; ctx.globalAlpha=0.5; ctx.beginPath(); ctx.arc(0,0,50,0,Math.PI*2); ctx.stroke(); ctx.globalAlpha=1;
            ctx.restore();
            
            // Label always visible
            ctx.fillStyle = hover ? '#fff' : 'rgba(255,255,255,0.7)'; 
            ctx.font = (hover ? 'bold ' : '') + '16px "Noto Sans TC"'; 
            ctx.textAlign='center'; ctx.shadowColor='#000'; ctx.shadowBlur=4;
            ctx.fillText(n.label, x, y+65*scale); ctx.shadowBlur=0;
        }

        function drawStars() {
            ctx.fillStyle = styles.bg; ctx.fillRect(0,0,width,height);
            if(Math.random() < 0.03) shootingStars.push(new ShootingStar());
            stars.forEach(s => {
                const offX = (mouse.x - width/2) * 0.02 * s.z + gyro.x;
                const offY = (mouse.y - height/2) * 0.02 * s.z + gyro.y;
                ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
                ctx.beginPath(); ctx.arc(s.x + offX, s.y + offY, s.size, 0, Math.PI*2); ctx.fill();
            });
            for(let i=shootingStars.length-1; i>=0; i--) { const s = shootingStars[i]; s.update(); s.draw(); if(!s.active) shootingStars.splice(i, 1); }
        }

        // --- Transitions ---
        function enterGame(id, targetX, targetY) {
            activeGameId = id; currentScene = 'TRANSITION';
            camera.targetZoom = 5; camera.targetX = targetX - width/2; camera.targetY = targetY - height/2;
            setTimeout(() => {
                if(id==='BIG5') startBig5(); if(id==='MBTI') startMBTI(); if(id==='ENNEAGRAM') startEnneagram();
                if(id==='RIASEC') startRIASEC(); if(id==='COLOR') startColorTest(); if(id==='ANIMAL') startAnimalTest();
                currentScene = id; camera.zoom = 1; camera.x = 0; camera.y = 0; 
            }, 1500);
        }
        function returnLobby() { currentScene = 'LOBBY'; camera.zoom = 5; camera.targetZoom = 1; camera.x = 0; camera.y = 0; camera.targetX = 0; camera.targetY = 0; }

        // --- 1. BIG 5 GAME ---
        function startBig5() { gameSt.big5 = { idx:0, ans:3, scores:{O:0,C:0,E:0,A:0,N:0}, done:false }; }
        function drawBig5() {
            const st = gameSt.big5; const cx = width/2, cy = height/2;
            ctx.fillStyle = 'rgba(10,15,30,0.95)'; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = big5Data.qs[st.idx];
                drawProgress(st.idx+1, big5Data.qs.length);
                drawTitle("äº”å¤§æ€§æ ¼åˆ†æ", cx, SAFE_TOP + 50, styles.nodes.BIG5.color);
                
                ctx.fillStyle='#fff'; ctx.font='28px "Noto Sans TC"'; ctx.textAlign='center';
                wrapText(q.t, cx, cy-50, Math.min(600, width-60), 40);
                
                // Slider (Fixed for iOS)
                const sw = Math.min(300, width-80);
                const sy = cy+80; ctx.fillStyle = '#444'; ctx.fillRect(cx-sw/2, sy, sw, 6);
                const hx = cx - sw/2 + (sw * (st.ans-1)/4);
                
                // Enhanced Slider HitZone
                hitZones.push({
                    t:'rect', x:cx-sw/2-20, y:sy-30, w:sw+40, h:60,
                    action: (mx, my) => {
                        const ratio = (mx - (cx - sw/2)) / sw;
                        st.ans = Math.max(1, Math.min(5, Math.round(ratio*4+1)));
                    }
                });
                
                ctx.beginPath(); ctx.arc(hx, sy+3, 12, 0, Math.PI*2); ctx.fillStyle='#00f3ff'; ctx.fill();
                ctx.fillStyle='#888'; ctx.font='16px "Noto Sans TC"'; 
                ctx.textAlign='left'; ctx.fillText("ä¸åŒæ„", cx-sw/2, sy+40);
                ctx.textAlign='right'; ctx.fillText("åŒæ„", cx+sw/2, sy+40);
                
                drawBtn(cx, height-SAFE_BOTTOM-80, "ä¸‹ä¸€é¡Œ", styles.nodes.BIG5.color, () => {
                    const sc = st.ans - 3; st.scores[q.k] += q.rev ? -sc : sc;
                    if(st.idx < big5Data.qs.length-1) { st.idx++; st.ans=3; } else st.done = true;
                });
            } else {
                let maxK='O', maxV=-99;
                for(let k in st.scores) if(st.scores[k]>maxV) { maxV=st.scores[k]; maxK=k; }
                const res = big5Data.results[maxK];
                
                // Result Layout
                drawTitle("åˆ†æå®Œæˆ", cx, SAFE_TOP + 40, styles.nodes.BIG5.color);
                
                // Radar
                drawRadar(cx, SAFE_TOP + 120, 70, st.scores);
                
                ctx.textAlign='center'; ctx.font='bold 28px "Noto Sans TC"'; ctx.fillStyle='#fff';
                ctx.fillText(res.t, cx, SAFE_TOP + 220);
                ctx.font='18px "Noto Sans TC"'; ctx.fillStyle='#ccc';
                wrapText(res.oneLine, cx, SAFE_TOP + 250, width-40, 26);
                
                // Scrollable Content Mockup (using static Y)
                let textY = SAFE_TOP + 290;
                const maxW = Math.min(width * 0.85, 500);
                const startX = cx - maxW/2;
                
                textY = drawSectionTitle("ã€ç”Ÿæ´»ä¸­çš„ä½ ã€‘", startX, textY, '#00f3ff');
                textY = wrapText(res.life, startX, textY, maxW, 24) + 15;
                
                textY = drawSectionTitle("ã€å·¥ä½œå„ªå‹¢ã€‘", startX, textY, '#00f3ff');
                textY = drawBulletList(res.workStrength, startX, textY, maxW);
                
                textY = drawSectionTitle("ã€ç›²é»èˆ‡é¢¨éšªã€‘", startX, textY, '#ff6666');
                textY = drawBulletList(res.workRisk, startX, textY, maxW);
                
                drawBtn(cx, height-SAFE_BOTTOM-60, "è¿”å›å¿ƒç†å®‡å®™", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function drawRadar(cx, cy, r, scores) {
            const keys=['O','C','E','A','N'];
            ctx.strokeStyle='#555'; ctx.beginPath();
            for(let i=0;i<5;i++){ const a=i/5*Math.PI*2-Math.PI/2; ctx.lineTo(cx+Math.cos(a)*r, cy+Math.sin(a)*r); } ctx.closePath(); ctx.stroke();
            ctx.fillStyle='rgba(0,243,255,0.3)'; ctx.beginPath();
            keys.forEach((k,i)=>{ const v=Math.max(0.2, (scores[k]+6)/12)*r; ctx.lineTo(cx+Math.cos(i/5*Math.PI*2-Math.PI/2)*v, cy+Math.sin(i/5*Math.PI*2-Math.PI/2)*v); });
            ctx.closePath(); ctx.fill();
            // Labels
            ctx.fillStyle='#fff'; ctx.font='12px Orbitron'; ctx.textAlign='center';
            keys.forEach((k,i)=>{ const a=i/5*Math.PI*2-Math.PI/2; ctx.fillText(k, cx+Math.cos(a)*(r+15), cy+Math.sin(a)*(r+15)+5); });
        }

        // --- 2. MBTI GAME ---
        function startMBTI() { gameSt.mbti = { idx:0, scores:{ei:0,sn:0,tf:0,jp:0}, done:false }; }
        function drawMBTI() {
            const st = gameSt.mbti; const cx = width/2, cy = height/2; ctx.fillStyle = '#1a0505'; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = mbtiData.qs[st.idx];
                drawProgress(st.idx+1, mbtiData.qs.length);
                drawTitle("RPG è·æ¥­æ¸¬é©—", cx, SAFE_TOP + 50, styles.nodes.MBTI.color);
                
                ctx.fillStyle='#fff'; ctx.font='28px "Noto Sans TC"'; ctx.textAlign='center';
                wrapText(q.q, cx, cy-80, Math.min(600, width-60), 40);
                
                // RWD Cards
                if (isMobile) {
                    drawCard(cx, cy+20, width-60, 90, "A", q.a, '#ff3333', ()=>{ st.scores[q.d]-=q.v; nextMBTI(); });
                    drawCard(cx, cy+130, width-60, 90, "B", q.b, '#ff3333', ()=>{ st.scores[q.d]+=q.v; nextMBTI(); });
                } else {
                    drawCard(cx-160, cy+60, 280, 160, "A", q.a, '#ff3333', ()=>{ st.scores[q.d]-=q.v; nextMBTI(); });
                    drawCard(cx+160, cy+60, 280, 160, "B", q.b, '#ff3333', ()=>{ st.scores[q.d]+=q.v; nextMBTI(); });
                }
            } else {
                const type = (st.scores.ei<0?'E':'I')+(st.scores.sn<0?'S':'N')+(st.scores.tf<0?'T':'F')+(st.scores.jp<0?'J':'P');
                const res = mbtiData.results[type] || mbtiData.results['ISTJ'];
                
                drawTitle(res.t + " " + res.e, cx, SAFE_TOP + 50, '#ffcc00');
                ctx.font='20px Orbitron'; ctx.fillStyle='#fff'; ctx.textAlign='center';
                ctx.fillText(type, cx, SAFE_TOP + 90);
                ctx.font='18px "Noto Sans TC"'; ctx.fillStyle='#ccc';
                ctx.fillText(res.oneLine, cx, SAFE_TOP + 120);

                let textY = SAFE_TOP + 160;
                const maxW = Math.min(width * 0.85, 520);
                const startX = cx - maxW/2;

                textY = drawSectionTitle("ã€åœ˜éšŠè§’è‰²ã€‘", startX, textY, '#ffcc00');
                textY = wrapText(res.teamRole, startX, textY, maxW, 26) + 15;

                textY = drawSectionTitle("ã€æœ€åœ¨æ„çš„æ˜¯ã€‘", startX, textY, '#ffcc00');
                textY = wrapText(res.careMost, startX, textY, maxW, 26) + 15;

                textY = drawSectionTitle("ã€åˆä½œå°ç§˜è¨£ã€‘", startX, textY, '#ff9999');
                textY = drawBulletList(res.coopTips, startX, textY, maxW);

                textY = drawSectionTitle("ã€è·æ¶¯é©é…ã€‘", startX, textY, '#99ff99');
                textY = drawBulletList(res.careerHint, startX, textY, maxW);

                drawBtn(cx, height-SAFE_BOTTOM-60, "è¿”å›å¿ƒç†å®‡å®™", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function nextMBTI() { if(gameSt.mbti.idx < mbtiData.qs.length-1) gameSt.mbti.idx++; else gameSt.mbti.done=true; }

        // --- 3. ENNEAGRAM GAME ---
        function startEnneagram() { gameSt.enn = { idx:0, scores:new Array(10).fill(0), done:false }; }
        function drawEnneagram() {
            const st = gameSt.enn; const cx=width/2, cy=height/2;
            const g = ctx.createLinearGradient(0,0,0,height); g.addColorStop(0,'#1a1005'); g.addColorStop(1,'#000'); ctx.fillStyle=g; ctx.fillRect(0,0,width,height);
            
            if(!st.done) {
                const q = ennData.qs[st.idx];
                drawProgress(st.idx+1, ennData.qs.length);
                drawTitle("ä¹å‹äººæ ¼", cx, SAFE_TOP + 50, styles.nodes.ENNEAGRAM.color);
                
                ctx.fillStyle='#fff'; ctx.font='26px "Noto Sans TC"'; ctx.textAlign='center';
                wrapText(q.q, cx, cy-80, Math.min(600, width-60), 40);
                
                const w = isMobile ? width-60 : 320;
                const h = 60;
                drawBtn(cx, cy+10, q.a, '#cd7f32', ()=>{ q.ta.forEach(x=>st.scores[x]++); nextEnn(); }, w);
                drawBtn(cx, cy+90, q.b, '#555', ()=>{ q.tb.forEach(x=>st.scores[x]++); nextEnn(); }, w);
            } else {
                let max = -1, type = 1;
                for(let i=1;i<=9;i++) if(st.scores[i]>max) { max=st.scores[i]; type=i; }
                const res = ennData.results[type];
                
                drawTitle(res.t, cx, SAFE_TOP + 50, '#ffd700');
                ctx.font='18px "Noto Sans TC"'; ctx.fillStyle='#ccc'; ctx.textAlign='center';
                wrapText(res.oneLine, cx, SAFE_TOP + 90, width-40, 26);
                
                let textY = SAFE_TOP + 140;
                const maxW = Math.min(width * 0.85, 520);
                const startX = cx - maxW/2;
                
                textY = drawSectionTitle("ã€æ ¸å¿ƒå‹•æ©Ÿã€‘", startX, textY, '#ffd700');
                textY = wrapText(res.motive, startX, textY, maxW, 26) + 15;
                
                textY = drawSectionTitle("ã€å£“åŠ›åæ‡‰ã€‘", startX, textY, '#ff6666');
                textY = wrapText(res.stress, startX, textY, maxW, 26) + 15;
                
                textY = drawSectionTitle("ã€å·¥ä½œå„ªå‹¢ã€‘", startX, textY, '#ffd700');
                textY = drawBulletList(res.workStrength, startX, textY, maxW);
                
                textY = drawSectionTitle("ã€æˆé•·å»ºè­°ã€‘", startX, textY, '#66ff66');
                textY = drawBulletList(res.growthTips, startX, textY, maxW);
                
                drawBtn(cx, height-SAFE_BOTTOM-60, "è¿”å›å¿ƒç†å®‡å®™", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function nextEnn() { if(gameSt.enn.idx < ennData.qs.length-1) gameSt.enn.idx++; else gameSt.enn.done=true; }

        // --- 4. RIASEC GAME ---
        function startRIASEC() { gameSt.riasec = { idx:0, scores:{R:0,I:0,A:0,S:0,E:0,C:0}, done:false }; }
        function drawRIASEC() {
            const st = gameSt.riasec; const cx=width/2, cy=height/2; ctx.fillStyle='#001a1a'; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = riasecData.qs[st.idx];
                drawProgress(st.idx+1, riasecData.qs.length);
                drawTitle("è·è˜­ä»£ç¢¼", cx, SAFE_TOP + 50, '#00ced1');
                ctx.fillStyle='#fff'; ctx.font='28px "Noto Sans TC"'; ctx.textAlign='center'; 
                ctx.fillText(`ä½ å–œæ­¡ "${q.q}" å—ï¼Ÿ`, cx, cy-50);
                
                drawBtn(cx-90, cy+80, "å–œæ­¡", '#00ffcc', ()=>{ st.scores[q.t]+=1; nextRIASEC(); }, 140);
                drawBtn(cx+90, cy+80, "ä¸å–œæ­¡", '#555', ()=>{ nextRIASEC(); }, 140);
            } else {
                const sorted = Object.entries(st.scores).sort((a,b)=>b[1]-a[1]);
                const code = sorted.slice(0,3).map(x=>x[0]).join('-');
                const top3 = sorted.slice(0,3);
                
                drawHexagon(cx, SAFE_TOP + 100, 60, st.scores);
                ctx.fillStyle='#00ffcc'; ctx.font='bold 40px Orbitron'; ctx.textAlign='center'; 
                ctx.fillText(code, cx, SAFE_TOP + 210);
                
                let textY = SAFE_TOP + 250;
                const maxW = Math.min(width * 0.85, 520);
                const startX = cx - maxW/2;
                
                top3.forEach(item => {
                    const data = riasecData.results[item[0]];
                    textY = drawSectionTitle(data.name, startX, textY, '#00ffcc');
                    textY = wrapText(data.oneLine, startX, textY, maxW, 24) + 5;
                    textY = drawBulletList(data.workEnv, startX, textY, maxW, 22);
                });
                
                drawBtn(cx, height-SAFE_BOTTOM-60, "è¿”å›å¿ƒç†å®‡å®™", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function nextRIASEC() { if(gameSt.riasec.idx < riasecData.qs.length-1) gameSt.riasec.idx++; else gameSt.riasec.done=true; }
        function drawHexagon(cx, cy, r, scores) {
            ctx.strokeStyle='#00ffcc'; ctx.lineWidth=1; ctx.beginPath();
            for(let i=0;i<6;i++) { const a=i/6*Math.PI*2-Math.PI/2; ctx[i===0?'moveTo':'lineTo'](cx+Math.cos(a)*r, cy+Math.sin(a)*r); } ctx.closePath(); ctx.stroke();
            const keys=['R','I','A','S','E','C']; ctx.fillStyle='rgba(0,255,204,0.3)'; ctx.beginPath();
            for(let i=0;i<6;i++) { const v=Math.min(scores[keys[i]]||0, 3)/3*r; const a=i/6*Math.PI*2-Math.PI/2; ctx[i===0?'moveTo':'lineTo'](cx+Math.cos(a)*v, cy+Math.sin(a)*v); } ctx.closePath(); ctx.fill();
            ctx.fillStyle='#fff'; ctx.font='14px Orbitron'; ctx.textAlign='center';
            for(let i=0;i<6;i++) { const a=i/6*Math.PI*2-Math.PI/2; ctx.fillText(keys[i], cx+Math.cos(a)*(r+15), cy+Math.sin(a)*(r+15)+5); }
        }

        // --- 5. COLOR GAME ---
        function startColorTest() { gameSt.color = { phase:0, sel:[], auraT:0, done:false }; }
        function drawColorTest() {
            const st = gameSt.color; const cx=width/2, cy=height/2; ctx.fillStyle='#111'; ctx.fillRect(0,0,width,height);
            if(st.phase < 3) {
                drawTitle("è‰²å½©å¿ƒç†", cx, SAFE_TOP + 50, '#ff00ff');
                let txt = "ç›´è¦ºé¸æ“‡æœ€å¸å¼•ä½ çš„é¡è‰²";
                if(st.phase===1) txt = "é¸æ“‡ç¬¬äºŒå¸å¼•ä½ çš„é¡è‰²";
                if(st.phase===2) txt = "é¸æ“‡æœ€ä¸å–œæ­¡çš„é¡è‰²";
                
                ctx.fillStyle='#fff'; ctx.font='22px "Noto Sans TC"'; ctx.textAlign='center';
                wrapText(txt, cx, cy-150, width-60, 30);
                
                const palette = [{id:1,c:'#A9A9A9'},{id:2,c:'#0000FF'},{id:3,c:'#008000'},{id:4,c:'#FF0000'},{id:5,c:'#FFFF00'},{id:6,c:'#800080'},{id:7,c:'#8B4513'},{id:8,c:'#333333'}];
                palette.forEach((c,i)=>{
                    if(st.sel.find(s=>s.id===c.id)) return;
                    const a=(i/8)*Math.PI*2; const x=cx+Math.cos(a)*100; const y=cy+Math.sin(a)*100;
                    ctx.beginPath(); ctx.arc(x,y,35,0,Math.PI*2); ctx.fillStyle=c.c; ctx.fill(); ctx.strokeStyle='#fff'; ctx.lineWidth=2; ctx.stroke();
                    hitZones.push({t:'circle', x:x, y:y, r:40, action:()=>{ st.sel.push(c); st.phase++; }});
                });
            } else {
                st.auraT += 0.02;
                const c1=st.sel[0], c2=st.sel[1], c3=st.sel[2];
                const d=Math.sin(st.auraT)*10; 
                let g=ctx.createRadialGradient(cx,SAFE_TOP+100,20,cx,SAFE_TOP+100,120+d); g.addColorStop(0,c1.c); g.addColorStop(1,'transparent');
                ctx.fillStyle=g; ctx.beginPath(); ctx.arc(cx,SAFE_TOP+100,120+d,0,Math.PI*2); ctx.fill();
                
                drawTitle("ä½ çš„å¿ƒéˆå…‰è­œ", cx, SAFE_TOP + 50, '#fff');
                
                let textY = SAFE_TOP + 200;
                const maxW = Math.min(width * 0.85, 520);
                const startX = cx - maxW/2;
                
                const d1 = colorMeanings[c1.id];
                textY = drawSectionTitle(`é¡¯æ€§æ¸´æœ› (${d1.label})`, startX, textY, c1.c);
                textY = wrapText(d1.want, startX, textY, maxW, 26) + 5;
                textY = wrapText(d1.state, startX, textY, maxW, 26) + 15;
                
                const d2 = colorMeanings[c2.id];
                textY = drawSectionTitle(`æ¬¡è¦å‹•åŠ› (${d2.label})`, startX, textY, c2.c);
                textY = wrapText(d2.want, startX, textY, maxW, 26) + 15;
                
                textY = drawSectionTitle(`è‡ªæˆ‘ç…§é¡§å»ºè­°`, startX, textY, '#fff');
                textY = drawBulletList(d1.selfCare, startX, textY, maxW);
                
                ctx.fillStyle='#666'; ctx.font='14px "Noto Sans TC"'; ctx.textAlign='center';
                ctx.fillText("*æ­¤çµæœåæ˜ ä½ è¿‘æœŸçš„å¿ƒç†ç‹€æ…‹", cx, textY + 20);

                drawBtn(cx, height-SAFE_BOTTOM-60, "è¿”å›å¿ƒç†å®‡å®™", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }

        // --- 6. ANIMAL GAME ---
        function startAnimalTest() { gameSt.animal = { idx:0, pos:{x:0, y:0}, done:false }; }
        function drawAnimalTest() {
            const st = gameSt.animal; const cx=width/2, cy=height/2; ctx.fillStyle='#051105'; ctx.fillRect(0,0,width,height);
            if(!st.done) {
                const q = animalData.qs[st.idx];
                drawProgress(st.idx+1, animalData.qs.length);
                drawTitle("å‹•ç‰©åœ–é¨°", cx, SAFE_TOP + 50, '#32cd32');
                
                ctx.fillStyle='#fff'; ctx.font='28px "Noto Sans TC"'; ctx.textAlign='center';
                wrapText(q.q, cx, cy-80, Math.min(600, width-60), 40);
                
                if (isMobile) {
                    drawCard(cx, cy+20, width-60, 90, "A", q.a, '#32cd32', ()=>{ st.pos[q.ax]+=q.v; nextAnimal(); });
                    drawCard(cx, cy+130, width-60, 90, "B", q.b, '#32cd32', ()=>{ st.pos[q.ax]-=q.v; nextAnimal(); });
                } else {
                    drawCard(cx-160, cy+60, 280, 160, "A", q.a, '#32cd32', ()=>{ st.pos[q.ax]+=q.v; nextAnimal(); });
                    drawCard(cx+160, cy+60, 280, 160, "B", q.b, '#32cd32', ()=>{ st.pos[q.ax]-=q.v; nextAnimal(); });
                }
            } else {
                const x=st.pos.x, y=st.pos.y;
                let res=animalData.results['D']; 
                if(x>0 && y<=0) res=animalData.results['I']; 
                else if(x>0 && y>0) res=animalData.results['S']; 
                else if(x<=0 && y>0) res=animalData.results['C'];
                
                drawTitle(res.t + " " + res.e, cx, SAFE_TOP + 50, '#adff2f');
                ctx.font='18px "Noto Sans TC"'; ctx.fillStyle='#ccc'; ctx.textAlign='center';
                wrapText(res.oneLine, cx, SAFE_TOP + 90, width-40, 26);
                
                let textY = SAFE_TOP + 140;
                const maxW = Math.min(width * 0.85, 520);
                const startX = cx - maxW/2;
                
                textY = drawSectionTitle("ã€æºé€šé¢¨æ ¼ã€‘", startX, textY, '#adff2f');
                textY = wrapText(res.commStyle, startX, textY, maxW, 26) + 15;
                
                textY = drawSectionTitle("ã€å®¹æ˜“è¢«èª¤æœƒã€‘", startX, textY, '#ff6666');
                textY = wrapText(res.beMisunderstood, startX, textY, maxW, 26) + 15;
                
                textY = drawSectionTitle("ã€åˆä½œå°æ’‡æ­¥ã€‘", startX, textY, '#adff2f');
                textY = drawBulletList(res.coopTips, startX, textY, maxW);
                
                textY = drawSectionTitle("ã€è‡ªæˆ‘èª¿æ•´ã€‘", startX, textY, '#ffff99');
                textY = drawBulletList(res.selfAdjust, startX, textY, maxW);
                
                drawBtn(cx, height-SAFE_BOTTOM-60, "è¿”å›å¿ƒç†å®‡å®™", 'rgba(255,255,255,0.2)', returnLobby);
            }
        }
        function nextAnimal() { if(gameSt.animal.idx<animalData.qs.length-1) gameSt.animal.idx++; else gameSt.animal.done=true; }

        init(); loop();
    </script>
</body>
</html>