<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä½ æ¯”å¸‚å ´æº–å—ï¼Ÿ - è·å ´æ„ŸçŸ¥åŠ›æ¸¬é©— v3.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* å‹•ç•«é¡ */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .slide-in-right { animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .pulse-text { animation: pulseText 2s infinite; }
        
        /* éš±è— Scrollbar ä½†ä¿ç•™æ»‘å‹•åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideInRight { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes pulseText { 
            0%, 100% { opacity: 1; transform: scale(1); } 
            50% { opacity: 0.7; transform: scale(0.98); } 
        }

        /* é—œéµä¿®æ­£ï¼šé˜²æ­¢æ»‘å‹•æ™‚é é¢æ²å‹• */
        input[type=range] {
            touch-action: none; 
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        /* è‡ªè¨‚æ»‘æ¡¿è»Œé“é‚è¼¯ - åŠ å¤§å°ºå¯¸ */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 48px; /* å†åŠ å¤§ */
            width: 48px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            border: 5px solid #4F46E5;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.5); 
            margin-top: -20px; 
            position: relative;
            z-index: 20;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 12px; /* è»Œé“åŠ ç²— */
            cursor: pointer;
            background: transparent; 
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 h-screen flex justify-center items-center overflow-hidden">

    <div id="app" class="w-full max-w-md h-full bg-white relative shadow-2xl flex flex-col overflow-hidden sm:rounded-[2.5rem] sm:h-[95vh] sm:border-8 sm:border-gray-900">
        </div>

<script>
/**
 * =================================================================
 * CONFIG: è¨­å®šå€
 * =================================================================
 */
// å·²å¡«å…¥æ‚¨çš„ Worker ç¶²å€
const WORKER_URL = "https://prediction-game-api.giyin2005.workers.dev/"; 

/**
 * ------------------------------------------------------------------
 * 1. Data Layer (è³‡æ–™å±¤)
 * ------------------------------------------------------------------
 */
const DataService = {
    questionsPool: [
        { id: "q_proj_01", category: "å°ˆæ¡ˆæ™‚ç¨‹", displayTitle: "é€™å€‹å°ˆæ¡ˆçœŸçš„æœƒæº–æ™‚ä¸Šç·šå—ï¼Ÿ", introText: "è€é—†èªª Q3 ä¸€å®šè¦ç™¼å¸ƒï¼Œä¾ä½ çš„ç¶“é©—ï¼Œé€™ä»¶äº‹æˆçœŸçš„æ©Ÿç‡æ˜¯ï¼Ÿ", marketType: "EVENT" },
        { id: "q_proj_02", category: "ç”¢å“ç™¼å¸ƒ", displayTitle: "åŸæœ¬æ‰¿è«¾çš„æ–°åŠŸèƒ½ï¼Œå¹´åº•å‰çœŸçš„åšå¾—å®Œå—ï¼Ÿ", introText: "çœ‹è‘—ç¾åœ¨çš„é€²åº¦æ¢ï¼Œä½ è¦ºå¾—å·¥ç¨‹åœ˜éšŠèƒ½æº–æ™‚äº¤ä»˜å—ï¼Ÿ", marketType: "EVENT" },
        { id: "q_proj_03", category: "å°ˆæ¡ˆé‡å•Ÿ", displayTitle: "é‚£å€‹å»¶æœŸå…©æ¬¡çš„å°ˆæ¡ˆï¼Œä¸‹å€‹æœˆçœŸçš„æœƒå•Ÿå‹•å—ï¼Ÿ", introText: "é‚„æ˜¯é€™åªæ˜¯å¦ä¸€æ¬¡çš„ã€Œç‹¼ä¾†äº†ã€ï¼Ÿ", marketType: "EVENT" },
        { id: "q_pol_01", category: "å…¬å¸æ±ºç­–", displayTitle: "å…¬å¸å®£ä½ˆçš„ã€Œæ–°ç¦åˆ©æ”¿ç­–ã€æ˜å¹´é‚„æœƒåœ¨å—ï¼Ÿ", introText: "ä½ è¦ºå¾—é€™æ˜¯ä¸€å€‹é•·æœŸæ‰¿è«¾ï¼Œé‚„æ˜¯é›·è²å¤§é›¨é»å°ï¼Ÿ", marketType: "STABLE" },
        { id: "q_pol_02", category: "äººäº‹å‡çµ", displayTitle: "å‚³èä¸­çš„ã€Œäººäº‹å‡çµã€æœƒæŒçºŒåˆ°æ˜å¹´å—ï¼Ÿ", introText: "æ ¹æ“šä½ çš„è§€å¯Ÿï¼Œå…¬å¸ç›®å‰çš„äººåŠ›ç­–ç•¥å‚¾å‘æ˜¯ï¼Ÿ", marketType: "STABLE" },
        { id: "q_pol_03", category: "è¾¦å…¬æ¨¡å¼", displayTitle: "å…¬å¸æœƒå…¨é¢å–æ¶ˆ WFH (é ç«¯å·¥ä½œ) å—ï¼Ÿ", introText: "è€é—†æœ€è¿‘çš„ç™¼è¨€ä¼¼ä¹æ„æœ‰æ‰€æŒ‡ï¼Œä½ çš„ç›´è¦ºæ˜¯ï¼Ÿ", marketType: "STABLE" },
        { id: "q_tech_01", category: "ç§‘æŠ€è¶¨å‹¢", displayTitle: "é€™å€‹æ–° AI å·¥å…·ï¼ŒçœŸçš„æœƒè¢«å°å…¥æˆ‘å€‘éƒ¨é–€å—ï¼Ÿ", introText: "æ’‡é–‹ç‚’ä½œï¼Œå¯¦å‹™ä¸Šä½ è¦ºå¾—å¤§å®¶æ¡ç”¨çš„å¯èƒ½æ€§ï¼Ÿ", marketType: "VOLATILE" },
        { id: "q_tech_02", category: "å¸‚å ´å¤§å±€", displayTitle: "å¤§å®¶éƒ½åœ¨è«‡çš„ã€Œç¶“æ¿Ÿè¡°é€€ã€ä»Šå¹´çœŸçš„æœƒä¾†å—ï¼Ÿ", introText: "é‚„æ˜¯é€™åªæ˜¯åª’é«”åœ¨è²©è³£ç„¦æ…®ï¼Ÿä½ çš„ç›´è¦ºï¼Ÿ", marketType: "VOLATILE" },
        { id: "q_sale_01", category: "æ¥­ç¸¾ç›®æ¨™", displayTitle: "ä»Šå¹´æ¥­å‹™éƒ¨çš„ã€Œå€æ•¸æˆé•·ã€ç›®æ¨™èƒ½é”æˆå—ï¼Ÿ", introText: "çœ‹è‘—ç¾åœ¨çš„æ•¸å­—ï¼Œä½ å…§å¿ƒçš„çœŸå¯¦è©•ä¼°æ˜¯ï¼Ÿ", marketType: "VOLATILE" },
        { id: "q_crypto_01", category: "å¹£åœˆè©±é¡Œ", displayTitle: "è¾¦å…¬å®¤è¨è«–çš„ã€Œæ¯”ç‰¹å¹£ç ´æ–°é«˜ã€è¿‘æœŸæœƒç™¼ç”Ÿå—ï¼Ÿ", introText: "é€™æ³¢ç†±æ½®æ˜¯ç©çœŸçš„ï¼Œé‚„æ˜¯åˆè¦å‰²éŸ­èœäº†ï¼Ÿ", marketType: "VOLATILE" },
    ],

    async fetchQuestions() {
        const shuffled = [...this.questionsPool].sort(() => 0.5 - Math.random());
        const selectedQuestions = shuffled.slice(0, 5);
        let marketPools = null;

        if (WORKER_URL && WORKER_URL.startsWith("http")) {
            try {
                console.log("Fetching from Polymarket via Worker...");
                const res = await fetch(WORKER_URL);
                if (res.ok) {
                    marketPools = await res.json();
                }
            } catch (e) {
                console.warn("Worker fetch failed, using fallback.", e);
            }
        }

        const finalQuestions = selectedQuestions.map(q => {
            let prob = 50;
            if (marketPools && marketPools[q.marketType] && marketPools[q.marketType].length > 0) {
                const pool = marketPools[q.marketType];
                prob = pool[Math.floor(Math.random() * pool.length)];
            } else {
                if (q.marketType === "STABLE") prob = Math.floor(Math.random() * (70 - 30 + 1) + 30);
                else if (q.marketType === "VOLATILE") prob = Math.floor(Math.random() * (90 - 10 + 1) + 10);
                else prob = Math.floor(Math.random() * (85 - 15 + 1) + 15);
            }
            return { ...q, mockMarketProb: prob };
        });
        return finalQuestions;
    }
};

/**
 * ------------------------------------------------------------------
 * 2. State Management (ç‹€æ…‹ç®¡ç†)
 * ------------------------------------------------------------------
 */
class GameStore {
    constructor() {
        this.state = {
            view: 'loading', questions: [], currentQIndex: 0, userGuess: 50, history: [], 
            loadingText: 'æ­£åœ¨åŒæ­¥çœŸå¯¦å¸‚å ´æ•¸æ“š...',
        };
        this.listeners = [];
    }
    subscribe(listener) { this.listeners.push(listener); }
    setState(newState, silent = false) { this.state = { ...this.state, ...newState }; if (!silent) this.notify(); }
    notify() { this.listeners.forEach(fn => fn(this.state)); }
    
    async initGame() {
        this.setState({ view: 'loading' });
        try {
            const data = await DataService.fetchQuestions();
            this.setState({ questions: data, view: 'intro', currentQIndex: 0, history: [] });
        } catch (e) {
            console.error(e);
            alert("è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
        }
    }
    startGame() { this.setState({ view: 'game', userGuess: 50 }); }
    updateGuess(val, silent = false) { this.setState({ userGuess: parseInt(val) }, silent); }
    submitGuess() {
        const { questions, currentQIndex, userGuess, history } = this.state;
        const currentQ = questions[currentQIndex];
        const record = { question: currentQ, user: userGuess, market: currentQ.mockMarketProb, diff: userGuess - currentQ.mockMarketProb };
        this.setState({ history: [...history, record], view: 'reveal' });
    }
    nextQuestion() {
        const { currentQIndex, questions } = this.state;
        if (currentQIndex + 1 < questions.length) {
            this.setState({ currentQIndex: currentQIndex + 1, view: 'game', userGuess: 50 });
        } else {
            this.setState({ view: 'result' });
        }
    }
}
const store = new GameStore();

/**
 * ------------------------------------------------------------------
 * 3. UI Layer (æ¸²æŸ“å±¤)
 * ------------------------------------------------------------------
 */
const App = document.getElementById('app');
function render(state) {
    App.innerHTML = ''; 
    switch(state.view) {
        case 'loading': App.innerHTML = ViewLoading(state); break;
        case 'intro':   App.innerHTML = ViewIntro(); break;
        case 'game':    App.innerHTML = ViewGame(state); break;
        case 'reveal':  App.innerHTML = ViewReveal(state); break;
        case 'result':  App.innerHTML = ViewResult(state); break;
    }
    bindEvents(state);
}
function bindEvents(state) {
    const startBtn = document.getElementById('btn-start');
    if (startBtn) startBtn.onclick = () => store.startGame();
    const slider = document.getElementById('guess-slider');
    if (slider) {
        slider.oninput = (e) => {
            const val = e.target.value;
            store.updateGuess(val, true); 
            const display = document.getElementById('val-display');
            const track = document.getElementById('track-fill');
            const thumb = document.getElementById('thumb-visual');
            if(display) display.innerHTML = `${val}<span class="text-4xl text-indigo-300 ml-1">%</span>`;
            if(track) track.style.width = `${val}%`;
            if(thumb) thumb.style.left = `${val}%`;
        };
    }
    const confirmBtn = document.getElementById('btn-confirm');
    if (confirmBtn) confirmBtn.onclick = () => store.submitGuess();
    const nextBtn = document.getElementById('btn-next');
    if (nextBtn) nextBtn.onclick = () => store.nextQuestion();
    const restartBtn = document.getElementById('btn-restart');
    if (restartBtn) restartBtn.onclick = () => store.initGame();
}

/** Views - å­—é«”å…¨é¢æ”¾å¤§ (v3.4) */

function ViewLoading(state) {
    return `<div class="flex flex-col items-center justify-center h-full space-y-4 bg-gray-50"><div class="relative"><div class="w-16 h-16 border-4 border-gray-200 border-t-indigo-600 rounded-full animate-spin"></div><div class="absolute top-0 left-0 w-16 h-16 border-4 border-transparent border-b-indigo-300 rounded-full animate-spin" style="animation-duration: 1.5s"></div></div><p class="text-gray-500 text-lg animate-pulse tracking-wide font-medium">${state.loadingText}</p></div>`;
}

function ViewIntro() {
    return `<div class="flex flex-col h-full p-8 relative overflow-hidden bg-white"><div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-indigo-50 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-pulse"></div><div class="absolute bottom-0 right-0 w-64 h-64 bg-purple-50 rounded-full mix-blend-multiply filter blur-3xl opacity-70"></div><div class="relative z-10 flex flex-col h-full justify-between fade-in"><div class="mt-8"><span class="inline-block px-3 py-1 bg-gray-900 text-white text-xs font-bold tracking-widest rounded-full mb-6">BETA v3.4</span><h1 class="text-6xl font-black text-gray-900 mb-4 leading-none tracking-tight">ä½ æ¯”å¸‚å ´<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">æ›´æº–å—ï¼Ÿ</span></h1><p class="text-gray-500 text-2xl font-medium mt-4">è·å ´æ„ŸçŸ¥åŠ›æ¸¬é©—</p></div><div class="flex-grow flex items-center justify-center"><div class="text-center space-y-6"><div class="text-9xl animate-bounce drop-shadow-2xl filter grayscale-[0.2]">ğŸ”®</div><div class="space-y-4"><p class="text-indigo-900 font-bold text-2xl">ä½ çš„ç›´è¦º vs å¤§çœ¾å…±è­˜</p><p class="text-gray-500 text-lg max-w-xs mx-auto leading-relaxed">é€™ä¸æ˜¯è€ƒè©¦ï¼Œè€Œæ˜¯çœ‹ä½ åœ¨å……æ»¿é›œè¨Šçš„è·å ´ä¸­ï¼Œæ˜¯å¦æ“æœ‰çœ‹é€å±€å‹¢çš„ã€Œçµ•å°éŸ³æ„Ÿã€ã€‚</p></div></div></div><div class="mb-4"><button id="btn-start" class="w-full bg-gray-900 text-white text-2xl font-bold py-6 rounded-2xl shadow-xl transform transition active:scale-[0.98] hover:bg-gray-800 border border-gray-800 flex items-center justify-center gap-2">é–‹å§‹æ¸¬é©— <span class="text-gray-400 text-2xl">â†’</span></button><p class="text-center text-sm text-gray-400 mt-4 opacity-60">*æ¸¬é©—çµæœåƒ…ä¾›åƒè€ƒï¼Œç„¡ä»»ä½•æŠ•è³‡å»ºè­°</p></div></div></div>`;
}

function ViewGame(state) {
    const q = state.questions[state.currentQIndex];
    const progress = ((state.currentQIndex + 1) / state.questions.length) * 100;
    return `<div class="flex flex-col h-full bg-gray-50 fade-in"><div class="w-full h-1.5 bg-gray-200"><div class="h-full bg-indigo-600 transition-all duration-300 ease-out" style="width: ${progress}%"></div></div><div class="px-6 pt-6 flex justify-between items-center"><span class="text-gray-400 text-sm font-bold tracking-widest uppercase">Q ${state.currentQIndex + 1} / ${state.questions.length}</span><span class="text-indigo-600 text-sm font-bold bg-indigo-100 px-3 py-1 rounded-full border border-indigo-200">${q.category}</span></div><div class="flex-grow flex flex-col px-6 py-4"><div class="bg-white rounded-[1.5rem] p-8 shadow-sm border border-gray-100 mb-6 slide-in-right"><h2 class="text-3xl font-bold text-gray-900 mb-4 leading-snug">${q.displayTitle}</h2><p class="text-gray-600 text-xl leading-relaxed">${q.introText}</p></div><div class="flex-grow flex flex-col justify-center items-center relative"><div class="absolute text-[12rem] font-black text-gray-200 select-none -z-10 opacity-30 transform -rotate-12">%</div><div class="text-center w-full max-w-xs"><div class="mb-6 pulse-text flex justify-center items-center text-indigo-600 font-bold bg-indigo-100 inline-block px-5 py-2 rounded-full text-lg mx-auto"><span>ğŸ‘‡ å·¦å³æ»‘å‹•ä»¥è¼¸å…¥ç›´è¦º</span></div><div id="val-display" class="text-9xl font-black text-indigo-600 tracking-tighter mb-8 tabular-nums relative inline-block">${state.userGuess}<span class="text-4xl text-indigo-300 ml-1">%</span></div><div class="relative h-24 w-full flex items-center"><div class="absolute left-0 right-0 top-1/2 h-5 bg-gray-200 rounded-full overflow-hidden transform -translate-y-1/2 pointer-events-none shadow-inner"><div id="track-fill" class="h-full bg-indigo-500 transition-none" style="width: ${state.userGuess}%"></div></div><input id="guess-slider" type="range" min="0" max="100" value="${state.userGuess}" class="z-10 relative w-full h-full opacity-0 cursor-pointer"><div id="thumb-visual" class="absolute top-1/2 h-12 w-12 bg-white border-4 border-indigo-600 rounded-full shadow-xl transform -translate-y-1/2 -translate-x-1/2 pointer-events-none transition-none flex items-center justify-center" style="left: ${state.userGuess}%"><div class="w-3 h-3 bg-indigo-600 rounded-full"></div></div></div><div class="flex justify-between text-lg font-bold text-gray-500 mt-2 px-1"><span>0% ä¸å¯èƒ½</span><span>100% çµ•å°æœƒ</span></div></div></div></div><div class="p-6 bg-gray-50 border-t border-gray-100"><button id="btn-confirm" class="w-full bg-gray-900 text-white text-2xl font-bold py-6 rounded-2xl shadow-lg transform transition active:scale-[0.98] hover:bg-gray-800 flex justify-center items-center gap-2">ç¢ºèªé–å®š <span class="text-lg opacity-50">ğŸ”’</span></button></div></div>`;
}

function ViewReveal(state) {
    const lastRecord = state.history[state.history.length - 1];
    const q = lastRecord.question;
    const userVal = lastRecord.user;
    const marketVal = lastRecord.market;
    let diffText = ""; const diff = userVal - marketVal;
    if (Math.abs(diff) < 10) diffText = "è‹±é›„æ‰€è¦‹ç•¥åŒ"; else if (diff > 0) diffText = "ä½ æ¯”å¸‚å ´æ›´æ¨‚è§€"; else diffText = "ä½ æ¯”å¸‚å ´æ›´ä¿å®ˆ";
    const diffColorClass = diff > 0 ? "text-orange-500" : "text-blue-500";
    return `<div class="flex flex-col h-full bg-gray-900 text-white slide-up relative overflow-hidden"><div class="absolute top-0 right-0 w-64 h-64 bg-indigo-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 -mr-16 -mt-16 animate-pulse"></div><div class="p-8 flex-grow flex flex-col justify-center relative z-10"><h3 class="text-gray-400 text-sm font-bold uppercase tracking-widest mb-2">${q.category}</h3><h2 class="text-3xl font-bold mb-12 leading-snug text-white/90">${q.displayTitle}</h2><div class="space-y-12"><div><div class="flex justify-between items-end mb-3"><span class="text-lg text-indigo-300 font-medium">ä½ çš„ç›´è¦º</span><span class="text-6xl font-bold text-white leading-none">${userVal}%</span></div><div class="h-4 bg-gray-800 rounded-full overflow-hidden"><div class="h-full bg-indigo-500 rounded-full transition-all duration-1000 ease-out" style="width: ${userVal}%"></div></div></div><div><div class="flex justify-between items-end mb-3"><div class="flex flex-col"><span class="text-lg text-emerald-300 font-medium mb-1">ç›®å‰å¤šæ•¸äººçš„åˆ¤æ–·</span><span class="inline-block self-start text-xs bg-gray-800 border border-gray-700 px-2 py-1 rounded text-gray-400 tracking-wider">å³æ™‚å¸‚å ´æ•¸æ“š</span></div><span class="text-6xl font-bold text-emerald-400 leading-none">${marketVal}%</span></div><div class="h-4 bg-gray-800 rounded-full overflow-hidden"><div class="h-full bg-emerald-500 rounded-full transition-all duration-1000 ease-out" style="width: ${marketVal}%"></div></div></div></div><div class="mt-20 text-center"><div class="inline-block px-8 py-5 bg-gray-800/80 backdrop-blur-sm border border-gray-700 rounded-2xl"><span class="text-2xl font-bold text-gray-200 block mb-1">${diffText}</span><span class="text-lg ${diffColorClass} font-bold tracking-wider">(å·®ç•° ${diff > 0 ? '+' : ''}${diff}%)</span></div></div></div><div class="p-6 border-t border-gray-800 z-10 bg-gray-900"><button id="btn-next" class="w-full bg-white text-gray-900 text-2xl font-bold py-6 rounded-2xl shadow-lg transform transition active:scale-[0.98] hover:bg-gray-100">ä¸‹ä¸€é¡Œ â†’</button></div></div>`;
}

function ViewResult(state) {
    const totalDiff = state.history.reduce((acc, curr) => acc + curr.diff, 0);
    const avgDiff = totalDiff / state.history.length;
    const totalAbsDiff = state.history.reduce((acc, curr) => acc + Math.abs(curr.diff), 0);
    const avgAbsDiff = totalAbsDiff / state.history.length;
    
    // æ–‡æ¡ˆé‚è¼¯æ›´æ–°ï¼šå°‡è¡“èªè½‰ç‚ºå•å¥èˆ‡ç™½è©±æ–‡
    const biasTitle = "ä½ çœ‹äº‹æƒ…æœ‰å¤šæ¨‚è§€ï¼Ÿ";
    const biasValue = avgDiff > 0 ? `æ¯”å¤§çœ¾æ¨‚è§€ ${Math.round(avgDiff)}%` : (avgDiff < 0 ? `æ¯”å¤§çœ¾ä¿å®ˆ ${Math.round(Math.abs(avgDiff))}%` : "èˆ‡å¤§çœ¾å®Œå…¨ä¸€è‡´");
    
    const volTitle = "ä½ çš„è§€é»æœ‰å¤šç¨ç‰¹ï¼Ÿ";
    let volValue = "";
    if (avgAbsDiff < 15) volValue = `${Math.round(avgAbsDiff)}% (èˆ‡å¤§çœ¾å·®ä¸å¤š)`;
    else if (avgAbsDiff < 30) volValue = `${Math.round(avgAbsDiff)}% (æœ‰é»ç¨ç‰¹)`;
    else volValue = `${Math.round(avgAbsDiff)}% (éå¸¸ç¨ç‰¹)`;

    let persona = {};
    if (avgAbsDiff < 15) { 
        persona = { img: "https://api.dicebear.com/9.x/micah/svg?seed=Felix&backgroundColor=e0e7ff", title: "äººé–“æ¸…é†’", titleEn: "The Sober Realist", color: "text-indigo-600", tag: "ç²¾æº–åŒæ­¥", desc: "ä½ ä¸æ˜¯æ™®é€šï¼Œä½ æ˜¯ã€Œç²¾æº–ã€ã€‚<br>é€™ä»£è¡¨ä½ å°å±€å‹¢çš„åˆ¤æ–·èˆ‡é›†é«”æ™ºæ…§ (Wisdom of Crowd) é«˜åº¦é‡ç–Šã€‚åœ¨çœ¾äººçš†é†‰çš„è·å ´è£¡ï¼Œä½ å°±æ˜¯é‚£å€‹å”¯ä¸€çœ‹æ¸…ç¾å¯¦ã€èƒ½å®¢è§€è©•ä¼°é¢¨éšªçš„äººã€‚", advice: "ğŸ’¡ <b>ä½ çš„å„ªå‹¢ï¼š</b>ä½ æ˜¯åœ˜éšŠçš„ã€Œå®šæµ·ç¥é‡ã€ã€‚<br>ç•¶å¤§å®¶æ„è¦‹åˆ†æ­§æ™‚ï¼Œä½ çš„ç›´è¦ºé€šå¸¸å°±æ˜¯æœ€æ¥è¿‘äº‹å¯¦çš„ç­”æ¡ˆã€‚è«‹æ›´æœ‰è‡ªä¿¡åœ°ç«™å‡ºä¾†çµ±åˆæ„è¦‹ã€‚" };
    } else if (avgDiff >= 15) { 
        persona = { img: "https://api.dicebear.com/9.x/notionists/svg?seed=Rocket&backgroundColor=ffedd5", title: "æ©Ÿé‡çµäºº", titleEn: "The Opportunity Hunter", color: "text-orange-500", tag: "é–‹å‰µå‹", desc: "ä½ çœ‹åˆ°çš„æœªä¾†ï¼Œæ¯”å¤§éƒ¨åˆ†äººæ›´å…‰æ˜ã€‚<br>ä½ å°æ–¼ã€Œå¯èƒ½æ€§ã€éå¸¸æ•æ„Ÿï¼Œé€™è®“ä½ æˆç‚ºæ¥µä½³çš„æ¥­å‹™æˆ–ç”¢å“é–‹å‰µè€…ï¼Œå› ç‚ºä½ ç¸½èƒ½çœ‹è¦‹åˆ¥äººçœ‹ä¸è¦‹çš„æ©Ÿæœƒã€‚", advice: "ğŸ’¡ <b>ä½ çš„å„ªå‹¢ï¼š</b>ä½ æ•¢åšå¤¢ï¼Œä¹Ÿæ•¢è¡ã€‚<br>ä½ éœ€è¦é…ä¸€å€‹ã€Œç¾å¯¦éŒ¨é»ã€å‹çš„å‰¯æ‰‹ã€‚ç•¶ä½ èªªã€Œä¸‹é€±å¯ä»¥ä¸Šç·šã€æ™‚ï¼Œè®“ä»–å¹«ä½ æª¢æŸ¥æ˜¯ä¸æ˜¯æ¼äº†ä»€éº¼ç´°ç¯€ã€‚" };
    } else if (avgDiff <= -15) { 
        persona = { img: "https://api.dicebear.com/9.x/notionists/svg?seed=Shield&backgroundColor=ccfbf1", title: "é¢¨éšªå®ˆé–€å“¡", titleEn: "The Risk Guardian", color: "text-teal-600", tag: "é˜²ç¦¦å‹", desc: "ä½ æ¯”å¸‚å ´æ›´è¬¹æ…ï¼Œé€™ä¸æ˜¯å£äº‹ã€‚<br>ä½ æ“æœ‰æ¥µå¼·çš„ã€Œå±æ©Ÿå—…è¦ºã€ï¼Œå¾€å¾€åœ¨å°ˆæ¡ˆé‚„æ²’é–‹å§‹å‰ï¼Œä½ å°±å·²ç¶“èåˆ°äº†ç‡’ç„¦å‘³ã€‚ä½ æ˜¯é˜²æ­¢å…¬å¸ç¿»è»Šçš„é—œéµç…è»Šçš®ã€‚", advice: "ğŸ’¡ <b>ä½ çš„å„ªå‹¢ï¼š</b>ä½ ä¸æœƒè®“åœ˜éšŠé™·å…¥çµ•å¢ƒã€‚<br>å°å¿ƒåˆ¥è®Šæˆã€Œæ°£æ°›æ®ºæ‰‹ã€ã€‚è©¦è‘—æŠŠã€Œæˆ‘è¦ºå¾—ä¸è¡Œã€æ”¹æˆã€Œå¦‚æœæˆ‘å€‘è¦æˆåŠŸï¼Œå¿…é ˆå…ˆè§£æ±ºé€™ä¸‰å€‹éš±æ†‚...ã€ã€‚" };
    } else {
        persona = { img: "https://api.dicebear.com/9.x/notionists/svg?seed=Magic&backgroundColor=f3e8ff", title: "ç›´è¦ºç¨è¡Œä¿ ", titleEn: "The Intuitive Maverick", color: "text-purple-600", tag: "ç¨ç«‹æ€è€ƒ", desc: "ä½ çš„åˆ¤æ–·å®Œå…¨ä¸éš¨æ³¢é€æµã€‚<br>æœ‰æ™‚ä½ æ¯”å¸‚å ´æ¥µåº¦æ¨‚è§€ï¼Œæœ‰æ™‚åˆæ¥µåº¦ä¿å®ˆã€‚é€™ä»£è¡¨ä½ æ“æœ‰éå¸¸ç¨ç‰¹çš„è¦–è§’ï¼Œä¸å—ç¾¤é«”å…±è­˜å½±éŸ¿ï¼Œæ˜¯æ¨™æº–çš„ã€Œåå‘æ“ä½œã€æ½›åŠ›è‚¡ã€‚", advice: "ğŸ’¡ <b>ä½ çš„å„ªå‹¢ï¼š</b>ä½ çœ‹è¦‹äº†åˆ¥äººæ²’çœ‹è¦‹çš„ç›²é»ã€‚<br>ä½ çš„è§€é»é€šå¸¸å¾ˆæœ‰è¡æ“Šæ€§ï¼Œå»ºè­°åœ¨ç™¼è¡¨æ„è¦‹æ™‚å¤šæº–å‚™ä¸€äº›æ•¸æ“šä½è­‰ï¼Œå› ç‚ºä½ çš„ç›´è¦ºå°å¤§å¤šæ•¸äººä¾†èªªå¯èƒ½å¤ªéå‰è¡›ã€‚" };
    }

    return `
        <div class="flex flex-col h-full bg-white relative fade-in overflow-hidden">
            <div class="flex-grow overflow-y-auto px-6 pt-4 pb-32 scroll-smooth no-scrollbar">
                <div class="text-center mt-4">
                    <p class="text-gray-400 text-sm font-bold tracking-[0.2em] uppercase mb-6">â€” ä½ çš„è·å ´æ„ŸçŸ¥åŠ›åˆ†æ â€”</p>
                    
                    <div class="bg-gray-50 rounded-[2.5rem] p-8 mb-8 border border-gray-100 shadow-sm relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-40 h-40 bg-gray-200 rounded-full mix-blend-multiply filter blur-3xl opacity-50 -mr-10 -mt-10"></div>
                        <div class="relative z-10">
                            <div class="mb-8 mx-auto w-40 h-40 relative">
                                <div class="absolute inset-0 bg-white/50 rounded-full animate-pulse"></div>
                                <img src="${persona.img}" alt="${persona.title}" class="relative z-10 w-full h-full rounded-full shadow-lg border-4 border-white object-cover">
                            </div>
                            <span class="inline-block px-5 py-2 bg-white border border-gray-200 text-gray-600 text-sm font-bold tracking-wider rounded-full mb-4 shadow-sm uppercase">${persona.tag}</span>
                            <h2 class="text-5xl font-black mb-2 ${persona.color} leading-tight">${persona.title}</h2>
                            <p class="text-gray-400 text-lg font-bold uppercase tracking-wider mb-8 opacity-80">${persona.titleEn}</p>
                            <div class="w-20 h-1.5 bg-gray-200 mx-auto rounded-full mb-8"></div>
                            <p class="text-gray-700 text-2xl leading-relaxed text-justify mb-4 tracking-wide font-medium">${persona.desc}</p>
                        </div>
                    </div>

                    <div class="bg-indigo-50 p-8 rounded-3xl border-l-8 border-indigo-500 text-left mb-10 shadow-sm">
                        <p class="text-indigo-900 text-xl font-medium leading-relaxed">${persona.advice}</p>
                    </div>

                    <div class="space-y-8 px-2 mb-6">
                        <h3 class="text-lg font-bold text-gray-400 uppercase tracking-wider border-b-2 border-gray-200 pb-3 text-left">æ•¸æ“šé«”æª¢</h3>
                        
                        <div class="flex flex-col gap-1">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 text-xl font-bold">${biasTitle}</span>
                            </div>
                            <span class="text-right font-black text-gray-900 text-3xl font-mono tracking-tight">${biasValue}</span>
                        </div>
                        
                         <div class="flex flex-col gap-1">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600 text-xl font-bold">${volTitle}</span>
                            </div>
                            <span class="text-right font-bold text-gray-600 text-2xl bg-gray-100 px-4 py-2 rounded-lg self-end mt-1">${volValue}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="absolute bottom-0 left-0 right-0 z-20 pointer-events-none">
                <div class="h-56 bg-gradient-to-t from-white via-white/95 to-transparent flex flex-col justify-end items-center p-6 pb-10">
                    <div class="flex flex-col items-center mb-4 animate-bounce opacity-60">
                        <span class="text-sm font-bold text-gray-400 tracking-widest uppercase mb-1">ä¸‹æ»‘æŸ¥çœ‹å®Œæ•´åˆ†æ</span>
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                    </div>
                    <button id="btn-restart" class="w-full bg-gray-900 text-white text-2xl font-bold py-6 rounded-2xl shadow-xl transform transition active:scale-[0.98] hover:bg-gray-800 pointer-events-auto">å†æ¸¬ä¸€æ¬¡</button>
                </div>
            </div>
        </div>
    `;
}

store.subscribe(render);
store.initGame();
</script>
</body>
</html>