<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>é€šå‹¤å¤©æ°£å°å¹«æ‰‹</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="å¤©æ°£å°å¹«æ‰‹">

<link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAMAAAAKE/YAAAAhFBMVEVHcEx5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXmmF1+cAAAAC3RSTlMAwz/AIBDQAO+fIN/z82tLAAAEHklEQVR42u3c63KCMBSFYS8tFBEv6P3f84K1M2bamID9r/WcO3NChqQJg4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq/U96+J2/j23S42b3spuPx6zDP+91wO51u9y/b6TLezZ/S9vF9+jI9PAzz9yTfH4b56fM0f0rbp2kY39/mn+X72zCM0/QpbV/G18d5/lW+P87z1/H3tM15Hqdl/l2+L/P4lrbZz8s0L/Pv8n2ZxtnPp21O47zMy/y7fF/m8Tlt0/f5vszZx/k5bZ/f5/l3+b7M8/u0fV6W+Xf5vszL9C1t0/f5vszrt7RNf87L/Lt8X+b5V9qmf+dl/l2+L/P8L22zX+Zl/l2+L/Oyn7bZb/My/y7fl3ndT9vs93mZf5fvy7ztp232x7zMv8v3Zd7+0zb7c17m3+X7Ms//0nb7fV7m3+X7Mm/3aZv9OS/z7/J9med/aZv9Oi/z7/J9mZf9+u3f52X+Xb4v8/KftunXeZl/l+9/7d49SsNQFIbh26S2iK2Id/97zkWwQ4cMOfB/rWc5y0xY8jIhRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFxcW/KW/fk7fxbTrcti+76Xj8OszjfjfcttPtw8t2uox386e0fXyfvtQPD8P8Pcn3h2F++jzNn9L2aRrG97f5Z/n+NgzjNH1K25fx9XGef5Xvj/P8dfw9bXOex2mZf5fvyzy+pW328zLNy/y7fF+mcfbzaZvTOC/zMv8u35d5fE7bND/Py/y7fF/mcX5O2+f3ef5dvi/z/D5tn5dl/l2+L/MyfUvb9Ou8zL/L92Vev6Vt+nNe5t/l+zLPv9I2/Tsv8+/yfZnnf2mb/TIv8+/yfZmX/bTNfpuX+Xf5vszrftpmv8/L/Lt8X+ZtP22zP+Zl/l2+L/P2n7bZn/My/y7fl3n+l7bb7/My/y7fl3m7T9vsz3mZf5fvyzz/S9vs13mZf5fvy7zs12//Pi/z7/J9mZf/tE2/zsv8u3xf5vVL2j4/z8v8u3xf5vF52qZ5mX+X78s8z9M2zXn+Xb4vc86/0jbncZ5/l+/LPI7T9mX+Ov4u35f5a3w/bfM8fcr3ZZ6G6UvaPrzN9yTfl3kb3se3tH2cLuPdJN+X6TLOH6ft7XuS78u8fU/LioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKfx8+A57M09B7AAAAAElFTkSuQmCC" />

<script async src="https://www.googletagmanager.com/gtag/js?id=G-P7PY1RNXJQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-P7PY1RNXJQ');
</script>

<style>
    /* ========== åŸºç¤è¨­å®š ========== */
    *{box-sizing:border-box;}
    body{
        margin:0;
        font-family:"Noto Sans TC", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background:linear-gradient(#d9efff,#f3f8ff);
        min-height:100vh;
        overflow-x:hidden;
        color: #333;
        /* iOS Safe Area */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
    }

    /* ========== é›²æœµèƒŒæ™¯å‹•ç•« ========== */
    .clouds{ position:fixed; inset:0; overflow:hidden; z-index:0; pointer-events:none; }
    .cloud{ position:absolute; background:#fff; width:220px; height:60px; border-radius:50px; filter:blur(2px); opacity:0.7; animation:moveCloud 40s linear infinite; }
    .cloud::before, .cloud::after{ content:""; position:absolute; background:#fff; border-radius:50%; }
    .cloud::before{ width:110px; height:80px; top:-25px; left:5px; }
    .cloud::after{ width:130px; height:85px; top:-30px; left:90px; }
    .cloud.c1{top:40px;left:-260px;animation-duration:50s;}
    .cloud.c2{top:140px;left:-260px;animation-duration:60s;}
    .cloud.c3{top:220px;left:-260px;animation-duration:70s;}
    @keyframes moveCloud{ 0%{transform:translateX(0);} 100%{transform:translateX(140vw);} }

    /* ========== ä¸»è¦å®¹å™¨ ========== */
    .container{ position:relative; z-index:10; max-width:520px; margin:0 auto; padding:20px 16px 40px; }
    h1{ text-align:center; font-size:26px; margin:12px 0 8px; color: #111; font-weight: 800; letter-spacing: 1px; }
    .subtitle-emoji{ text-align:center; font-size:32px; margin-bottom:16px; }

    /* ========== å¡ç‰‡å…±ç”¨æ¨£å¼ ========== */
    .card{ background:#ffffff; border-radius:24px; padding:24px 22px; box-shadow:0 10px 25px rgba(58,141,255,0.15); margin-bottom:20px; transition: transform 0.2s; }
    .card-title{ font-weight:700; margin-bottom:12px; font-size:20px; color: #444; }

    /* ========== æœå°‹å€å¡Š (åŠ å¤§) ========== */
    .search-wrapper{ position:relative; margin-top:8px; }
    #searchInput{ width:100%; padding:15px 16px; font-size:20px; border-radius:14px; border:2px solid #e0e8ff; outline:none; background:#f9fbff; color: #333; transition: all 0.2s; }
    #searchInput:focus { border-color: #3A8DFF; box-shadow: 0 0 0 3px rgba(58,141,255,0.15); background:#fff; }
    
    #suggestions{ position:absolute; left:0; right:0; top:105%; background:#fff; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.15); max-height:280px; overflow-y:auto; display:none; z-index:100; border: 1px solid #eee; }
    
    .s-item{ padding:14px 16px; cursor:pointer; font-size:18px; border-bottom: 1px solid #f5f5f5; color: #333; }
    .s-item:last-child{ border-bottom: none; }
    .s-item:hover{ background:#f0f7ff; color: #3A8DFF; font-weight: 600; }
    
    .s-header { padding: 10px 16px; font-size: 15px; color: #888; background: #fafafa; font-weight: 700; border-bottom: 1px solid #eee; }
    .s-global { color: #555; }

    /* ========== æŒ‰éˆ•çµ„ (åŠ å¤§) ========== */
    .btn-row{ display:flex; gap:12px; margin-top:18px; }
    .main-btn, .ghost-btn{ flex:1; padding:14px 16px; font-size:18px; font-weight: 600; border-radius:16px; cursor:pointer; transition: transform 0.1s, background 0.2s; border:none; display: flex; align-items: center; justify-content: center; gap: 6px;}
    .main-btn:active, .ghost-btn:active { transform: scale(0.98); }
    
    .main-btn{ background:linear-gradient(135deg, #3A8DFF, #2a75d9); color:#fff; box-shadow: 0 4px 10px rgba(58,141,255,0.3); }
    .ghost-btn{ border:2px solid #e0e8ff; background:#fff; color:#3A8DFF; }
    .ghost-btn:hover{ background:#f0f7ff; border-color:#3A8DFF; }
    
    .main-btn:disabled, .ghost-btn:disabled { opacity: 0.6; cursor: not-allowed; filter: grayscale(100%); background: #ccc; color: #666; }

    /* ========== éª¨æ¶å± ========== */
    .skeleton-wrapper { display: none; }
    .skeleton {
        background: #f0f0f0;
        background: linear-gradient(90deg, #f0f0f0 25%, #f8f8f8 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite linear;
        border-radius: 8px;
    }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

    .sk-header { display:flex; flex-direction:column; gap:10px; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:10px; }
    .sk-title { width: 60%; height: 36px; }
    .sk-row { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
    .sk-icon { width: 36px; height: 36px; border-radius: 50%; }
    .sk-text { flex: 1; height: 28px; }
    .sk-note { width: 100%; height: 70px; margin-top: 15px; border-radius: 12px; }

    /* ========== çœŸå¯¦å¤©æ°£è³‡æ–™å€ (æ¨‚é½¡ç‰ˆ Compact List) ========== */
    #weatherSummaryCard{ display:none; line-height:1.6; color: #111; animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }

    .summary-header { margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #eee; }
    #summaryCity { font-size: 26px; font-weight: 800; color: #222; }
    #summaryTime { font-size: 16px; color: #666; margin-top: 6px; }

    /* åˆ—è¡¨é …ç›®æ¨£å¼ (æ”¾å¤§) */
    .info-row { 
        margin-bottom: 14px; 
        display: flex; 
        align-items: flex-start; 
        padding: 4px 0;
    }
    .info-icon { 
        min-width: 40px; 
        text-align: center; 
        margin-right: 12px; 
        font-size: 26px; /* åœ–ç¤ºæ”¾å¤§ */
        display: flex; 
        align-items: center; 
        justify-content: center;
    }
    .info-text { 
        flex: 1; 
        word-break: break-word; 
        font-size: 21px; /* ä¸»æ–‡æ”¾å¤§ */
        line-height: 1.5;
        color: #222;
        font-weight: 500;
    }
    
    /* æ•¸æ“šæ¨™ç±¤æ¨£å¼ (æ”¾å¤§) */
    .highlight-data {
        font-size: 18px; /* å‰¯æ–‡æ”¾å¤§ */
        color: #444;
        background: #f0f4f8;
        padding: 6px 10px;
        border-radius: 8px;
        display: inline-block;
        margin-top: 6px;
        margin-right: 6px;
        font-weight: 500;
    }

    /* é å ±åˆ†éš”ç·š */
    .forecast-row {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 2px dashed #e0e0e0;
        color: #444;
    }

    #weatherBottomNote { margin-top: 20px; font-weight: 600; color: #2c5282; background: #eef6fc; padding: 16px; border-radius: 14px; font-size: 19px; line-height: 1.6; }

    /* ========== é€šå‹¤æŒ‰éˆ•æ¨£å¼ (åŠ å¤§) ========== */
    #commuteBtns { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-top: 10px; }
    .cm-btn{ flex:1 1 45%; min-width:140px; padding:18px 14px; border-radius:20px; border:1px solid #e0e8ff; background:#fff; color:#3A8DFF; font-size:19px; font-weight: 600; cursor:pointer; box-shadow:0 3px 6px rgba(0,0,0,0.03); transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .cm-btn:hover{ background: #3A8DFF; color: #fff; transform: translateY(-2px); box-shadow: 0 5px 12px rgba(58,141,255,0.25); border-color: #3A8DFF; }
    .cm-btn span { font-size: 28px; } 
    
    #commuteResult{ margin-top:24px; font-size:21px; font-weight:500; line-height: 1.6; color: #333; padding: 18px; background: #fff; border-radius: 16px; border-left: 5px solid #3A8DFF; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

    .footer-copyright { text-align: center; padding: 40px 0 50px; font-size: 14px; color: #999; }
    
    @media (max-width:360px){
        .cm-btn { min-width: 130px; font-size: 17px; }
        .info-text { font-size: 19px; }
        .highlight-data { font-size: 16px; }
    }
</style>
</head>
<body>

<div class="clouds">
    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
    <div class="cloud c3"></div>
</div>

<div class="container">
    <h1>é€šå‹¤å¤©æ°£å°å¹«æ‰‹</h1>
    <div class="subtitle-emoji">ğŸŒ¤</div>

    <div class="card">
        <div class="card-title">ä½ è¦å»å“ªè£¡ï¼Ÿ</div>
        <div class="search-wrapper">
            <input id="searchInput" type="text" placeholder="æœå°‹ å°ç£è¡Œæ”¿å€ æˆ– å…¨çƒåŸå¸‚ (å¦‚: å¤§é˜ª)" autocomplete="off" />
            <div id="suggestions"></div>
        </div>

        <div class="btn-row">
            <button class="main-btn" id="getWeatherBtn">ğŸ” æŸ¥çœ‹å¤©æ°£</button>
            <button class="ghost-btn" id="geoBtn">ğŸ“ æœ€è¿‘ä½ç½®</button>
        </div>
    </div>

    <div class="card skeleton-wrapper" id="weatherSkeleton">
        <div class="sk-header">
            <div class="skeleton sk-title"></div>
            <div class="skeleton sk-title" style="width: 40%"></div>
        </div>
        <div class="sk-row"><div class="skeleton sk-icon"></div><div class="skeleton sk-text"></div></div>
        <div class="sk-row"><div class="skeleton sk-icon"></div><div class="skeleton sk-text"></div></div>
        <div class="sk-row"><div class="skeleton sk-icon"></div><div class="skeleton sk-text"></div></div>
        <div class="skeleton sk-note"></div>
    </div>

    <div class="card" id="weatherSummaryCard">
        <div class="summary-header">
            <div id="summaryCity"></div>
            <div id="summaryTime"></div>
        </div>
        <div id="infoList"></div>
        <div id="weatherBottomNote"></div>
    </div>

    <div class="card" id="commuteSection" style="display:none;">
        <div class="card-title" style="margin-bottom:15px; text-align:center;">é¸æ“‡ä½ çš„é€šå‹¤æ–¹å¼</div>
        <div id="commuteBtns">
            <button class="cm-btn" data-type="mrt"><span>ğŸš‡</span>æ·é‹</button>
            <button class="cm-btn" data-type="walk"><span>ğŸš¶</span>èµ°è·¯</button>
            <button class="cm-btn" data-type="bus"><span>ğŸšŒ</span>å…¬è»Š</button>
            <button class="cm-btn" data-type="scooter"><span>ğŸ›µ</span>æ©Ÿè»Š</button>
            <button class="cm-btn" data-type="car"><span>ğŸš—</span>é–‹è»Š</button>
            <button class="cm-btn" data-type="cafe"><span>â˜•</span>å…ˆèº²å’–å•¡å»³</button>
        </div>
        <div id="commuteResult"></div>
    </div>
</div>

<div class="footer-copyright">
    Copyright Â© JOBUS ASIA 2025-26
</div>

<script>
/**
 * =====================================================================
 * MODULE 1: DATA LAYER (å…¨å°368è¡Œæ”¿å€ + å…¨çƒæœå°‹)
 * =====================================================================
 */
const districts = [
  // --- åŸºéš†å¸‚ ---
  {name: "åŸºéš†å¸‚ ä»æ„›å€", lat: 25.128, lon: 121.742, geoRisk: true}, {name: "åŸºéš†å¸‚ ä¿¡ç¾©å€", lat: 25.127, lon: 121.758, geoRisk: true},
  {name: "åŸºéš†å¸‚ ä¸­æ­£å€", lat: 25.143, lon: 121.768, geoRisk: true}, {name: "åŸºéš†å¸‚ ä¸­å±±å€", lat: 25.148, lon: 121.733, geoRisk: true},
  {name: "åŸºéš†å¸‚ å®‰æ¨‚å€", lat: 25.138, lon: 121.718, geoRisk: true}, {name: "åŸºéš†å¸‚ æš–æš–å€", lat: 25.097, lon: 121.739, geoRisk: true},
  {name: "åŸºéš†å¸‚ ä¸ƒå µå€", lat: 25.094, lon: 121.706, geoRisk: true},
  // --- å°åŒ—å¸‚ ---
  {name: "å°åŒ—å¸‚ ä¸­æ­£å€", lat: 25.032, lon: 121.519}, {name: "å°åŒ—å¸‚ å¤§åŒå€", lat: 25.063, lon: 121.513},
  {name: "å°åŒ—å¸‚ ä¸­å±±å€", lat: 25.064, lon: 121.533}, {name: "å°åŒ—å¸‚ æ¾å±±å€", lat: 25.058, lon: 121.558},
  {name: "å°åŒ—å¸‚ å¤§å®‰å€", lat: 25.026, lon: 121.543}, {name: "å°åŒ—å¸‚ è¬è¯å€", lat: 25.030, lon: 121.498},
  {name: "å°åŒ—å¸‚ ä¿¡ç¾©å€", lat: 25.033, lon: 121.565}, {name: "å°åŒ—å¸‚ å£«æ—å€", lat: 25.092, lon: 121.525, geoRisk: true},
  {name: "å°åŒ—å¸‚ åŒ—æŠ•å€", lat: 25.132, lon: 121.500, geoRisk: true}, {name: "å°åŒ—å¸‚ å…§æ¹–å€", lat: 25.083, lon: 121.594, geoRisk: true},
  {name: "å°åŒ—å¸‚ å—æ¸¯å€", lat: 25.055, lon: 121.617, geoRisk: true}, {name: "å°åŒ—å¸‚ æ–‡å±±å€", lat: 24.998, lon: 121.574, geoRisk: true},
  // --- æ–°åŒ—å¸‚ ---
  {name: "æ–°åŒ—å¸‚ æ¿æ©‹å€", lat: 25.014, lon: 121.464}, {name: "æ–°åŒ—å¸‚ ä¸‰é‡å€", lat: 25.061, lon: 121.488},
  {name: "æ–°åŒ—å¸‚ ä¸­å’Œå€", lat: 24.993, lon: 121.500}, {name: "æ–°åŒ—å¸‚ æ°¸å’Œå€", lat: 25.009, lon: 121.516},
  {name: "æ–°åŒ—å¸‚ æ–°èŠå€", lat: 25.036, lon: 121.450}, {name: "æ–°åŒ—å¸‚ æ–°åº—å€", lat: 24.957, lon: 121.538},
  {name: "æ–°åŒ—å¸‚ åœŸåŸå€", lat: 24.973, lon: 121.444}, {name: "æ–°åŒ—å¸‚ è˜†æ´²å€", lat: 25.085, lon: 121.480},
  {name: "æ–°åŒ—å¸‚ æ¨¹æ—å€", lat: 24.996, lon: 121.422}, {name: "æ–°åŒ—å¸‚ é¶¯æ­Œå€", lat: 24.954, lon: 121.353},
  {name: "æ–°åŒ—å¸‚ ä¸‰å³½å€", lat: 24.935, lon: 121.369}, {name: "æ–°åŒ—å¸‚ äº”è‚¡å€", lat: 25.084, lon: 121.442},
  {name: "æ–°åŒ—å¸‚ æ³°å±±å€", lat: 25.058, lon: 121.436}, {name: "æ–°åŒ—å¸‚ æ—å£å€", lat: 25.077, lon: 121.393},
  {name: "æ–°åŒ—å¸‚ æ·¡æ°´å€", lat: 25.175, lon: 121.444, geoRisk: true}, {name: "æ–°åŒ—å¸‚ æ±æ­¢å€", lat: 25.067, lon: 121.660, geoRisk: true},
  {name: "æ–°åŒ—å¸‚ ç‘èŠ³å€", lat: 25.109, lon: 121.805, geoRisk: true}, {name: "æ–°åŒ—å¸‚ å…«é‡Œå€", lat: 25.146, lon: 121.399},
  {name: "æ–°åŒ—å¸‚ æ·±å‘å€", lat: 25.002, lon: 121.615, geoRisk: true}, {name: "æ–°åŒ—å¸‚ çŸ³ç¢‡å€", lat: 24.991, lon: 121.660, geoRisk: true},
  {name: "æ–°åŒ—å¸‚ åªæ—å€", lat: 24.935, lon: 121.710, geoRisk: true}, {name: "æ–°åŒ—å¸‚ ä¸‰èŠå€", lat: 25.258, lon: 121.500},
  {name: "æ–°åŒ—å¸‚ çŸ³é–€å€", lat: 25.290, lon: 121.568, geoRisk: true}, {name: "æ–°åŒ—å¸‚ é‡‘å±±å€", lat: 25.222, lon: 121.638, geoRisk: true},
  {name: "æ–°åŒ—å¸‚ è¬é‡Œå€", lat: 25.176, lon: 121.636, geoRisk: true}, {name: "æ–°åŒ—å¸‚ å¹³æºªå€", lat: 25.026, lon: 121.739, geoRisk: true},
  {name: "æ–°åŒ—å¸‚ é›™æºªå€", lat: 25.034, lon: 121.865, geoRisk: true}, {name: "æ–°åŒ—å¸‚ è²¢å¯®å€", lat: 25.017, lon: 121.944, geoRisk: true},
  {name: "æ–°åŒ—å¸‚ çƒä¾†å€", lat: 24.865, lon: 121.551, geoRisk: true},
  // --- æ¡ƒåœ’å¸‚ ---
  {name: "æ¡ƒåœ’å¸‚ æ¡ƒåœ’å€", lat: 24.993, lon: 121.301}, {name: "æ¡ƒåœ’å¸‚ ä¸­å£¢å€", lat: 24.965, lon: 121.226},
  {name: "æ¡ƒåœ’å¸‚ å¤§æºªå€", lat: 24.881, lon: 121.286}, {name: "æ¡ƒåœ’å¸‚ æ¥Šæ¢…å€", lat: 24.908, lon: 121.146},
  {name: "æ¡ƒåœ’å¸‚ è˜†ç«¹å€", lat: 25.047, lon: 121.291}, {name: "æ¡ƒåœ’å¸‚ å¤§åœ’å€", lat: 25.062, lon: 121.196},
  {name: "æ¡ƒåœ’å¸‚ é¾œå±±å€", lat: 24.996, lon: 121.353}, {name: "æ¡ƒåœ’å¸‚ å…«å¾·å€", lat: 24.928, lon: 121.284},
  {name: "æ¡ƒåœ’å¸‚ é¾æ½­å€", lat: 24.864, lon: 121.217}, {name: "æ¡ƒåœ’å¸‚ å¹³é®å€", lat: 24.945, lon: 121.216},
  {name: "æ¡ƒåœ’å¸‚ æ–°å±‹å€", lat: 24.972, lon: 121.106}, {name: "æ¡ƒåœ’å¸‚ è§€éŸ³å€", lat: 25.036, lon: 121.082},
  {name: "æ¡ƒåœ’å¸‚ å¾©èˆˆå€", lat: 24.821, lon: 121.357, geoRisk: true},
  // --- æ–°ç«¹ç¸£å¸‚ ---
  {name: "æ–°ç«¹å¸‚ æ±å€", lat: 24.798, lon: 121.000}, {name: "æ–°ç«¹å¸‚ åŒ—å€", lat: 24.822, lon: 120.960},
  {name: "æ–°ç«¹å¸‚ é¦™å±±å€", lat: 24.768, lon: 120.925},
  {name: "æ–°ç«¹ç¸£ ç«¹åŒ—å¸‚", lat: 24.839, lon: 121.010}, {name: "æ–°ç«¹ç¸£ ç«¹æ±é®", lat: 24.739, lon: 121.095},
  {name: "æ–°ç«¹ç¸£ æ–°åŸ”é®", lat: 24.829, lon: 121.072}, {name: "æ–°ç«¹ç¸£ é—œè¥¿é®", lat: 24.796, lon: 121.176},
  {name: "æ–°ç«¹ç¸£ æ¹–å£é„‰", lat: 24.902, lon: 121.042}, {name: "æ–°ç«¹ç¸£ æ–°è±é„‰", lat: 24.898, lon: 120.985},
  {name: "æ–°ç«¹ç¸£ èŠæ—é„‰", lat: 24.774, lon: 121.082}, {name: "æ–°ç«¹ç¸£ æ©«å±±é„‰", lat: 24.718, lon: 121.116},
  {name: "æ–°ç«¹ç¸£ åŒ—åŸ”é„‰", lat: 24.700, lon: 121.058}, {name: "æ–°ç«¹ç¸£ å¯¶å±±é„‰", lat: 24.761, lon: 121.026},
  {name: "æ–°ç«¹ç¸£ å³¨çœ‰é„‰", lat: 24.686, lon: 121.026}, {name: "æ–°ç«¹ç¸£ å°–çŸ³é„‰", lat: 24.580, lon: 121.300, geoRisk: true},
  {name: "æ–°ç«¹ç¸£ äº”å³°é„‰", lat: 24.612, lon: 121.114, geoRisk: true},
  // --- è‹—æ —ç¸£ ---
  {name: "è‹—æ —ç¸£ è‹—æ —å¸‚", lat: 24.564, lon: 120.820}, {name: "è‹—æ —ç¸£ é ­ä»½å¸‚", lat: 24.687, lon: 120.908},
  {name: "è‹—æ —ç¸£ è‹‘è£¡é®", lat: 24.442, lon: 120.655}, {name: "è‹—æ —ç¸£ é€šéœ„é®", lat: 24.492, lon: 120.676},
  {name: "è‹—æ —ç¸£ ç«¹å—é®", lat: 24.686, lon: 120.879}, {name: "è‹—æ —ç¸£ å¾Œé¾é®", lat: 24.613, lon: 120.786},
  {name: "è‹—æ —ç¸£ å“è˜­é®", lat: 24.318, lon: 120.825}, {name: "è‹—æ —ç¸£ å¤§æ¹–é„‰", lat: 24.423, lon: 120.865},
  {name: "è‹—æ —ç¸£ å…¬é¤¨é„‰", lat: 24.505, lon: 120.826}, {name: "è‹—æ —ç¸£ éŠ…é‘¼é„‰", lat: 24.484, lon: 120.787},
  {name: "è‹—æ —ç¸£ å—åº„é„‰", lat: 24.599, lon: 121.004}, {name: "è‹—æ —ç¸£ é ­å±‹é„‰", lat: 24.576, lon: 120.849},
  {name: "è‹—æ —ç¸£ ä¸‰ç¾©é„‰", lat: 24.409, lon: 120.772}, {name: "è‹—æ —ç¸£ è¥¿æ¹–é„‰", lat: 24.545, lon: 120.748},
  {name: "è‹—æ —ç¸£ é€ æ©‹é„‰", lat: 24.639, lon: 120.864}, {name: "è‹—æ —ç¸£ ä¸‰ç£é„‰", lat: 24.654, lon: 120.952},
  {name: "è‹—æ —ç¸£ ç…æ½­é„‰", lat: 24.542, lon: 120.923}, {name: "è‹—æ —ç¸£ æ³°å®‰é„‰", lat: 24.437, lon: 120.992, geoRisk: true},
  // --- å°ä¸­å¸‚ ---
  {name: "å°ä¸­å¸‚ ä¸­å€", lat: 24.142, lon: 120.680}, {name: "å°ä¸­å¸‚ æ±å€", lat: 24.135, lon: 120.695},
  {name: "å°ä¸­å¸‚ å—å€", lat: 24.120, lon: 120.665}, {name: "å°ä¸­å¸‚ è¥¿å€", lat: 24.144, lon: 120.665},
  {name: "å°ä¸­å¸‚ åŒ—å€", lat: 24.161, lon: 120.680}, {name: "å°ä¸­å¸‚ åŒ—å±¯å€", lat: 24.180, lon: 120.720},
  {name: "å°ä¸­å¸‚ è¥¿å±¯å€", lat: 24.175, lon: 120.640}, {name: "å°ä¸­å¸‚ å—å±¯å€", lat: 24.138, lon: 120.640},
  {name: "å°ä¸­å¸‚ è±åŸå€", lat: 24.254, lon: 120.720}, {name: "å°ä¸­å¸‚ æ±å‹¢å€", lat: 24.258, lon: 120.825},
  {name: "å°ä¸­å¸‚ å¤§ç”²å€", lat: 24.348, lon: 120.627}, {name: "å°ä¸­å¸‚ æ¸…æ°´å€", lat: 24.269, lon: 120.575},
  {name: "å°ä¸­å¸‚ æ²™é¹¿å€", lat: 24.234, lon: 120.560}, {name: "å°ä¸­å¸‚ æ¢§æ£²å€", lat: 24.255, lon: 120.535},
  {name: "å°ä¸­å¸‚ åé‡Œå€", lat: 24.305, lon: 120.710}, {name: "å°ä¸­å¸‚ ç¥å²¡å€", lat: 24.260, lon: 120.660},
  {name: "å°ä¸­å¸‚ æ½­å­å€", lat: 24.208, lon: 120.705}, {name: "å°ä¸­å¸‚ å¤§é›…å€", lat: 24.228, lon: 120.647},
  {name: "å°ä¸­å¸‚ æ–°ç¤¾å€", lat: 24.227, lon: 120.812}, {name: "å°ä¸­å¸‚ çŸ³å²¡å€", lat: 24.275, lon: 120.776},
  {name: "å°ä¸­å¸‚ å¤–åŸ”å€", lat: 24.331, lon: 120.651}, {name: "å°ä¸­å¸‚ å¤§å®‰å€", lat: 24.346, lon: 120.589},
  {name: "å°ä¸­å¸‚ çƒæ—¥å€", lat: 24.106, lon: 120.623}, {name: "å°ä¸­å¸‚ å¤§è‚šå€", lat: 24.155, lon: 120.543},
  {name: "å°ä¸­å¸‚ é¾äº•å€", lat: 24.204, lon: 120.545}, {name: "å°ä¸­å¸‚ éœ§å³°å€", lat: 24.062, lon: 120.700},
  {name: "å°ä¸­å¸‚ å¤ªå¹³å€", lat: 24.127, lon: 120.720}, {name: "å°ä¸­å¸‚ å¤§é‡Œå€", lat: 24.099, lon: 120.686},
  {name: "å°ä¸­å¸‚ å’Œå¹³å€", lat: 24.276, lon: 121.050, geoRisk: true},
  // --- å½°åŒ–ç¸£ ---
  {name: "å½°åŒ–ç¸£ å½°åŒ–å¸‚", lat: 24.081, lon: 120.538}, {name: "å½°åŒ–ç¸£ é¹¿æ¸¯é®", lat: 24.056, lon: 120.435},
  {name: "å½°åŒ–ç¸£ å’Œç¾é®", lat: 24.113, lon: 120.500}, {name: "å½°åŒ–ç¸£ ç·šè¥¿é„‰", lat: 24.131, lon: 120.467},
  {name: "å½°åŒ–ç¸£ ä¼¸æ¸¯é„‰", lat: 24.152, lon: 120.485}, {name: "å½°åŒ–ç¸£ ç¦èˆˆé„‰", lat: 24.040, lon: 120.443},
  {name: "å½°åŒ–ç¸£ ç§€æ°´é„‰", lat: 24.037, lon: 120.501}, {name: "å½°åŒ–ç¸£ èŠ±å£‡é„‰", lat: 24.027, lon: 120.539},
  {name: "å½°åŒ–ç¸£ èŠ¬åœ’é„‰", lat: 23.999, lon: 120.626}, {name: "å½°åŒ–ç¸£ å“¡æ—å¸‚", lat: 23.959, lon: 120.574},
  {name: "å½°åŒ–ç¸£ æºªæ¹–é®", lat: 23.956, lon: 120.480}, {name: "å½°åŒ–ç¸£ ç”°ä¸­é®", lat: 23.861, lon: 120.587},
  {name: "å½°åŒ–ç¸£ å¤§æ‘é„‰", lat: 23.993, lon: 120.546}, {name: "å½°åŒ–ç¸£ åŸ”é¹½é„‰", lat: 24.001, lon: 120.463},
  {name: "å½°åŒ–ç¸£ åŸ”å¿ƒé„‰", lat: 23.953, lon: 120.543}, {name: "å½°åŒ–ç¸£ æ°¸é–é„‰", lat: 23.923, lon: 120.546},
  {name: "å½°åŒ–ç¸£ ç¤¾é ­é„‰", lat: 23.896, lon: 120.582}, {name: "å½°åŒ–ç¸£ äºŒæ°´é„‰", lat: 23.811, lon: 120.613},
  {name: "å½°åŒ–ç¸£ åŒ—æ–—é®", lat: 23.873, lon: 120.525}, {name: "å½°åŒ–ç¸£ äºŒæ—é®", lat: 23.899, lon: 120.373},
  {name: "å½°åŒ–ç¸£ ç”°å°¾é„‰", lat: 23.889, lon: 120.529}, {name: "å½°åŒ–ç¸£ åŸ¤é ­é„‰", lat: 23.887, lon: 120.461},
  {name: "å½°åŒ–ç¸£ èŠ³è‹‘é„‰", lat: 23.927, lon: 120.323}, {name: "å½°åŒ–ç¸£ å¤§åŸé„‰", lat: 23.854, lon: 120.285},
  {name: "å½°åŒ–ç¸£ ç«¹å¡˜é„‰", lat: 23.858, lon: 120.424}, {name: "å½°åŒ–ç¸£ æºªå·é„‰", lat: 23.854, lon: 120.501},
  // --- å—æŠ•ç¸£ ---
  {name: "å—æŠ•ç¸£ å—æŠ•å¸‚", lat: 23.909, lon: 120.686}, {name: "å—æŠ•ç¸£ åŸ”é‡Œé®", lat: 23.966, lon: 120.968},
  {name: "å—æŠ•ç¸£ è‰å±¯é®", lat: 23.978, lon: 120.683}, {name: "å—æŠ•ç¸£ ç«¹å±±é®", lat: 23.757, lon: 120.672},
  {name: "å—æŠ•ç¸£ é›†é›†é®", lat: 23.829, lon: 120.785}, {name: "å—æŠ•ç¸£ åé–“é„‰", lat: 23.873, lon: 120.673},
  {name: "å—æŠ•ç¸£ é¹¿è°·é„‰", lat: 23.744, lon: 120.751}, {name: "å—æŠ•ç¸£ ä¸­å¯®é„‰", lat: 23.910, lon: 120.759},
  {name: "å—æŠ•ç¸£ é­šæ± é„‰", lat: 23.897, lon: 120.936}, {name: "å—æŠ•ç¸£ åœ‹å§“é„‰", lat: 24.041, lon: 120.852},
  {name: "å—æŠ•ç¸£ æ°´é‡Œé„‰", lat: 23.812, lon: 120.854}, {name: "å—æŠ•ç¸£ ä¿¡ç¾©é„‰", lat: 23.693, lon: 120.970, geoRisk: true},
  {name: "å—æŠ•ç¸£ ä»æ„›é„‰", lat: 24.026, lon: 121.130, geoRisk: true},
  // --- é›²æ—ç¸£ ---
  {name: "é›²æ—ç¸£ æ–—å…­å¸‚", lat: 23.709, lon: 120.543}, {name: "é›²æ—ç¸£ æ–—å—é®", lat: 23.676, lon: 120.480},
  {name: "é›²æ—ç¸£ è™å°¾é®", lat: 23.708, lon: 120.432}, {name: "é›²æ—ç¸£ è¥¿èºé®", lat: 23.800, lon: 120.461},
  {name: "é›²æ—ç¸£ åœŸåº«é®", lat: 23.677, lon: 120.392}, {name: "é›²æ—ç¸£ åŒ—æ¸¯é®", lat: 23.570, lon: 120.302},
  {name: "é›²æ—ç¸£ å¤å‘é„‰", lat: 23.645, lon: 120.560}, {name: "é›²æ—ç¸£ å¤§åŸ¤é„‰", lat: 23.647, lon: 120.428},
  {name: "é›²æ—ç¸£ è¿æ¡é„‰", lat: 23.761, lon: 120.522}, {name: "é›²æ—ç¸£ æ—å…§é„‰", lat: 23.760, lon: 120.613},
  {name: "é›²æ—ç¸£ äºŒå´™é„‰", lat: 23.771, lon: 120.415}, {name: "é›²æ—ç¸£ å´™èƒŒé„‰", lat: 23.759, lon: 120.354},
  {name: "é›²æ—ç¸£ éº¥å¯®é„‰", lat: 23.748, lon: 120.252}, {name: "é›²æ—ç¸£ æ±å‹¢é„‰", lat: 23.688, lon: 120.252},
  {name: "é›²æ—ç¸£ è¤’å¿ é„‰", lat: 23.701, lon: 120.309}, {name: "é›²æ—ç¸£ å°è¥¿é„‰", lat: 23.704, lon: 120.198},
  {name: "é›²æ—ç¸£ å…ƒé•·é„‰", lat: 23.652, lon: 120.311}, {name: "é›²æ—ç¸£ å››æ¹–é„‰", lat: 23.638, lon: 120.226},
  {name: "é›²æ—ç¸£ å£æ¹–é„‰", lat: 23.582, lon: 120.183}, {name: "é›²æ—ç¸£ æ°´æ—é„‰", lat: 23.576, lon: 120.246},
  // --- å˜‰ç¾©ç¸£å¸‚ ---
  {name: "å˜‰ç¾©å¸‚ æ±å€", lat: 23.484, lon: 120.463}, {name: "å˜‰ç¾©å¸‚ è¥¿å€", lat: 23.479, lon: 120.432},
  {name: "å˜‰ç¾©ç¸£ å¤ªä¿å¸‚", lat: 23.460, lon: 120.332}, {name: "å˜‰ç¾©ç¸£ æœ´å­å¸‚", lat: 23.465, lon: 120.245},
  {name: "å˜‰ç¾©ç¸£ å¸ƒè¢‹é®", lat: 23.378, lon: 120.160}, {name: "å˜‰ç¾©ç¸£ å¤§æ—é®", lat: 23.602, lon: 120.472},
  {name: "å˜‰ç¾©ç¸£ æ°‘é›„é„‰", lat: 23.551, lon: 120.430}, {name: "å˜‰ç¾©ç¸£ æºªå£é„‰", lat: 23.601, lon: 120.393},
  {name: "å˜‰ç¾©ç¸£ æ–°æ¸¯é„‰", lat: 23.553, lon: 120.347}, {name: "å˜‰ç¾©ç¸£ å…­è…³é„‰", lat: 23.498, lon: 120.290},
  {name: "å˜‰ç¾©ç¸£ æ±çŸ³é„‰", lat: 23.456, lon: 120.176}, {name: "å˜‰ç¾©ç¸£ ç¾©ç«¹é„‰", lat: 23.336, lon: 120.242},
  {name: "å˜‰ç¾©ç¸£ é¹¿è‰é„‰", lat: 23.411, lon: 120.308}, {name: "å˜‰ç¾©ç¸£ æ°´ä¸Šé„‰", lat: 23.428, lon: 120.407},
  {name: "å˜‰ç¾©ç¸£ ä¸­åŸ”é„‰", lat: 23.425, lon: 120.509}, {name: "å˜‰ç¾©ç¸£ ç«¹å´é„‰", lat: 23.522, lon: 120.551},
  {name: "å˜‰ç¾©ç¸£ æ¢…å±±é„‰", lat: 23.583, lon: 120.557}, {name: "å˜‰ç¾©ç¸£ ç•ªè·¯é„‰", lat: 23.453, lon: 120.596},
  {name: "å˜‰ç¾©ç¸£ å¤§åŸ”é„‰", lat: 23.298, lon: 120.603}, {name: "å˜‰ç¾©ç¸£ é˜¿é‡Œå±±é„‰", lat: 23.350, lon: 120.730, geoRisk: true},
  // --- å°å—å¸‚ ---
  {name: "å°å—å¸‚ æ±å€", lat: 22.991, lon: 120.227}, {name: "å°å—å¸‚ å—å€", lat: 22.955, lon: 120.185},
  {name: "å°å—å¸‚ åŒ—å€", lat: 23.007, lon: 120.203}, {name: "å°å—å¸‚ å®‰å—å€", lat: 23.047, lon: 120.184},
  {name: "å°å—å¸‚ å®‰å¹³å€", lat: 22.997, lon: 120.167}, {name: "å°å—å¸‚ ä¸­è¥¿å€", lat: 22.990, lon: 120.197},
  {name: "å°å—å¸‚ æ–°ç‡Ÿå€", lat: 23.308, lon: 120.315}, {name: "å°å—å¸‚ é¹½æ°´å€", lat: 23.264, lon: 120.266},
  {name: "å°å—å¸‚ ç™½æ²³å€", lat: 23.351, lon: 120.416}, {name: "å°å—å¸‚ æŸ³ç‡Ÿå€", lat: 23.278, lon: 120.343},
  {name: "å°å—å¸‚ å¾Œå£å€", lat: 23.367, lon: 120.360}, {name: "å°å—å¸‚ æ±å±±å€", lat: 23.325, lon: 120.403},
  {name: "å°å—å¸‚ éº»è±†å€", lat: 23.186, lon: 120.248}, {name: "å°å—å¸‚ ä¸‹ç‡Ÿå€", lat: 23.237, lon: 120.263},
  {name: "å°å—å¸‚ å…­ç”²å€", lat: 23.230, lon: 120.348}, {name: "å°å—å¸‚ å®˜ç”°å€", lat: 23.195, lon: 120.315},
  {name: "å°å—å¸‚ å¤§å…§å€", lat: 23.119, lon: 120.354}, {name: "å°å—å¸‚ ä½³é‡Œå€", lat: 23.165, lon: 120.176},
  {name: "å°å—å¸‚ å­¸ç”²å€", lat: 23.232, lon: 120.180}, {name: "å°å—å¸‚ è¥¿æ¸¯å€", lat: 23.123, lon: 120.203},
  {name: "å°å—å¸‚ ä¸ƒè‚¡å€", lat: 23.141, lon: 120.138}, {name: "å°å—å¸‚ å°‡è»å€", lat: 23.199, lon: 120.155},
  {name: "å°å—å¸‚ åŒ—é–€å€", lat: 23.267, lon: 120.125}, {name: "å°å—å¸‚ æ–°åŒ–å€", lat: 23.037, lon: 120.309},
  {name: "å°å—å¸‚ å–„åŒ–å€", lat: 23.131, lon: 120.294}, {name: "å°å—å¸‚ æ–°å¸‚å€", lat: 23.078, lon: 120.294},
  {name: "å°å—å¸‚ å®‰å®šå€", lat: 23.121, lon: 120.236}, {name: "å°å—å¸‚ å±±ä¸Šå€", lat: 23.104, lon: 120.353},
  {name: "å°å—å¸‚ ç‰äº•å€", lat: 23.124, lon: 120.461}, {name: "å°å—å¸‚ æ¥ è¥¿å€", lat: 23.173, lon: 120.485},
  {name: "å°å—å¸‚ å—åŒ–å€", lat: 23.042, lon: 120.478}, {name: "å°å—å¸‚ å·¦é®å€", lat: 23.057, lon: 120.408},
  {name: "å°å—å¸‚ ä»å¾·å€", lat: 22.971, lon: 120.252}, {name: "å°å—å¸‚ æ­¸ä»å€", lat: 22.966, lon: 120.295},
  {name: "å°å—å¸‚ é—œå»Ÿå€", lat: 22.963, lon: 120.328}, {name: "å°å—å¸‚ é¾å´å€", lat: 22.964, lon: 120.360},
  {name: "å°å—å¸‚ æ°¸åº·å€", lat: 23.024, lon: 120.259},
  // --- é«˜é›„å¸‚ ---
  {name: "é«˜é›„å¸‚ é¹½åŸ•å€", lat: 22.625, lon: 120.285}, {name: "é«˜é›„å¸‚ é¼“å±±å€", lat: 22.651, lon: 120.278},
  {name: "é«˜é›„å¸‚ å·¦ç‡Ÿå€", lat: 22.690, lon: 120.295}, {name: "é«˜é›„å¸‚ æ¥ æ¢“å€", lat: 22.727, lon: 120.325},
  {name: "é«˜é›„å¸‚ ä¸‰æ°‘å€", lat: 22.648, lon: 120.307}, {name: "é«˜é›„å¸‚ æ–°èˆˆå€", lat: 22.628, lon: 120.302},
  {name: "é«˜é›„å¸‚ å‰é‡‘å€", lat: 22.627, lon: 120.293}, {name: "é«˜é›„å¸‚ è‹“é›…å€", lat: 22.625, lon: 120.312},
  {name: "é«˜é›„å¸‚ å‰é®å€", lat: 22.586, lon: 120.318}, {name: "é«˜é›„å¸‚ æ——æ´¥å€", lat: 22.597, lon: 120.275},
  {name: "é«˜é›„å¸‚ å°æ¸¯å€", lat: 22.563, lon: 120.355}, {name: "é«˜é›„å¸‚ é³³å±±å€", lat: 22.627, lon: 120.357},
  {name: "é«˜é›„å¸‚ æ—åœ’å€", lat: 22.505, lon: 120.395}, {name: "é«˜é›„å¸‚ å¤§å¯®å€", lat: 22.605, lon: 120.395},
  {name: "é«˜é›„å¸‚ å¤§æ¨¹å€", lat: 22.694, lon: 120.432}, {name: "é«˜é›„å¸‚ å¤§ç¤¾å€", lat: 22.731, lon: 120.347},
  {name: "é«˜é›„å¸‚ ä»æ­¦å€", lat: 22.701, lon: 120.347}, {name: "é«˜é›„å¸‚ é³¥æ¾å€", lat: 22.660, lon: 120.365},
  {name: "é«˜é›„å¸‚ å²¡å±±å€", lat: 22.796, lon: 120.295}, {name: "é«˜é›„å¸‚ æ©‹é ­å€", lat: 22.757, lon: 120.305},
  {name: "é«˜é›„å¸‚ ç‡•å·¢å€", lat: 22.793, lon: 120.360}, {name: "é«˜é›„å¸‚ ç”°å¯®å€", lat: 22.871, lon: 120.364},
  {name: "é«˜é›„å¸‚ é˜¿è“®å€", lat: 22.883, lon: 120.327}, {name: "é«˜é›„å¸‚ è·¯ç«¹å€", lat: 22.855, lon: 120.262},
  {name: "é«˜é›„å¸‚ æ¹–å…§å€", lat: 22.876, lon: 120.219}, {name: "é«˜é›„å¸‚ èŒ„è£å€", lat: 22.906, lon: 120.181},
  {name: "é«˜é›„å¸‚ æ°¸å®‰å€", lat: 22.819, lon: 120.228}, {name: "é«˜é›„å¸‚ å½Œé™€å€", lat: 22.783, lon: 120.247},
  {name: "é«˜é›„å¸‚ æ¢“å®˜å€", lat: 22.760, lon: 120.264}, {name: "é«˜é›„å¸‚ æ——å±±å€", lat: 22.888, lon: 120.482},
  {name: "é«˜é›„å¸‚ ç¾æ¿ƒå€", lat: 22.898, lon: 120.536}, {name: "é«˜é›„å¸‚ å…­é¾œå€", lat: 23.003, lon: 120.631},
  {name: "é«˜é›„å¸‚ ç”²ä»™å€", lat: 23.083, lon: 120.591}, {name: "é«˜é›„å¸‚ æ‰æ—å€", lat: 22.970, lon: 120.536},
  {name: "é«˜é›„å¸‚ å…§é–€å€", lat: 22.943, lon: 120.460}, {name: "é«˜é›„å¸‚ èŒ‚æ—å€", lat: 22.886, lon: 120.662, geoRisk: true},
  {name: "é«˜é›„å¸‚ æ¡ƒæºå€", lat: 23.160, lon: 120.760, geoRisk: true}, {name: "é«˜é›„å¸‚ é‚£ç‘ªå¤å€", lat: 23.230, lon: 120.690, geoRisk: true},
  // --- å±æ±ç¸£ ---
  {name: "å±æ±ç¸£ å±æ±å¸‚", lat: 22.669, lon: 120.486}, {name: "å±æ±ç¸£ æ½®å·é®", lat: 22.550, lon: 120.542},
  {name: "å±æ±ç¸£ æ±æ¸¯é®", lat: 22.467, lon: 120.452}, {name: "å±æ±ç¸£ æ†æ˜¥é®", lat: 22.002, lon: 120.744},
  {name: "å±æ±ç¸£ è¬ä¸¹é„‰", lat: 22.589, lon: 120.485}, {name: "å±æ±ç¸£ é•·æ²»é„‰", lat: 22.677, lon: 120.528},
  {name: "å±æ±ç¸£ éºŸæ´›é„‰", lat: 22.651, lon: 120.526}, {name: "å±æ±ç¸£ ä¹å¦‚é„‰", lat: 22.739, lon: 120.490},
  {name: "å±æ±ç¸£ é‡Œæ¸¯é„‰", lat: 22.777, lon: 120.494}, {name: "å±æ±ç¸£ é¹½åŸ”é„‰", lat: 22.755, lon: 120.573},
  {name: "å±æ±ç¸£ é«˜æ¨¹é„‰", lat: 22.825, lon: 120.600}, {name: "å±æ±ç¸£ è¬å·’é„‰", lat: 22.573, lon: 120.567},
  {name: "å±æ±ç¸£ å…§åŸ”é„‰", lat: 22.615, lon: 120.566}, {name: "å±æ±ç¸£ ç«¹ç”°é„‰", lat: 22.586, lon: 120.542},
  {name: "å±æ±ç¸£ æ–°åŸ¤é„‰", lat: 22.476, lon: 120.550}, {name: "å±æ±ç¸£ æ‹å¯®é„‰", lat: 22.368, lon: 120.594},
  {name: "å±æ±ç¸£ æ–°åœ’é„‰", lat: 22.540, lon: 120.461}, {name: "å±æ±ç¸£ å´é ‚é„‰", lat: 22.514, lon: 120.512},
  {name: "å±æ±ç¸£ æ—é‚Šé„‰", lat: 22.435, lon: 120.514}, {name: "å±æ±ç¸£ å—å·é„‰", lat: 22.490, lon: 120.513},
  {name: "å±æ±ç¸£ ä½³å†¬é„‰", lat: 22.420, lon: 120.549}, {name: "å±æ±ç¸£ ç‰çƒé„‰", lat: 22.344, lon: 120.369},
  {name: "å±æ±ç¸£ è»ŠåŸé„‰", lat: 22.072, lon: 120.711}, {name: "å±æ±ç¸£ æ»¿å·é„‰", lat: 22.022, lon: 120.837},
  {name: "å±æ±ç¸£ æ‹å±±é„‰", lat: 22.259, lon: 120.653}, {name: "å±æ±ç¸£ ä¸‰åœ°é–€é„‰", lat: 22.712, lon: 120.653, geoRisk: true},
  {name: "å±æ±ç¸£ éœ§å°é„‰", lat: 22.748, lon: 120.729, geoRisk: true}, {name: "å±æ±ç¸£ ç‘ªå®¶é„‰", lat: 22.642, lon: 120.645, geoRisk: true},
  {name: "å±æ±ç¸£ æ³°æ­¦é„‰", lat: 22.593, lon: 120.632, geoRisk: true}, {name: "å±æ±ç¸£ ä¾†ç¾©é„‰", lat: 22.525, lon: 120.633, geoRisk: true},
  {name: "å±æ±ç¸£ æ˜¥æ—¥é„‰", lat: 22.370, lon: 120.630, geoRisk: true}, {name: "å±æ±ç¸£ ç…å­é„‰", lat: 22.201, lon: 120.706, geoRisk: true},
  {name: "å±æ±ç¸£ ç‰¡ä¸¹é„‰", lat: 22.128, lon: 120.822, geoRisk: true},
  // --- å®œè˜­ç¸£ ---
  {name: "å®œè˜­ç¸£ å®œè˜­å¸‚", lat: 24.757, lon: 121.752, geoRisk: true}, {name: "å®œè˜­ç¸£ ç¾…æ±é®", lat: 24.675, lon: 121.767, geoRisk: true},
  {name: "å®œè˜­ç¸£ è˜‡æ¾³é®", lat: 24.595, lon: 121.848, geoRisk: true}, {name: "å®œè˜­ç¸£ é ­åŸé®", lat: 24.858, lon: 121.823, geoRisk: true},
  {name: "å®œè˜­ç¸£ ç¤æºªé„‰", lat: 24.821, lon: 121.764, geoRisk: true}, {name: "å®œè˜­ç¸£ å£¯åœé„‰", lat: 24.779, lon: 121.794, geoRisk: true},
  {name: "å®œè˜­ç¸£ å“¡å±±é„‰", lat: 24.743, lon: 121.720, geoRisk: true}, {name: "å®œè˜­ç¸£ å†¬å±±é„‰", lat: 24.634, lon: 121.792, geoRisk: true},
  {name: "å®œè˜­ç¸£ äº”çµé„‰", lat: 24.693, lon: 121.797, geoRisk: true}, {name: "å®œè˜­ç¸£ ä¸‰æ˜Ÿé„‰", lat: 24.665, lon: 121.652, geoRisk: true},
  {name: "å®œè˜­ç¸£ å¤§åŒé„‰", lat: 24.676, lon: 121.606, geoRisk: true}, {name: "å®œè˜­ç¸£ å—æ¾³é„‰", lat: 24.464, lon: 121.798, geoRisk: true},
  // --- èŠ±è“®ç¸£ ---
  {name: "èŠ±è“®ç¸£ èŠ±è“®å¸‚", lat: 23.977, lon: 121.604}, {name: "èŠ±è“®ç¸£ é³³æ—é®", lat: 23.744, lon: 121.450},
  {name: "èŠ±è“®ç¸£ ç‰é‡Œé®", lat: 23.335, lon: 121.311}, {name: "èŠ±è“®ç¸£ æ–°åŸé„‰", lat: 24.027, lon: 121.616},
  {name: "èŠ±è“®ç¸£ å‰å®‰é„‰", lat: 23.961, lon: 121.567}, {name: "èŠ±è“®ç¸£ å£½è±é„‰", lat: 23.871, lon: 121.509},
  {name: "èŠ±è“®ç¸£ å…‰å¾©é„‰", lat: 23.665, lon: 121.424}, {name: "èŠ±è“®ç¸£ è±æ¿±é„‰", lat: 23.597, lon: 121.521},
  {name: "èŠ±è“®ç¸£ ç‘ç©—é„‰", lat: 23.498, lon: 121.378}, {name: "èŠ±è“®ç¸£ å¯Œé‡Œé„‰", lat: 23.245, lon: 121.250},
  {name: "èŠ±è“®ç¸£ ç§€æ—é„‰", lat: 24.116, lon: 121.623, geoRisk: true}, {name: "èŠ±è“®ç¸£ è¬æ¦®é„‰", lat: 23.714, lon: 121.408, geoRisk: true},
  {name: "èŠ±è“®ç¸£ å“æºªé„‰", lat: 23.350, lon: 121.140, geoRisk: true},
  // --- å°æ±ç¸£ ---
  {name: "å°æ±ç¸£ å°æ±å¸‚", lat: 22.756, lon: 121.147}, {name: "å°æ±ç¸£ æˆåŠŸé®", lat: 23.100, lon: 121.373},
  {name: "å°æ±ç¸£ é—œå±±é®", lat: 23.048, lon: 121.163}, {name: "å°æ±ç¸£ å‘å—é„‰", lat: 22.787, lon: 121.092},
  {name: "å°æ±ç¸£ é¹¿é‡é„‰", lat: 22.914, lon: 121.156}, {name: "å°æ±ç¸£ æ± ä¸Šé„‰", lat: 23.122, lon: 121.216},
  {name: "å°æ±ç¸£ æ±æ²³é„‰", lat: 22.971, lon: 121.303}, {name: "å°æ±ç¸£ é•·æ¿±é„‰", lat: 23.315, lon: 121.452},
  {name: "å°æ±ç¸£ å¤ªéº»é‡Œé„‰", lat: 22.615, lon: 121.006}, {name: "å°æ±ç¸£ å¤§æ­¦é„‰", lat: 22.355, lon: 120.898},
  {name: "å°æ±ç¸£ ç¶ å³¶é„‰", lat: 22.662, lon: 121.492}, {name: "å°æ±ç¸£ æµ·ç«¯é„‰", lat: 23.100, lon: 121.030, geoRisk: true},
  {name: "å°æ±ç¸£ å»¶å¹³é„‰", lat: 22.902, lon: 121.083, geoRisk: true}, {name: "å°æ±ç¸£ é‡‘å³°é„‰", lat: 22.597, lon: 120.970, geoRisk: true},
  {name: "å°æ±ç¸£ é”ä»é„‰", lat: 22.295, lon: 120.887, geoRisk: true}, {name: "å°æ±ç¸£ è˜­å¶¼é„‰", lat: 22.056, lon: 121.558},
  // --- é›¢å³¶ ---
  {name: "æ¾æ¹–ç¸£ é¦¬å…¬å¸‚", lat: 23.565, lon: 119.563}, {name: "æ¾æ¹–ç¸£ æ¹–è¥¿é„‰", lat: 23.585, lon: 119.645},
  {name: "æ¾æ¹–ç¸£ ç™½æ²™é„‰", lat: 23.659, lon: 119.593}, {name: "æ¾æ¹–ç¸£ è¥¿å¶¼é„‰", lat: 23.601, lon: 119.507},
  {name: "æ¾æ¹–ç¸£ æœ›å®‰é„‰", lat: 23.371, lon: 119.501}, {name: "æ¾æ¹–ç¸£ ä¸ƒç¾é„‰", lat: 23.207, lon: 119.429},
  {name: "é‡‘é–€ç¸£ é‡‘åŸé®", lat: 24.416, lon: 118.317}, {name: "é‡‘é–€ç¸£ é‡‘æ²™é®", lat: 24.489, lon: 118.411},
  {name: "é‡‘é–€ç¸£ é‡‘æ¹–é®", lat: 24.439, lon: 118.415}, {name: "é‡‘é–€ç¸£ é‡‘å¯§é„‰", lat: 24.456, lon: 118.328},
  {name: "é‡‘é–€ç¸£ çƒˆå¶¼é„‰", lat: 24.426, lon: 118.243}, {name: "é‡‘é–€ç¸£ çƒåµé„‰", lat: 24.991, lon: 119.444},
  {name: "é€£æ±Ÿç¸£ å—ç«¿é„‰", lat: 26.155, lon: 119.927}, {name: "é€£æ±Ÿç¸£ åŒ—ç«¿é„‰", lat: 26.223, lon: 119.989},
  {name: "é€£æ±Ÿç¸£ è’å…‰é„‰", lat: 25.973, lon: 119.940}, {name: "é€£æ±Ÿç¸£ æ±å¼•é„‰", lat: 26.368, lon: 120.493}
];

// è«‹å‹™å¿…è²¼å›å®Œæ•´çš„ districts é™£åˆ—

async function fetchWeatherData(lat, lon) {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
                `&current=temperature_2m,apparent_temperature,precipitation,wind_speed_10m,wind_direction_10m,weather_code,cloud_cover,snowfall,relative_humidity_2m,surface_pressure,visibility` +
                `&daily=temperature_2m_max,temperature_2m_min,weather_code&hourly=precipitation_probability` +
                `&forecast_days=2&timezone=auto`;
    try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("API Error");
        return await res.json();
    } catch (e) {
        console.error("Fetch failed:", e);
        throw e;
    }
}

// é›™é‡æœå°‹æ©Ÿåˆ¶
async function fetchGlobalLocations(keyword) {
    let results = await searchOpenMeteo(keyword);
    if(results.length === 0) {
        results = await searchNominatim(keyword);
    }
    return results;
}

async function searchOpenMeteo(keyword) {
    const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(keyword)}&count=5&language=zh&format=json`;
    try {
        const res = await fetch(url);
        if(!res.ok) return [];
        const data = await res.json();
        if(!data.results) return [];
        return data.results.map(item => ({
            name: `${item.name} ${item.admin1 || ''} ${item.country || ''}`,
            lat: item.latitude,
            lon: item.longitude,
            geoRisk: false
        }));
    } catch(e) { return []; }
}

async function searchNominatim(keyword) {
    const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(keyword)}&format=json&accept-language=zh-TW&limit=5`;
    try {
        const res = await fetch(url);
        if(!res.ok) return [];
        const data = await res.json();
        return data.map(item => ({
            name: item.display_name, 
            lat: parseFloat(item.lat),
            lon: parseFloat(item.lon),
            geoRisk: false
        }));
    } catch(e) { return []; }
}

function findNearestDistrict(lat, lon) {
    let minDist = Infinity;
    let nearest = districts[0] || {name:"æœªçŸ¥", lat:lat, lon:lon}; 
    if(districts.length > 0){
        for (const d of districts) {
            const dist = Math.pow(d.lat - lat, 2) + Math.pow(d.lon - lon, 2);
            if (dist < minDist) {
                minDist = dist;
                nearest = d;
            }
        }
    }
    return nearest;
}

/**
 * =====================================================================
 * MODULE 2: RULE ENGINE
 * =====================================================================
 */
const RISK_LEVELS = {
    SNOW: 'SNOW',
    EXTREME_COLD: 'EXTREME_COLD', 
    HIGH: 'HIGH',
    MEDIUM: 'MEDIUM', // Drizzle
    LOW_GEO: 'LOW_GEO',
    LOW: 'LOW'
};

function getRainRiskLevel(weatherData, district) {
    const c = weatherData.current;
    const h = weatherData.hourly;
    const rainProb = getHourlyProb(h);
    
    // 1. ä¸‹é›ª
    const snowCodes = [71, 73, 75, 77, 85, 86];
    if (snowCodes.includes(c.weather_code) || (c.snowfall && c.snowfall > 0)) {
        return RISK_LEVELS.SNOW;
    }
    // 2. æ¥µå‡ (æ”¹ç”¨é«”æ„Ÿæº«åº¦)
    const feel = c.apparent_temperature;
    if (feel <= 0) {
        return RISK_LEVELS.EXTREME_COLD;
    }
    // 3. å¤§é›¨
    if (rainProb >= 30) return RISK_LEVELS.HIGH;
    
    // 4. é£„é›¨
    const drizzleCodes = [51, 53, 55, 61, 63, 65, 80, 81, 82];
    if (drizzleCodes.includes(c.weather_code)) {
        return RISK_LEVELS.MEDIUM;
    }
    
    // 5. åœ°å½¢é¢¨éšª (æ–‡å­—æé†’ï¼Œä½†ç‹€æ…‹ç‚º OK)
    if (district.geoRisk === true) return RISK_LEVELS.LOW_GEO;

    return RISK_LEVELS.LOW;
}

function getHourlyProb(hourlyData) {
    if (!hourlyData || !hourlyData.precipitation_probability) return 0;
    const now = new Date();
    const currentHour = now.getHours();
    const probCurrent = hourlyData.precipitation_probability[currentHour] || 0;
    const probNext = (currentHour < 23) ? (hourlyData.precipitation_probability[currentHour + 1] || 0) : 0;
    return Math.max(probCurrent, probNext);
}

function getWindDirText(degree) {
    const directions = ['åŒ—é¢¨', 'æ±åŒ—é¢¨', 'æ±é¢¨', 'æ±å—é¢¨', 'å—é¢¨', 'è¥¿å—é¢¨', 'è¥¿é¢¨', 'è¥¿åŒ—é¢¨'];
    const index = Math.round(degree / 45) % 8;
    return directions[index];
}

/**
 * =====================================================================
 * MODULE 3: COPY RESOLVER
 * =====================================================================
 */
function getCopyByRiskLevel(level) {
    switch (level) {
        case RISK_LEVELS.SNOW:
            return {
                umbrella: "ä¸‹é›ªäº†ï¼å¸¶å‚˜æ“‹é›ª ğŸŒ¨ï¸",
                note: "è·¯é¢æ˜“çµå†°æ¿•æ»‘ï¼Œé€šå‹¤æ™‚é–“è«‹å‹™å¿…é ç•™ç·©è¡ï¼Œæ³¨æ„ä¿æš–ï¼",
                type: "snow"
            };
        case RISK_LEVELS.EXTREME_COLD: 
            return {
                umbrella: "å…å¸¶å‚˜ï¼Œä½†è«‹å¸¶æš–æš–åŒ… ğŸ”¥",
                note: "é›–ç„¶æ²’ä¸‹é›ªï¼Œä½†æˆ¶å¤–æ¥µåº¦å¯’å†·ï¼Œè«‹ç›¡é‡æ¸›å°‘æš´éœ²åœ¨å®¤å¤–çš„æ™‚é–“ã€‚",
                type: "freezing"
            };
        case RISK_LEVELS.HIGH:
            return {
                umbrella: "ä¸€å®šæœƒæ¿•ï¼å¤§å‚˜æº–å‚™å¥½ â˜”",
                note: "é€šå‹¤æ™‚æ®µé™é›¨æ©Ÿç‡åé«˜ï¼Œå»ºè­°æ”œå¸¶é›¨å…·ï¼Œé¿å…è¢«é›¨è€½èª¤è¡Œç¨‹ã€‚",
                type: "rain"
            };
        case RISK_LEVELS.MEDIUM:
            return {
                umbrella: "å¤–é¢æœ‰é£„é›¨ï¼Œå»ºè­°å¸¶å‚˜ ğŸŒ¦ï¸",
                note: "æˆ¶å¤–æœ‰çŸ­æš«é›¨æˆ–æ¯›æ¯›é›¨ï¼Œå»ºè­°æ”œå¸¶é›¨å…·ã€‚",
                type: "rain"
            };
        case RISK_LEVELS.LOW_GEO:
            // åœ°å½¢é¢¨éšªå€ï¼šæ–‡å­—æé†’ï¼Œç‹€æ…‹ OK
            return {
                umbrella: "åœ°å½¢æ€§é¢¨éšªå€ï¼Œå»ºè­°å¸¶è‘—æŠ˜ç–Šå‚˜ ğŸŒ‚",
                note: "æ­¤å€åŸŸé è¿‘å±±å€æˆ–è¿é¢¨é¢ï¼Œå³ä½¿æ•´é«”å¤©æ°£ç©©å®šï¼Œä»å¯èƒ½æœ‰å±€éƒ¨é£„é›¨ã€‚",
                type: "ok" 
            };
        case RISK_LEVELS.LOW:
        default:
            return {
                umbrella: "å…å¸¶ï¼æ”¾å¿ƒå‡ºé–€ ğŸ‘",
                note: "ç›®å‰å¤©æ°£ç›¸å°ç©©å®šï¼Œé€šå‹¤æ™‚æ®µé™é›¨é¢¨éšªä½ã€‚",
                type: "ok"
            };
    }
}

// é«”æ„Ÿæº«åº¦ç©¿è¡£å»ºè­° (Level 21 ä¿®æ­£ç‰ˆ)
function getClothesAdvice(feel) {
    if(feel < -10) return "ğŸ¥¶ <b>æ¥µç«¯ä½æº« (éæ—¥å¸¸é€šå‹¤æƒ…å¢ƒ)</b><br>æ­¤ç‚ºæ—…éŠ/ç•™å­¸æ¥µåœ°æ°£å€™ï¼Œè«‹ç©¿è‘—æœ€ä¿æš–è£å‚™ (ç¾½çµ¨+ç™¼ç†±è¡£+é˜²é¢¨å±¤)ï¼Œæ³¨æ„æœ«æ¢¢é˜²å‡ã€‚";
    if(feel <= 0) return "æ¥µå‡è­¦å ±ï¼é«”æ„Ÿé›¶ä¸‹ï¼Œè«‹ç©¿è‘—æœ€ä¿æš–è£å‚™ (ç¾½çµ¨+ç™¼ç†±è¡£) ğŸ¥¶";
    if(feel < 10) return "å¯’æµç­‰ç´šï¼é«”æ„Ÿå¾ˆå†·ï¼Œåœå·¾æ‰‹å¥—è«‹æº–å‚™ ğŸ§£";
    if(feel < 15) return "æ¿•å†·é›£å—ï¼å»ºè­°å¤šå±¤æ¬¡ç©¿æ­ï¼Œåšå¤¾å…‹æˆ–ç¾½çµ¨èƒŒå¿ƒæº–å‚™å¥½ ğŸ§¥";
    if(feel < 20) return "æ—©æ™šæº«å·®å¤§ï¼æ´‹è”¥å¼ç©¿æ³• (è–„é•·è¢–+é˜²é¢¨å¤–å¥—)ï¼Œé€²å®¤å…§å¯è„« ğŸ‘Œ";
    if(feel < 26) return "èˆ’é©å®œäººï¼çŸ­è¢–æ­é…è–„è¥¯è¡«æˆ–é‡ç¹”è¡«ï¼Œéš¨æ™‚æ‡‰å°ç©ºèª¿ ğŸ˜Œ";
    if(feel < 30) return "æœ‰äº›æ‚¶ç†±ï¼Œç©¿è‘—é€æ°£çŸ­è¢–ï¼Œéš¨èº«æ”œå¸¶æ°´ç“¶ ğŸ’§";
    return "ç†±æµªä¾†è¥²ï¼è¼•è–„é€æ°£è¡£ç‰©ç‚ºä¸»ï¼Œæ³¨æ„é˜²æ›¬èˆ‡è£œå……æ°´åˆ† â˜€ï¸";
}

// é¢¨é€Ÿå»ºè­° (å«é€šå‹¤é«”æ„Ÿ + æ‚¶ç†±ä¿®æ­£)
function getWindAdvice(speed, temp, feel) {
    let level = 0;
    if (speed < 1) level = 0;
    else if (speed <= 5) level = 1;
    else if (speed <= 11) level = 2;
    else if (speed <= 19) level = 3;
    else if (speed <= 28) level = 4;
    else if (speed <= 38) level = 5;
    else if (speed <= 49) level = 6;
    else if (speed <= 61) level = 7;
    else level = 8;

    const levelStr = `${level}ç´šé¢¨`;

    // å„ªå…ˆï¼šé«”æ„Ÿæº«åº¦æ¥µä½
    if (feel < 12) {
        if (level >= 3) return `${levelStr}ï¼Œå¯’é¢¨åˆºéª¨ï¼é«”æ„Ÿæ¥µä½ï¼Œä¿æš–è¦åŒ…ç·Š ğŸ§¥`;
        return `${levelStr}ï¼Œæ°£æº«ä½ï¼Œç©ºæ°£å†°å†·è«‹ä¿æš– â„ï¸`; 
    }

    // å„ªå…ˆï¼šæ‚¶ç†±ä¿®æ­£ (L22)
    if (feel > 28 && level <= 2) {
         return `${levelStr}ï¼Œå¾®é¢¨ï¼Œç¨é¡¯æ‚¶ç†±ï¼Œç©ºæ°£è¼ƒä¸æµé€š ğŸ« `;
    }

    if (feel > 32) {
         return `${levelStr}ï¼Œç†±æµªä¾†è¥²ï¼Œæ³¨æ„ä¸­æš‘å¤šå–æ°´ ğŸ¥µ`;
    }

    if (level >= 8) return `${levelStr}ï¼Œé¢±é¢¨ç­‰ç´šï¼æ¥µåº¦å±éšªï¼Œè«‹èº²å®¤å…§ ğŸ `;
    if (level >= 6) return `${levelStr}ï¼Œå±éšªï¼é¨è»Šä¸ç©©ï¼Œèµ°è·¯å›°é›£ ğŸš«`;
    if (level === 5) return `${levelStr}ï¼Œå¼·é¢¨ï¼é›¨å‚˜å®¹æ˜“é–‹èŠ±ï¼Œé¨è»Šå°å¿ƒå´é¢¨ âš ï¸`;
    if (level === 4) return `${levelStr}ï¼Œé¢¨å¤§ï¼é¨è»Šæ˜é¡¯æœ‰é˜»åŠ› ğŸ›µ`;
    if (level === 3) return `${levelStr}ï¼Œèµ·é¢¨ï¼æ¨¹è‘‰æ–æ™ƒï¼Œæœ‰æ¶¼æ„ ğŸƒ`;
    
    return `${levelStr}ï¼Œå¾®é¢¨ï¼ç©ºæ°£æµé€šï¼Œèˆ’é©å®œäºº ğŸ‘Œ`;
}

function getWeatherIcon(code) {
    if (code === 0) return { icon: "â˜€ï¸", text: "æ™´æœ—" };
    if ([1,2,3].includes(code)) return { icon: "â›…", text: "å¤šé›²" };
    if ([45,48].includes(code)) return { icon: "ğŸŒ«ï¸", text: "æœ‰éœ§" };
    if ([71,73,75,77,85,86].includes(code)) return { icon: "ğŸŒ¨ï¸", text: "ä¸‹é›ª" };
    if (code >= 51 && code <= 67) return { icon: "ğŸŒ§ï¸", text: "é›¨å¤©" };
    if (code >= 80 && code <= 99) return { icon: "â›ˆï¸", text: "é›·é›¨/é™£é›¨" };
    return { icon: "ğŸŒ¥ï¸", text: "é™°å¤©" };
}

/**
 * =====================================================================
 * MODULE 4: UI RENDERER (Compact List + æ¨‚é½¡å¤§å­—ç‰ˆ)
 * =====================================================================
 */
const ui = {
    search: document.getElementById("searchInput"),
    suggestions: document.getElementById("suggestions"),
    skeleton: document.getElementById("weatherSkeleton"),
    resultCard: document.getElementById("weatherSummaryCard"),
    commuteSection: document.getElementById("commuteSection"), 
    
    toggleLoading(isLoading) {
        if (isLoading) {
            this.skeleton.style.display = "block";
            this.resultCard.style.display = "none";
            this.commuteSection.style.display = "none";
        } else {
            this.skeleton.style.display = "none";
        }
    },

    render(label, weatherData, district, riskLevel, copy) {
        const c = weatherData.current;
        const d = weatherData.daily;
        const h = weatherData.hourly;
        
        const tMax = Math.round(d.temperature_2m_max[0]);
        const tMin = Math.round(d.temperature_2m_min[0]);
        const feel = Math.round(c.apparent_temperature);
        const humidity = c.relative_humidity_2m;
        const visibility = (c.visibility / 1000).toFixed(1);
        const pressure = Math.round(c.surface_pressure);
        const windDir = getWindDirText(c.wind_direction_10m);
        const weatherInfo = getWeatherIcon(c.weather_code);
        const rainProb = getHourlyProb(h);
        
        // æ˜æ—¥é å ±
        const tmrMax = Math.round(d.temperature_2m_max[1]);
        const tmrMin = Math.round(d.temperature_2m_min[1]);
        const tmrIcon = getWeatherIcon(d.weather_code[1]);

        document.getElementById("summaryCity").textContent = label;
        document.getElementById("summaryTime").textContent = this.getTimeStr();
        document.getElementById("weatherBottomNote").textContent = copy.note;

        // å¾®æ•´åˆåˆ—è¡¨ (Compact List) - å­—é«”åŠ å¤§ç‰ˆ
        document.getElementById("infoList").innerHTML = `
            <div class="info-row">
                <div class="info-icon">ğŸŒ¡</div>
                <div class="info-text">
                    æ°£æº«ï¼š${Math.round(c.temperature_2m)}â„ƒ (é«˜:${tMax} / ä½:${tMin}) 
                    <br><span style="font-size:18px;color:#666">é«”æ„Ÿ ${feel}â„ƒ</span>
                </div>
            </div>
            <div class="info-row">
                <div class="info-icon">${weatherInfo.icon}</div>
                <div class="info-text">ç‹€æ³ï¼š${weatherInfo.text} (é™é›¨æ©Ÿç‡ ${rainProb}%)</div>
            </div>
            <div class="info-row">
                <div class="info-icon">ğŸŒ¬</div>
                <div class="info-text">${getWindAdvice(c.wind_speed_10m, c.temperature_2m, feel)} <span style="font-size:18px;color:#666">(${windDir})</span></div>
            </div>
            <div class="info-row">
                <div class="info-icon">ğŸ“Š</div>
                <div class="info-text">
                    <span class="highlight-data">æ¿•åº¦ ${humidity}%</span>
                    <span class="highlight-data">èƒ½è¦‹åº¦ ${visibility}km</span>
                    <span class="highlight-data">æ°£å£“ ${pressure}hPa</span>
                </div>
            </div>
            <div class="info-row">
                <div class="info-icon">ğŸ‘•</div>
                <div class="info-text">${getClothesAdvice(feel)}</div>
            </div>
            <div class="info-row">
                <div class="info-icon">â˜”</div>
                <div class="info-text">${copy.umbrella}</div>
            </div>
            
            <div class="info-row forecast-row">
                <div class="info-icon">ğŸ“…</div>
                <div class="info-text">
                    <b>æ˜æ—¥é å ±ï¼š</b> ${tmrIcon.icon} (é«˜:${tmrMax} / ä½:${tmrMin})
                </div>
            </div>
        `;

        this.resultCard.style.display = "block";
        this.commuteSection.style.display = "block"; 
        this.resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });

        window.currentWeatherType = copy.type; 
        window.currentTemp = feel; 
        
        if (window.currentWeatherType === 'ok') {
             if (c.wind_speed_10m > 28) { 
                window.currentWeatherType = "wind";
             }
        }
    },

    getTimeStr() {
        const now = new Date();
        const days = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];
        const mins = now.getMinutes().toString().padStart(2, '0');
        return `${days[now.getDay()]} ${now.getHours()}:${mins}`;
    }
};

// =====================================================================
//  APP CONTROLLER
// =====================================================================

function debounce(func, timeout = 500){
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => { func.apply(this, args); }, timeout);
  };
}

let currentLocalResults = [];

const handleGlobalSearch = debounce(async (v) => {
    if(v.length < 2) return; 
    renderSuggestions(currentLocalResults, true); 
    const globalResults = await fetchGlobalLocations(v);
    renderSuggestions(currentLocalResults, false, globalResults);
}, 600); 

function renderSuggestions(localList, isLoadingGlobal = false, globalList = []) {
    let html = "";
    if(localList.length > 0) {
        html += `<div class="s-header">ğŸ“ å°ç£åœ°å€</div>`;
        html += localList.map(a => `<div class="s-item" data-src="local">${a.name}</div>`).join("");
    }
    if(isLoadingGlobal) {
        html += `<div class="s-header s-global">ğŸŒ æ­£åœ¨æœå°‹å…¨çƒåŸå¸‚...</div>`;
    }
    if(globalList.length > 0) {
        html += `<div class="s-header s-global">ğŸŒ å…¨çƒçµæœ</div>`;
        html += globalList.map(a => `<div class="s-item" data-src="global" data-lat="${a.lat}" data-lon="${a.lon}">${a.name}</div>`).join("");
    }
    if(!html) {
        ui.suggestions.style.display="none"; 
        return;
    }
    ui.suggestions.innerHTML = html;
    ui.suggestions.style.display = "block";

    document.querySelectorAll(".s-item").forEach(item => {
        item.onclick = () => {
            const src = item.dataset.src;
            const name = item.textContent;
            ui.search.value = name;
            ui.suggestions.style.display = "none";
            
            if(src === "local") {
                const area = districts.find(a => a.name === name);
                if(area) executeQuery(area);
            } else {
                const tempArea = {
                    name: name,
                    lat: parseFloat(item.dataset.lat),
                    lon: parseFloat(item.dataset.lon),
                    geoRisk: false
                };
                executeQuery(tempArea);
            }
        };
    });
}

ui.search.addEventListener("input", () => {
    const v = ui.search.value.trim();
    if(!v) { ui.suggestions.style.display="none"; return; }
    currentLocalResults = districts.filter(a => a.name.includes(v));
    renderSuggestions(currentLocalResults);
    handleGlobalSearch(v);
});

document.addEventListener("click", (e) => {
    if(!e.target.closest(".search-wrapper")) ui.suggestions.style.display="none";
});

document.getElementById("geoBtn").addEventListener("click", () => {
    if(typeof gtag === 'function') gtag('event', 'use_geolocation');
    if(!navigator.geolocation) { alert("ä¸æ”¯æ´å®šä½"); return; }
    ui.toggleLoading(true);
    navigator.geolocation.getCurrentPosition(
        (pos) => {
            const nearest = findNearestDistrict(pos.coords.latitude, pos.coords.longitude);
            executeQuery(nearest);
        },
        (err) => { ui.toggleLoading(false); alert("ç„¡æ³•å®šä½"); },
        { timeout: 5000 }
    );
});

document.getElementById("getWeatherBtn").addEventListener("click", () => {
    const text = ui.search.value.trim();
    if(!text) return alert("è«‹è¼¸å…¥åœ°å€");
    const area = districts.find(a => a.name === text || a.name.includes(text));
    if(area) executeQuery(area);
    else alert("è«‹å¾é¸å–®ä¸­é»é¸æœå°‹çµæœ");
});

async function executeQuery(district) {
    const btn = document.getElementById("getWeatherBtn");
    
    // 1. é˜²æ‰‹æŠ–
    btn.disabled = true;
    const originalText = btn.innerText;
    btn.innerText = "æŸ¥è©¢ä¸­...";

    try {
        ui.toggleLoading(true);
        if(typeof gtag === 'function') gtag('event', 'search_weather', { 'event_label': district.name });
        ui.search.value = district.name;

        // 2. æª¢æŸ¥å¿«å–
        const CACHE_DURATION = 15 * 60 * 1000; 
        const cacheKey = `weather_${district.lat.toFixed(2)}_${district.lon.toFixed(2)}`;
        const cached = localStorage.getItem(cacheKey);
        
        let weatherData;
        let isFromCache = false;

        if (cached) {
            const { timestamp, data } = JSON.parse(cached);
            if (new Date().getTime() - timestamp < CACHE_DURATION) {
                console.log("ğŸš€ Using Local Cache");
                weatherData = data;
                isFromCache = true;
            }
        }

        // 3. å‘¼å« API
        if (!weatherData) {
            console.log("ğŸŒ Fetching New Data");
            weatherData = await fetchWeatherData(district.lat, district.lon);
            localStorage.setItem(cacheKey, JSON.stringify({
                timestamp: new Date().getTime(),
                data: weatherData
            }));
        }

        const riskLevel = getRainRiskLevel(weatherData, district);
        const copy = getCopyByRiskLevel(riskLevel);

        setTimeout(() => { 
            ui.toggleLoading(false);
            ui.render(district.name, weatherData, district, riskLevel, copy);
        }, 300);

    } catch (e) {
        console.error(e);
        ui.toggleLoading(false);
        alert("è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
    } finally {
        setTimeout(() => {
            btn.disabled = false;
            btn.innerText = originalText;
        }, 1000);
    }
}

document.querySelectorAll(".cm-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        const type = btn.dataset.type;
        const msg = getCommuteMsg(type, window.currentWeatherType || 'ok', window.currentTemp);
        if(typeof gtag === 'function') gtag('event', 'select_commute', { 'mode': type });
        const box = document.getElementById("commuteResult");
        box.style.opacity = 0;
        setTimeout(() => {
            box.innerHTML = `<span style="color:#3A8DFF">ğŸ’¡ å»ºè­°ï¼š</span>${msg}`;
            box.style.opacity = 1;
        }, 150);
    });
});

function getCommuteMsg(mode, weather, feel){
    const isFreezing = (feel < 10); // æ”¹ç”¨é«”æ„Ÿ
    const isExtremeCold = (feel <= 0); // æ”¹ç”¨é«”æ„Ÿ

    if(mode === "scooter"){
        if(isExtremeCold) return "è·¯é¢å¯èƒ½æœ‰é»‘å†°æ‰“æ»‘ï¼Œé¨è»Šæ¥µåº¦å±éšªï¼Œè«‹æ”¹é“ï¼";
        if(weather === "snow") return "ä¸‹é›ªé¨è»Šæ¥µåº¦å±éšªï¼è«‹æ”¹æ­å¤§çœ¾é‹è¼¸ã€‚";
        if(weather === "rain") return "è·¯æ»‘æ…¢è¡Œï¼Œæ³¨æ„æ¨™ç·šæ‰“æ»‘ï¼Œé›¨è¡£ç©¿å¥½ã€‚";
        if(weather === "wind") return "é¢¨å¤§æŠ“ç©©é¾é ­ï¼Œé¿é–‹ç©ºæ› è·¯æ®µã€‚";
        if(isFreezing) return "å¯’é¢¨åˆºéª¨ï¼Œé¨è»Šè«‹å‹™å¿…æˆ´é˜²é¢¨æ‰‹å¥—èˆ‡å£ç½©ï¼";
        return "å¤©æ°£ä¸éŒ¯ï¼Œé¨è»Šå…œé¢¨å»ä¸Šç­å§ã€‚";
    }
    if(mode === "car"){
        if(isExtremeCold) return "è·¯é¢å¯èƒ½æœ‰éš±å½¢çµå†°(é»‘å†°)ï¼Œè«‹é¿å…æ€¥ç…ï¼Œæ”¾æ…¢è»Šé€Ÿï¼";
        if(weather === "snow") return "é›ªåœ°é§•é§›éœ€è£é›ªéˆï¼Œæ³¨æ„æ‰“æ»‘ï¼Œæ‹‰é•·è»Šè·ã€‚";
        if(weather === "rain") return "é›¨å¤©è¦–ç·šå·®ä¸”æ˜“å¡è»Šï¼Œææ—©å‡ºé–€ï¼Œä¿æŒè»Šè·ã€‚";
        return "è»Šä¸Šè½å€‹ Podcastï¼Œäº«å—é€šå‹¤æ™‚å…‰ã€‚";
    }
    if(mode === "mrt"){
        if(isExtremeCold || weather === "snow") return "å¤–é¢å¤©å¯’åœ°å‡ï¼Œæ·é‹æœ‰æš–æ°£æœ€èˆ’æœã€‚";
        if(weather === "rain") return "ä¸‹é›¨å¤©æ­æ·é‹æœ€ä¹¾çˆ½ï¼Œé‚„èƒ½è£œçœ ã€‚";
        return "æ·é‹æº–æ™‚åˆæ–¹ä¾¿ï¼Œæ˜¯é€šå‹¤é¦–é¸ã€‚";
    }
    if(mode === "bus"){
        if(isExtremeCold) return "å¤–é¢å¤ªå†·äº†ï¼Œèº²é€²å…¬è»Šå–æš–æœ€å¯¦åœ¨ã€‚";
        if(weather === "rain") return "ç­‰è»Šæ‰¾é®è”½è™•ï¼Œè»Šä¸Šå†·æ°£å¼·è¨˜å¾—ç©¿å¤–å¥—ã€‚";
        return "ä¸Šè»Šé¸å€‹çª—é‚Šä½ï¼Œæ¬£è³è¡—æ™¯ã€‚";
    }
    if(mode === "walk"){
        if(isExtremeCold) return "å¤ªå†·äº†ï¼æˆ¶å¤–è¡Œèµ°å®¹æ˜“å¤±æº«ï¼Œè«‹æ­è»Šä»£æ­¥ã€‚";
        if(weather === "snow") return "é›ªåœ°è¡Œèµ°å›°é›£ä¸”æ˜“æ»‘å€’ï¼Œå»ºè­°æ”¹æ­è»Šã€‚";
        if(weather === "rain") return "èµ°è·¯é‹å­æœƒæ¿•ï¼Œå»ºè­°æ›æ­è»Šæˆ–ç©¿é˜²æ°´é‹ã€‚";
        if(weather === "wind") return "é¢¨å¤§è¡Œèµ°å›°é›£ä¸”æ˜“å‡Œäº‚ï¼Œå»ºè­°æ”¹æ­è»Šã€‚";
        if(isFreezing) return "æ°£æº«åä½ï¼Œèµ°è·¯è«‹æˆ´å£ç½©åœå·¾ï¼Œé¿å…å¸å…¥å†·é¢¨ã€‚";
        return "ä»Šå¤©é©åˆèµ°è·¯ï¼Œææ—©ä¸€ç«™ä¸‹è»Šé‹å‹•ä¸€ä¸‹ï¼";
    }
    if(mode === "cafe"){
        if(isExtremeCold || weather === "snow") return "å¤–é¢å¤©å¯’åœ°å‡ï¼Œèº²é€²å’–å•¡å»³å–ç†±é£²æœ€å¹¸ç¦ã€‚";
        if(weather === "rain") return "é›¨å¤§å…ˆèº²å’–å•¡å»³å·¥ä½œï¼Œç­‰é›¨åœå†èµ°ã€‚";
        return "é»æ¯ç†±æ‹¿éµï¼Œé–‹å•Ÿé«˜æ•ˆå·¥ä½œæ¨¡å¼ã€‚";
    }
    return "ç¥ä½ é€šå‹¤é †åˆ©ï¼";
}
</script>
</body>
</html>